<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>C Functions | Study project: Fundamentals of Causal Inferences With R</title>
  <meta name="description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="C Functions | Study project: Fundamentals of Causal Inferences With R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="C Functions | Study project: Fundamentals of Causal Inferences With R" />
  
  <meta name="twitter:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  

<meta name="author" content="François Lefebvre" />


<meta name="date" content="2022-02-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="notes.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Study Project</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>I Part I</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-brief-history"><i class="fa fa-check"></i><b>1.1</b> A Brief History</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.2</b> Data Examples</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#mortality-rates-by-country"><i class="fa fa-check"></i><b>1.2.1</b> Mortality Rates by Country</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#national-center-for-education-statistics"><i class="fa fa-check"></i><b>1.2.2</b> National Center for Education Statistics</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#reducing-alcohol-consumption"><i class="fa fa-check"></i><b>1.2.3</b> Reducing Alcohol Consumption</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#general-social-survey"><i class="fa fa-check"></i><b>1.2.4</b> General Social Survey</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#a-cancer-clinical-trial"><i class="fa fa-check"></i><b>1.2.5</b> A Cancer Clinical Trial</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#exercise-1"><i class="fa fa-check"></i><b>1.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#exercise-2"><i class="fa fa-check"></i><b>1.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#exercise-3"><i class="fa fa-check"></i><b>1.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#exercise-4"><i class="fa fa-check"></i><b>1.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#exercise-5"><i class="fa fa-check"></i><b>1.3.5</b> Exercise 5</a></li>
<li class="chapter" data-level="1.3.6" data-path="intro.html"><a href="intro.html#exercise-6"><i class="fa fa-check"></i><b>1.3.6</b> Exercise 6</a></li>
<li class="chapter" data-level="1.3.7" data-path="intro.html"><a href="intro.html#exercise-7"><i class="fa fa-check"></i><b>1.3.7</b> Exercise 7</a></li>
<li class="chapter" data-level="1.3.8" data-path="intro.html"><a href="intro.html#exercise-8"><i class="fa fa-check"></i><b>1.3.8</b> Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>2</b> Conditional Probability and Expectation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>2.1</b> Conditional Probability</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="probability.html"><a href="probability.html#law-of-total-probability"><i class="fa fa-check"></i><b>2.1.1</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability.html"><a href="probability.html#conditional-expectation-and-he-law-of-total-expectation"><i class="fa fa-check"></i><b>2.2</b> Conditional Expectation and he Law of Total expectation</a></li>
<li class="chapter" data-level="2.3" data-path="probability.html"><a href="probability.html#estimation"><i class="fa fa-check"></i><b>2.3</b> Estimation</a></li>
<li class="chapter" data-level="2.4" data-path="probability.html"><a href="probability.html#sampling-distributions-and-the-bootstrap"><i class="fa fa-check"></i><b>2.4</b> Sampling Distributions and the Bootstrap</a></li>
<li class="chapter" data-level="2.5" data-path="probability.html"><a href="probability.html#exercises-1"><i class="fa fa-check"></i><b>2.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="probability.html"><a href="probability.html#exercise-1-1"><i class="fa fa-check"></i><b>2.5.1</b> Exercise 1</a></li>
<li class="chapter" data-level="2.5.2" data-path="probability.html"><a href="probability.html#exercise-2-1"><i class="fa fa-check"></i><b>2.5.2</b> Exercise 2</a></li>
<li class="chapter" data-level="2.5.3" data-path="probability.html"><a href="probability.html#exercise-3-1"><i class="fa fa-check"></i><b>2.5.3</b> Exercise 3</a></li>
<li class="chapter" data-level="2.5.4" data-path="probability.html"><a href="probability.html#exercise-4-1"><i class="fa fa-check"></i><b>2.5.4</b> Exercise 4</a></li>
<li class="chapter" data-level="2.5.5" data-path="probability.html"><a href="probability.html#exercise-5-1"><i class="fa fa-check"></i><b>2.5.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="outcomes.html"><a href="outcomes.html"><i class="fa fa-check"></i><b>3</b> Potential Outcomes and the Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="outcomes.html"><a href="outcomes.html#potential-outcomes-and-the-consistency-assumption"><i class="fa fa-check"></i><b>3.1</b> Potential Outcomes and the Consistency Assumption</a></li>
<li class="chapter" data-level="3.2" data-path="outcomes.html"><a href="outcomes.html#circumventing-the-fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>3.2</b> Circumventing the Fundamental Problem of Causal Inference</a></li>
<li class="chapter" data-level="3.3" data-path="outcomes.html"><a href="outcomes.html#effect-measures"><i class="fa fa-check"></i><b>3.3</b> Effect Measures</a></li>
<li class="chapter" data-level="3.4" data-path="outcomes.html"><a href="outcomes.html#exercises-2"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="outcomes.html"><a href="outcomes.html#exercise-1-2"><i class="fa fa-check"></i><b>3.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="3.4.2" data-path="outcomes.html"><a href="outcomes.html#exercise-2-2"><i class="fa fa-check"></i><b>3.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4.3" data-path="outcomes.html"><a href="outcomes.html#exercise-3-2"><i class="fa fa-check"></i><b>3.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="3.4.4" data-path="outcomes.html"><a href="outcomes.html#exercise-4-2"><i class="fa fa-check"></i><b>3.4.4</b> Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>4</b> Effect-Measure Modification and Causal Interaction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="measures.html"><a href="measures.html#effect-measure-modification-and-statistical-interaction"><i class="fa fa-check"></i><b>4.1</b> Effect-Measure Modification and Statistical Interaction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="measures.html"><a href="measures.html#recovery-trial"><i class="fa fa-check"></i><b>4.1.1</b> RECOVERY trial</a></li>
<li class="chapter" data-level="4.1.2" data-path="measures.html"><a href="measures.html#nces"><i class="fa fa-check"></i><b>4.1.2</b> NCES</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="measures.html"><a href="measures.html#qualitative-agreement-of-effect-measures-in-modification"><i class="fa fa-check"></i><b>4.2</b> Qualitative Agreement of Effect Measures in Modification</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="measures.html"><a href="measures.html#simulate-the-effect-measures"><i class="fa fa-check"></i><b>4.2.1</b> Simulate the effect measures</a></li>
<li class="chapter" data-level="4.2.2" data-path="measures.html"><a href="measures.html#applications"><i class="fa fa-check"></i><b>4.2.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="measures.html"><a href="measures.html#causal-interaction"><i class="fa fa-check"></i><b>4.3</b> Causal Interaction</a></li>
<li class="chapter" data-level="4.4" data-path="measures.html"><a href="measures.html#exercises-3"><i class="fa fa-check"></i><b>4.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="measures.html"><a href="measures.html#exercise-1-3"><i class="fa fa-check"></i><b>4.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="measures.html"><a href="measures.html#exercise-2-3"><i class="fa fa-check"></i><b>4.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="measures.html"><a href="measures.html#exercise-3-3"><i class="fa fa-check"></i><b>4.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="measures.html"><a href="measures.html#exercise-4-3"><i class="fa fa-check"></i><b>4.4.4</b> Exercise 4</a></li>
<li class="chapter" data-level="4.4.5" data-path="measures.html"><a href="measures.html#exercise-5-2"><i class="fa fa-check"></i><b>4.4.5</b> Exercise 5</a></li>
<li class="chapter" data-level="4.4.6" data-path="measures.html"><a href="measures.html#exercise-6-1"><i class="fa fa-check"></i><b>4.4.6</b> Exercise 6</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II</b></span></li>
<li class="chapter" data-level="5" data-path="dag.html"><a href="dag.html"><i class="fa fa-check"></i><b>5</b> Causal Directed Acyclic Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dag.html"><a href="dag.html#theory"><i class="fa fa-check"></i><b>5.1</b> Theory</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dag.html"><a href="dag.html#conditional-indepence-and-dag"><i class="fa fa-check"></i><b>5.1.1</b> Conditional Indepence and DAG</a></li>
<li class="chapter" data-level="5.1.2" data-path="dag.html"><a href="dag.html#d-separation"><i class="fa fa-check"></i><b>5.1.2</b> D-Separation</a></li>
<li class="chapter" data-level="5.1.3" data-path="dag.html"><a href="dag.html#causal-dag-with-collider"><i class="fa fa-check"></i><b>5.1.3</b> Causal DAG with collider</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dag.html"><a href="dag.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="dag.html"><a href="dag.html#causal-dag-with-intermediate-value"><i class="fa fa-check"></i><b>5.2.1</b> Causal DAG With Intermediate Value</a></li>
<li class="chapter" data-level="5.2.2" data-path="dag.html"><a href="dag.html#a-counfounder-may-occur-after-the-exposure"><i class="fa fa-check"></i><b>5.2.2</b> A counfounder may occur after the exposure</a></li>
<li class="chapter" data-level="5.2.3" data-path="dag.html"><a href="dag.html#potential-outcomes-are-the-ultimate-counfounder"><i class="fa fa-check"></i><b>5.2.3</b> Potential Outcomes are the Ultimate Counfounder</a></li>
<li class="chapter" data-level="5.2.4" data-path="dag.html"><a href="dag.html#structural-causal-model-5.7"><i class="fa fa-check"></i><b>5.2.4</b> Structural Causal Model 5.7</a></li>
<li class="chapter" data-level="5.2.5" data-path="dag.html"><a href="dag.html#potential-outcomes-behind-the-scenes"><i class="fa fa-check"></i><b>5.2.5</b> Potential Outcomes Behind the Scenes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dag.html"><a href="dag.html#exercises-4"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="dag.html"><a href="dag.html#exercise-1-4"><i class="fa fa-check"></i><b>5.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="5.3.2" data-path="dag.html"><a href="dag.html#exercise-2-4"><i class="fa fa-check"></i><b>5.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="5.3.3" data-path="dag.html"><a href="dag.html#exercise-3-4"><i class="fa fa-check"></i><b>5.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="5.3.4" data-path="dag.html"><a href="dag.html#exercise-4-4"><i class="fa fa-check"></i><b>5.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="5.3.5" data-path="dag.html"><a href="dag.html#exercise-5-3"><i class="fa fa-check"></i><b>5.3.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="backdoor.html"><a href="backdoor.html"><i class="fa fa-check"></i><b>6</b> Backdoor Method via Standardization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="backdoor.html"><a href="backdoor.html#standardization-via-outome-modeling"><i class="fa fa-check"></i><b>6.1</b> Standardization via Outome Modeling</a>
<ul>
<li class="chapter" data-level="" data-path="backdoor.html"><a href="backdoor.html#examples-1"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="6.1.1" data-path="backdoor.html"><a href="backdoor.html#average-effect-of-treatment-on-the-treated"><i class="fa fa-check"></i><b>6.1.1</b> Average Effect of Treatment on the Treated</a></li>
<li class="chapter" data-level="6.1.2" data-path="backdoor.html"><a href="backdoor.html#standardization-with-a-parametric-outcome-model"><i class="fa fa-check"></i><b>6.1.2</b> Standardization with a Parametric Outcome Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="backdoor.html"><a href="backdoor.html#standardization-via-exposure-modeling"><i class="fa fa-check"></i><b>6.2</b> Standardization via Exposure Modeling</a>
<ul>
<li class="chapter" data-level="" data-path="backdoor.html"><a href="backdoor.html#examples-2"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="6.2.1" data-path="backdoor.html"><a href="backdoor.html#average-effect-of-treatment-on-the-treated-1"><i class="fa fa-check"></i><b>6.2.1</b> Average Effect of Treatment on the Treated</a></li>
<li class="chapter" data-level="6.2.2" data-path="backdoor.html"><a href="backdoor.html#standardization-with-a-parametric-exposure-model"><i class="fa fa-check"></i><b>6.2.2</b> Standardization with a Parametric Exposure Model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="backdoor.html"><a href="backdoor.html#doubly-robust-standardization"><i class="fa fa-check"></i><b>6.3</b> Doubly Robust Standardization</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="backdoor.html"><a href="backdoor.html#simulation"><i class="fa fa-check"></i><b>6.3.1</b> Simulation</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="errata.html"><a href="errata.html"><i class="fa fa-check"></i><b>A</b> Errata</a>
<ul>
<li class="chapter" data-level="A.1" data-path="errata.html"><a href="errata.html#preface"><i class="fa fa-check"></i><b>A.1</b> Preface</a></li>
<li class="chapter" data-level="A.2" data-path="errata.html"><a href="errata.html#chapter-1"><i class="fa fa-check"></i><b>A.2</b> Chapter 1</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="errata.html"><a href="errata.html#section-1.2.3.2-p.-11"><i class="fa fa-check"></i><b>A.2.1</b> Section 1.2.3.2, p. 11</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="errata.html"><a href="errata.html#chapter-2"><i class="fa fa-check"></i><b>A.3</b> Chapter 2</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="errata.html"><a href="errata.html#figure-2.1-p.-30"><i class="fa fa-check"></i><b>A.3.1</b> Figure 2.1, p. 30</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="errata.html"><a href="errata.html#chapter-3"><i class="fa fa-check"></i><b>A.4</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="errata.html"><a href="errata.html#typography-section-3.2-p.-40-equation-3.1"><i class="fa fa-check"></i><b>A.4.1</b> Typography: section 3.2 p. 40, equation 3.1</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="errata.html"><a href="errata.html#chapter-4"><i class="fa fa-check"></i><b>A.5</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="errata.html"><a href="errata.html#section-4.1-p.-67-on-top"><i class="fa fa-check"></i><b>A.5.1</b> Section 4.1 p. 67 (on top)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="errata.html"><a href="errata.html#chapter-5"><i class="fa fa-check"></i><b>A.6</b> Chapter 5</a></li>
<li class="chapter" data-level="A.7" data-path="errata.html"><a href="errata.html#chapter-6"><i class="fa fa-check"></i><b>A.7</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="errata.html"><a href="errata.html#section-6.1-p.-100-first-paragraph"><i class="fa fa-check"></i><b>A.7.1</b> Section 6.1 p. 100, first paragraph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>B</b> Notes</a>
<ul>
<li class="chapter" data-level="B.1" data-path="notes.html"><a href="notes.html#chapter-2-1"><i class="fa fa-check"></i><b>B.1</b> Chapter 2</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="notes.html"><a href="notes.html#section-2.4-p.-31"><i class="fa fa-check"></i><b>B.1.1</b> section 2.4 p. 31</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="notes.html"><a href="notes.html#chapter-4-1"><i class="fa fa-check"></i><b>B.2</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="notes.html"><a href="notes.html#section-4.1"><i class="fa fa-check"></i><b>B.2.1</b> Section 4.1</a></li>
<li class="chapter" data-level="B.2.2" data-path="notes.html"><a href="notes.html#section-4.2"><i class="fa fa-check"></i><b>B.2.2</b> Section 4.2</a></li>
<li class="chapter" data-level="B.2.3" data-path="notes.html"><a href="notes.html#exercises-5"><i class="fa fa-check"></i><b>B.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="notes.html"><a href="notes.html#chapter-6-1"><i class="fa fa-check"></i><b>B.3</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="notes.html"><a href="notes.html#section-6.1.1-att"><i class="fa fa-check"></i><b>B.3.1</b> Section 6.1.1 ATT</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>C</b> Functions</a>
<ul>
<li class="chapter" data-level="C.1" data-path="functions.html"><a href="functions.html#chapter-2-2"><i class="fa fa-check"></i><b>C.1</b> Chapter 2</a></li>
<li class="chapter" data-level="C.2" data-path="functions.html"><a href="functions.html#chapter-3-1"><i class="fa fa-check"></i><b>C.2</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="C.2.1" data-path="functions.html"><a href="functions.html#gt_measures.r"><i class="fa fa-check"></i><b>C.2.1</b> <code>gt_measures.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="functions.html"><a href="functions.html#chapter-4-2"><i class="fa fa-check"></i><b>C.3</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="C.3.1" data-path="functions.html"><a href="functions.html#gt_measures_modif.r"><i class="fa fa-check"></i><b>C.3.1</b> <code>gt_measures_modif.R</code></a></li>
<li class="chapter" data-level="C.3.2" data-path="functions.html"><a href="functions.html#ggp_measures_modif.r"><i class="fa fa-check"></i><b>C.3.2</b> <code>ggp_measures_modif.R</code></a></li>
<li class="chapter" data-level="C.3.3" data-path="functions.html"><a href="functions.html#mc_beta_effect_measures.r"><i class="fa fa-check"></i><b>C.3.3</b> <code>mc_beta_effect_measures.R</code></a></li>
<li class="chapter" data-level="C.3.4" data-path="functions.html"><a href="functions.html#ggp_venn_sim.r"><i class="fa fa-check"></i><b>C.3.4</b> <code>ggp_venn_sim.R</code></a></li>
<li class="chapter" data-level="C.3.5" data-path="functions.html"><a href="functions.html#ggp_betasim.r"><i class="fa fa-check"></i><b>C.3.5</b> <code>ggp_betasim.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="functions.html"><a href="functions.html#chapter-5-1"><i class="fa fa-check"></i><b>C.4</b> Chapter 5</a>
<ul>
<li class="chapter" data-level="C.4.1" data-path="functions.html"><a href="functions.html#ggp_dag.r"><i class="fa fa-check"></i><b>C.4.1</b> <code>ggp_dag.R</code></a></li>
<li class="chapter" data-level="C.4.2" data-path="functions.html"><a href="functions.html#gt_probs.r"><i class="fa fa-check"></i><b>C.4.2</b> <code>gt_probs.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.5" data-path="functions.html"><a href="functions.html#chapter-6-2"><i class="fa fa-check"></i><b>C.5</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="C.5.1" data-path="functions.html"><a href="functions.html#new_simdr"><i class="fa fa-check"></i><b>C.5.1</b> Doubly Robust Standardization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study project: Fundamentals of Causal Inferences With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1" number="9">
<h1><span class="header-section-number">C</span> Functions</h1>
<p>All the scripts for the functions below can be found at
<a href="https://github.com/FrankLef/FundamentalsCausalInference">study project</a>, mostly in the
<code>/lib</code> folder.</p>
<p>The functions are shown in order of appearance in the chapter where they are
first used.</p>
<div id="chapter-2-2" class="section level2" number="9.1">
<h2><span class="header-section-number">C.1</span> Chapter 2</h2>
<p>The file <code>boot_utils</code> includes several utility functions used by the bootstrapping
functions.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="functions.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the effect measures</span></span>
<span id="cb289-2"><a href="functions.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-3"><a href="functions.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the effect measures.</span></span>
<span id="cb289-4"><a href="functions.html#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-5"><a href="functions.html#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the effect measures and put them in a named numeric() vector.</span></span>
<span id="cb289-6"><a href="functions.html#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-7"><a href="functions.html#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param val0 Numeric, base value</span></span>
<span id="cb289-8"><a href="functions.html#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param val1 Numeric, treated value</span></span>
<span id="cb289-9"><a href="functions.html#cb289-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param log If TRUE (default) compute the effect measures on the log scale. </span></span>
<span id="cb289-10"><a href="functions.html#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; If FALSE compute the effect measures on the natural scale.</span></span>
<span id="cb289-11"><a href="functions.html#cb289-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The risk difference measure (RD) is always on the natural scale.</span></span>
<span id="cb289-12"><a href="functions.html#cb289-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-13"><a href="functions.html#cb289-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Named numeric vector.</span></span>
<span id="cb289-14"><a href="functions.html#cb289-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb289-15"><a href="functions.html#cb289-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-16"><a href="functions.html#cb289-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb289-17"><a href="functions.html#cb289-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; val0 &lt;- 0.25</span></span>
<span id="cb289-18"><a href="functions.html#cb289-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; val1 &lt;- 0.5</span></span>
<span id="cb289-19"><a href="functions.html#cb289-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; when log is required, we use default value</span></span>
<span id="cb289-20"><a href="functions.html#cb289-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; out &lt;- calc_effect_measures(val0, val1)</span></span>
<span id="cb289-21"><a href="functions.html#cb289-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stopifnot(all(is.finite(out)))</span></span>
<span id="cb289-22"><a href="functions.html#cb289-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; when natural scale is required, we use log = FALSE</span></span>
<span id="cb289-23"><a href="functions.html#cb289-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; out &lt;- calc_effect_measures(val0, val1, log = FALSE)</span></span>
<span id="cb289-24"><a href="functions.html#cb289-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stopifnot(all(is.finite(out)))</span></span>
<span id="cb289-25"><a href="functions.html#cb289-25" aria-hidden="true" tabindex="-1"></a>calc_effect_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(val0, val1, <span class="at">log =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb289-26"><a href="functions.html#cb289-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># both values must be finite</span></span>
<span id="cb289-27"><a href="functions.html#cb289-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.finite</span>(val0), <span class="fu">is.finite</span>(val1))</span>
<span id="cb289-28"><a href="functions.html#cb289-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-29"><a href="functions.html#cb289-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a vector of names used later when creating output</span></span>
<span id="cb289-30"><a href="functions.html#cb289-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this trick does not work on unamed variables (next step)</span></span>
<span id="cb289-31"><a href="functions.html#cb289-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># so it must be done now.</span></span>
<span id="cb289-32"><a href="functions.html#cb289-32" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">deparse1</span>(<span class="fu">substitute</span>(val0)), <span class="fu">deparse1</span>(<span class="fu">substitute</span>(val1)))</span>
<span id="cb289-33"><a href="functions.html#cb289-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure the values are unnamed</span></span>
<span id="cb289-34"><a href="functions.html#cb289-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># otherwise their names get combined with the new ones</span></span>
<span id="cb289-35"><a href="functions.html#cb289-35" aria-hidden="true" tabindex="-1"></a>  val0 <span class="ot">&lt;-</span> <span class="fu">unname</span>(val0)</span>
<span id="cb289-36"><a href="functions.html#cb289-36" aria-hidden="true" tabindex="-1"></a>  val1 <span class="ot">&lt;-</span> <span class="fu">unname</span>(val1)</span>
<span id="cb289-37"><a href="functions.html#cb289-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-38"><a href="functions.html#cb289-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only val0 required not to be zero</span></span>
<span id="cb289-39"><a href="functions.html#cb289-39" aria-hidden="true" tabindex="-1"></a>  va0_not_zero <span class="ot">&lt;-</span> <span class="sc">!</span>dplyr<span class="sc">::</span><span class="fu">near</span>(val0, <span class="dv">0</span>)</span>
<span id="cb289-40"><a href="functions.html#cb289-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># either values cannot be zero</span></span>
<span id="cb289-41"><a href="functions.html#cb289-41" aria-hidden="true" tabindex="-1"></a>  both_not_zero <span class="ot">&lt;-</span> va0_not_zero <span class="sc">&amp;</span> <span class="sc">!</span>dplyr<span class="sc">::</span><span class="fu">near</span>(val1, <span class="dv">0</span>)</span>
<span id="cb289-42"><a href="functions.html#cb289-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># almost positivity assumtion: both values must be &gt;= zero but &lt; 1</span></span>
<span id="cb289-43"><a href="functions.html#cb289-43" aria-hidden="true" tabindex="-1"></a>  both_gte_zero_lt_1 <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">&lt;=</span> val0 <span class="sc">&amp;</span> val0 <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;=</span> val1 <span class="sc">&amp;</span> val1 <span class="sc">&lt;</span> <span class="dv">1</span></span>
<span id="cb289-44"><a href="functions.html#cb289-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the positivity assumption is required for both values</span></span>
<span id="cb289-45"><a href="functions.html#cb289-45" aria-hidden="true" tabindex="-1"></a>  is_positivity <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">&lt;</span> val0 <span class="sc">&amp;</span> val0 <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> val1 <span class="sc">&amp;</span> val1 <span class="sc">&lt;</span> <span class="dv">1</span></span>
<span id="cb289-46"><a href="functions.html#cb289-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-47"><a href="functions.html#cb289-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Risk Difference</span></span>
<span id="cb289-48"><a href="functions.html#cb289-48" aria-hidden="true" tabindex="-1"></a>  RD <span class="ot">&lt;-</span> val1 <span class="sc">-</span> val0</span>
<span id="cb289-49"><a href="functions.html#cb289-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-50"><a href="functions.html#cb289-50" aria-hidden="true" tabindex="-1"></a>  RR <span class="ot">&lt;-</span> <span class="cn">NA_real_</span>  <span class="co"># Risk Ratio</span></span>
<span id="cb289-51"><a href="functions.html#cb289-51" aria-hidden="true" tabindex="-1"></a>  RRstar <span class="ot">&lt;-</span> <span class="cn">NA_real_</span>  <span class="co"># Other Risk Ratio</span></span>
<span id="cb289-52"><a href="functions.html#cb289-52" aria-hidden="true" tabindex="-1"></a>  OR <span class="ot">&lt;-</span> <span class="cn">NA_real_</span>  <span class="co"># Odds Ratio</span></span>
<span id="cb289-53"><a href="functions.html#cb289-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (log) {</span>
<span id="cb289-54"><a href="functions.html#cb289-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (both_not_zero) RR <span class="ot">&lt;-</span> <span class="fu">log</span>(val1) <span class="sc">-</span> <span class="fu">log</span>(val0)</span>
<span id="cb289-55"><a href="functions.html#cb289-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (both_gte_zero_lt_1) RRstar <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> val0) <span class="sc">-</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> val1)</span>
<span id="cb289-56"><a href="functions.html#cb289-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_positivity) OR <span class="ot">&lt;-</span> <span class="fu">log</span>(val1 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> val1)) <span class="sc">-</span> <span class="fu">log</span>(val0 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> val0))</span>
<span id="cb289-57"><a href="functions.html#cb289-57" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> RD, <span class="st">&quot;logRR&quot;</span> <span class="ot">=</span> RR, <span class="st">&quot;logRR*&quot;</span> <span class="ot">=</span> RRstar, <span class="st">&quot;logOR&quot;</span> <span class="ot">=</span> OR)</span>
<span id="cb289-58"><a href="functions.html#cb289-58" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb289-59"><a href="functions.html#cb289-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (va0_not_zero) RR <span class="ot">&lt;-</span> val1 <span class="sc">/</span> val0</span>
<span id="cb289-60"><a href="functions.html#cb289-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (both_gte_zero_lt_1) RRstar <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> val0) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> val1)</span>
<span id="cb289-61"><a href="functions.html#cb289-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_positivity) OR <span class="ot">&lt;-</span> (val1 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> val1)) <span class="sc">/</span> (val0 <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> val0))</span>
<span id="cb289-62"><a href="functions.html#cb289-62" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> RD, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> RR, <span class="st">&quot;RR*&quot;</span> <span class="ot">=</span> RRstar, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> OR)</span>
<span id="cb289-63"><a href="functions.html#cb289-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb289-64"><a href="functions.html#cb289-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-65"><a href="functions.html#cb289-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output only the measures that were calculated</span></span>
<span id="cb289-66"><a href="functions.html#cb289-66" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> out[<span class="sc">!</span><span class="fu">is.na</span>(out)]</span>
<span id="cb289-67"><a href="functions.html#cb289-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-68"><a href="functions.html#cb289-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vector of named input values</span></span>
<span id="cb289-69"><a href="functions.html#cb289-69" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> <span class="fu">c</span>(val0, val1)</span>
<span id="cb289-70"><a href="functions.html#cb289-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(vals) <span class="ot">&lt;-</span> nms</span>
<span id="cb289-71"><a href="functions.html#cb289-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-72"><a href="functions.html#cb289-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(vals, out)</span>
<span id="cb289-73"><a href="functions.html#cb289-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb289-74"><a href="functions.html#cb289-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-75"><a href="functions.html#cb289-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-76"><a href="functions.html#cb289-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bootstrap and generate a dataframe of estimates with CI</span></span>
<span id="cb289-77"><a href="functions.html#cb289-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-78"><a href="functions.html#cb289-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bootstrap and generate a dataframe of estimates with CI.</span></span>
<span id="cb289-79"><a href="functions.html#cb289-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-80"><a href="functions.html#cb289-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a dataframe of estimates with the columns </span></span>
<span id="cb289-81"><a href="functions.html#cb289-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \code{c(&quot;est&quot;, &quot;conf&quot;, &quot;lci&quot;, &quot;uci&quot;)}.</span></span>
<span id="cb289-82"><a href="functions.html#cb289-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-83"><a href="functions.html#cb289-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param data Dataframe of raw data.</span></span>
<span id="cb289-84"><a href="functions.html#cb289-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param statistic Function applied to data by bootstrapping.</span></span>
<span id="cb289-85"><a href="functions.html#cb289-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param R Number of bootstrap replicates. Default is 1000.</span></span>
<span id="cb289-86"><a href="functions.html#cb289-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param conf Confidence interval width. Default is 0.95.</span></span>
<span id="cb289-87"><a href="functions.html#cb289-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-88"><a href="functions.html#cb289-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Dataframe of estimates with CI.</span></span>
<span id="cb289-89"><a href="functions.html#cb289-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb289-90"><a href="functions.html#cb289-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-91"><a href="functions.html#cb289-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb289-92"><a href="functions.html#cb289-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb289-93"><a href="functions.html#cb289-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb289-94"><a href="functions.html#cb289-94" aria-hidden="true" tabindex="-1"></a>run_boot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, statistic, <span class="at">R =</span> <span class="dv">1000</span>, <span class="at">conf =</span> <span class="fl">0.95</span>) {</span>
<span id="cb289-95"><a href="functions.html#cb289-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(R <span class="sc">&gt;=</span> <span class="dv">1</span>, conf <span class="sc">&gt;</span> <span class="dv">0</span>, conf <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb289-96"><a href="functions.html#cb289-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-97"><a href="functions.html#cb289-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run the bootstrapping</span></span>
<span id="cb289-98"><a href="functions.html#cb289-98" aria-hidden="true" tabindex="-1"></a>  boot.out <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(<span class="at">data =</span> data, <span class="at">statistic =</span> statistic, <span class="at">R =</span> R)</span>
<span id="cb289-99"><a href="functions.html#cb289-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-100"><a href="functions.html#cb289-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the estimated values and confidence intervals from the boot object</span></span>
<span id="cb289-101"><a href="functions.html#cb289-101" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(boot.out<span class="sc">$</span>t0), <span class="at">FUN =</span> <span class="cf">function</span>(i) {</span>
<span id="cb289-102"><a href="functions.html#cb289-102" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> boot.out<span class="sc">$</span>t0[i]</span>
<span id="cb289-103"><a href="functions.html#cb289-103" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot.out, <span class="at">conf =</span> conf, <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>, <span class="at">index =</span> i)<span class="sc">$</span>normal</span>
<span id="cb289-104"><a href="functions.html#cb289-104" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(est, ci)</span>
<span id="cb289-105"><a href="functions.html#cb289-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;conf&quot;</span>, <span class="st">&quot;lci&quot;</span>, <span class="st">&quot;uci&quot;</span>)</span>
<span id="cb289-106"><a href="functions.html#cb289-106" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb289-107"><a href="functions.html#cb289-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb289-108"><a href="functions.html#cb289-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb289-109"><a href="functions.html#cb289-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the dataframe to hold the results</span></span>
<span id="cb289-110"><a href="functions.html#cb289-110" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(out))</span>
<span id="cb289-111"><a href="functions.html#cb289-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the first column as the names of the results</span></span>
<span id="cb289-112"><a href="functions.html#cb289-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">names</span>(boot.out<span class="sc">$</span>t0), out)</span>
<span id="cb289-113"><a href="functions.html#cb289-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb289-114"><a href="functions.html#cb289-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-115"><a href="functions.html#cb289-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-116"><a href="functions.html#cb289-116" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Exponentiate the effect measures</span></span>
<span id="cb289-117"><a href="functions.html#cb289-117" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-118"><a href="functions.html#cb289-118" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Exponentiate the effect measures.</span></span>
<span id="cb289-119"><a href="functions.html#cb289-119" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-120"><a href="functions.html#cb289-120" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Exponentiate each selected measure in the dataframe and replace its name</span></span>
<span id="cb289-121"><a href="functions.html#cb289-121" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; accordingly.</span></span>
<span id="cb289-122"><a href="functions.html#cb289-122" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-123"><a href="functions.html#cb289-123" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param data Dataframe.</span></span>
<span id="cb289-124"><a href="functions.html#cb289-124" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param vars Character() of measure names.</span></span>
<span id="cb289-125"><a href="functions.html#cb289-125" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-126"><a href="functions.html#cb289-126" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Dataframe of converted effects measures.</span></span>
<span id="cb289-127"><a href="functions.html#cb289-127" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb289-128"><a href="functions.html#cb289-128" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-129"><a href="functions.html#cb289-129" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb289-130"><a href="functions.html#cb289-130" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb289-131"><a href="functions.html#cb289-131" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb289-132"><a href="functions.html#cb289-132" aria-hidden="true" tabindex="-1"></a>exp_effects <span class="ot">&lt;-</span> <span class="cf">function</span>(data, </span>
<span id="cb289-133"><a href="functions.html#cb289-133" aria-hidden="true" tabindex="-1"></a>                        <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;RR&quot;</span> <span class="ot">=</span> <span class="st">&quot;logRR&quot;</span>,<span class="st">&quot;RR*&quot;</span>  <span class="ot">=</span> <span class="st">&quot;logRR*&quot;</span>, </span>
<span id="cb289-134"><a href="functions.html#cb289-134" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> <span class="st">&quot;logOR&quot;</span>)) {</span>
<span id="cb289-135"><a href="functions.html#cb289-135" aria-hidden="true" tabindex="-1"></a>  pos <span class="ot">&lt;-</span> <span class="fu">match</span>(vars, data<span class="sc">$</span>name)</span>
<span id="cb289-136"><a href="functions.html#cb289-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(data, {</span>
<span id="cb289-137"><a href="functions.html#cb289-137" aria-hidden="true" tabindex="-1"></a>    est[pos] <span class="ot">&lt;-</span> <span class="fu">exp</span>(est[pos])</span>
<span id="cb289-138"><a href="functions.html#cb289-138" aria-hidden="true" tabindex="-1"></a>    lci[pos] <span class="ot">&lt;-</span> <span class="fu">exp</span>(lci[pos])</span>
<span id="cb289-139"><a href="functions.html#cb289-139" aria-hidden="true" tabindex="-1"></a>    uci[pos] <span class="ot">&lt;-</span> <span class="fu">exp</span>(uci[pos])</span>
<span id="cb289-140"><a href="functions.html#cb289-140" aria-hidden="true" tabindex="-1"></a>    name[pos] <span class="ot">&lt;-</span> <span class="fu">names</span>(vars)</span>
<span id="cb289-141"><a href="functions.html#cb289-141" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb289-142"><a href="functions.html#cb289-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb289-143"><a href="functions.html#cb289-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-144"><a href="functions.html#cb289-144" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Inverse logit the effect measures</span></span>
<span id="cb289-145"><a href="functions.html#cb289-145" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-146"><a href="functions.html#cb289-146" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Inverse logit the effect measures.</span></span>
<span id="cb289-147"><a href="functions.html#cb289-147" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb289-148"><a href="functions.html#cb289-148" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Inverse logit each selected measure in the dataframe and replace its name</span></span>
<span id="cb289-149"><a href="functions.html#cb289-149" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; accordingly.</span></span>
<span id="cb289-150"><a href="functions.html#cb289-150" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-151"><a href="functions.html#cb289-151" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param data Dataframe.</span></span>
<span id="cb289-152"><a href="functions.html#cb289-152" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param vars Character() of measure names.</span></span>
<span id="cb289-153"><a href="functions.html#cb289-153" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-154"><a href="functions.html#cb289-154" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Dataframe of converted effects measures.</span></span>
<span id="cb289-155"><a href="functions.html#cb289-155" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb289-156"><a href="functions.html#cb289-156" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb289-157"><a href="functions.html#cb289-157" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb289-158"><a href="functions.html#cb289-158" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb289-159"><a href="functions.html#cb289-159" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb289-160"><a href="functions.html#cb289-160" aria-hidden="true" tabindex="-1"></a>invlogit_effects <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;P&quot;</span> <span class="ot">=</span> <span class="st">&quot;logitP&quot;</span>)) {</span>
<span id="cb289-161"><a href="functions.html#cb289-161" aria-hidden="true" tabindex="-1"></a>  pos <span class="ot">&lt;-</span> <span class="fu">match</span>(vars, data<span class="sc">$</span>name)</span>
<span id="cb289-162"><a href="functions.html#cb289-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>(data, {</span>
<span id="cb289-163"><a href="functions.html#cb289-163" aria-hidden="true" tabindex="-1"></a>    est[pos] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(est[pos])</span>
<span id="cb289-164"><a href="functions.html#cb289-164" aria-hidden="true" tabindex="-1"></a>    lci[pos] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(lci[pos])</span>
<span id="cb289-165"><a href="functions.html#cb289-165" aria-hidden="true" tabindex="-1"></a>    uci[pos] <span class="ot">&lt;-</span> <span class="fu">plogis</span>(uci[pos])</span>
<span id="cb289-166"><a href="functions.html#cb289-166" aria-hidden="true" tabindex="-1"></a>    name[pos] <span class="ot">&lt;-</span> <span class="fu">names</span>(vars)</span>
<span id="cb289-167"><a href="functions.html#cb289-167" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb289-168"><a href="functions.html#cb289-168" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The file <code>gt_utils</code> includes utility functions to formattables.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="functions.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Basic format of table created with \code{gt}</span></span>
<span id="cb290-2"><a href="functions.html#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb290-3"><a href="functions.html#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Basic format of table created with \code{gt}.</span></span>
<span id="cb290-4"><a href="functions.html#cb290-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb290-5"><a href="functions.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Format of table created with \code{gt} for the heading, row stripping,</span></span>
<span id="cb290-6"><a href="functions.html#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; source note, etc.</span></span>
<span id="cb290-7"><a href="functions.html#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb290-8"><a href="functions.html#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param tbl Object of class \code{gt_tbl}.</span></span>
<span id="cb290-9"><a href="functions.html#cb290-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title String. Table title.</span></span>
<span id="cb290-10"><a href="functions.html#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subtitle String. Table subtitle.</span></span>
<span id="cb290-11"><a href="functions.html#cb290-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb290-12"><a href="functions.html#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Formatted \code{gt_tbl} object.</span></span>
<span id="cb290-13"><a href="functions.html#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb290-14"><a href="functions.html#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb290-15"><a href="functions.html#cb290-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb290-16"><a href="functions.html#cb290-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb290-17"><a href="functions.html#cb290-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb290-18"><a href="functions.html#cb290-18" aria-hidden="true" tabindex="-1"></a>gt_basic <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, title, subtitle) {</span>
<span id="cb290-19"><a href="functions.html#cb290-19" aria-hidden="true" tabindex="-1"></a>  tbl <span class="sc">%&gt;%</span></span>
<span id="cb290-20"><a href="functions.html#cb290-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(</span>
<span id="cb290-21"><a href="functions.html#cb290-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">html</span>(<span class="fu">paste0</span>(<span class="st">&quot;&lt;strong&gt;&quot;</span>, title, <span class="st">&quot;&lt;/strong&gt;&quot;</span>)),</span>
<span id="cb290-22"><a href="functions.html#cb290-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="fu">paste0</span>(<span class="st">&quot;&lt;strong&gt;&quot;</span>, subtitle, <span class="st">&quot;&lt;/strong&gt;&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb290-23"><a href="functions.html#cb290-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">columns =</span> <span class="sc">!</span><span class="fu">matches</span>(<span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb290-24"><a href="functions.html#cb290-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">opt_row_striping</span>() <span class="sc">%&gt;%</span></span>
<span id="cb290-25"><a href="functions.html#cb290-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb290-26"><a href="functions.html#cb290-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>),</span>
<span id="cb290-27"><a href="functions.html#cb290-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_title</span>(<span class="at">groups =</span> <span class="st">&quot;title&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb290-28"><a href="functions.html#cb290-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb290-29"><a href="functions.html#cb290-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>),</span>
<span id="cb290-30"><a href="functions.html#cb290-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_title</span>(<span class="at">groups =</span> <span class="st">&quot;subtitle&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb290-31"><a href="functions.html#cb290-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_source_note</span>(</span>
<span id="cb290-32"><a href="functions.html#cb290-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">source_note =</span> <span class="st">&quot;Fundamentals of Causal Inference, Babette A. Brumback, 2022&quot;</span></span>
<span id="cb290-33"><a href="functions.html#cb290-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb290-34"><a href="functions.html#cb290-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_options</span>(</span>
<span id="cb290-35"><a href="functions.html#cb290-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.title.font.weight =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb290-36"><a href="functions.html#cb290-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.subtitle.font.weight =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb290-37"><a href="functions.html#cb290-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.background.color =</span> <span class="st">&quot;gainsboro&quot;</span>,</span>
<span id="cb290-38"><a href="functions.html#cb290-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">column_labels.font.weight =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb290-39"><a href="functions.html#cb290-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="chapter-3-1" class="section level2" number="9.2">
<h2><span class="header-section-number">C.2</span> Chapter 3</h2>
<div id="gt_measures.r" class="section level3" number="9.2.1">
<h3><span class="header-section-number">C.2.1</span> <code>gt_measures.R</code></h3>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="functions.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a table of effect measures with their CI</span></span>
<span id="cb291-2"><a href="functions.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb291-3"><a href="functions.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a table of effect measures with their CI.</span></span>
<span id="cb291-4"><a href="functions.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb291-5"><a href="functions.html#cb291-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The table will have 3 columns. The measure name, the estimates and the </span></span>
<span id="cb291-6"><a href="functions.html#cb291-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; confidence interval.</span></span>
<span id="cb291-7"><a href="functions.html#cb291-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb291-8"><a href="functions.html#cb291-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param df Dataframe of results</span></span>
<span id="cb291-9"><a href="functions.html#cb291-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param conf Numeric, confidence interval</span></span>
<span id="cb291-10"><a href="functions.html#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param digits Integer, number of digits to the right of the decimal.</span></span>
<span id="cb291-11"><a href="functions.html#cb291-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title The title of the table</span></span>
<span id="cb291-12"><a href="functions.html#cb291-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subtitle Subtitle of the table</span></span>
<span id="cb291-13"><a href="functions.html#cb291-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb291-14"><a href="functions.html#cb291-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A gt object create by the \code{gt} package</span></span>
<span id="cb291-15"><a href="functions.html#cb291-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb291-16"><a href="functions.html#cb291-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb291-17"><a href="functions.html#cb291-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb291-18"><a href="functions.html#cb291-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb291-19"><a href="functions.html#cb291-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb291-20"><a href="functions.html#cb291-20" aria-hidden="true" tabindex="-1"></a>gt_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">conf =</span> df<span class="sc">$</span>conf[<span class="dv">1</span>], <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb291-21"><a href="functions.html#cb291-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">title =</span> <span class="st">&quot;Title&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>) {</span>
<span id="cb291-22"><a href="functions.html#cb291-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb291-23"><a href="functions.html#cb291-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># confidence interval label used in footnote</span></span>
<span id="cb291-24"><a href="functions.html#cb291-24" aria-hidden="true" tabindex="-1"></a>  ci_label <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.0f%% confidence interval&quot;</span>, <span class="dv">100</span> <span class="sc">*</span> conf)</span>
<span id="cb291-25"><a href="functions.html#cb291-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb291-26"><a href="functions.html#cb291-26" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb291-27"><a href="functions.html#cb291-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, est, lci, uci) <span class="sc">%&gt;%</span></span>
<span id="cb291-28"><a href="functions.html#cb291-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">est =</span> <span class="fu">round</span>(est, digits),</span>
<span id="cb291-29"><a href="functions.html#cb291-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">lci =</span> <span class="fu">round</span>(lci, digits),</span>
<span id="cb291-30"><a href="functions.html#cb291-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">uci =</span> <span class="fu">round</span>(uci, digits),</span>
<span id="cb291-31"><a href="functions.html#cb291-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">ci =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, lci, <span class="st">&quot;, &quot;</span>, uci, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb291-32"><a href="functions.html#cb291-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">lci =</span> <span class="cn">NULL</span>,</span>
<span id="cb291-33"><a href="functions.html#cb291-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">uci =</span> <span class="cn">NULL</span>)</span>
<span id="cb291-34"><a href="functions.html#cb291-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb291-35"><a href="functions.html#cb291-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb291-36"><a href="functions.html#cb291-36" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>(df) <span class="sc">%&gt;%</span></span>
<span id="cb291-37"><a href="functions.html#cb291-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt_basic</span>(title, subtitle) <span class="sc">%&gt;%</span></span>
<span id="cb291-38"><a href="functions.html#cb291-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb291-39"><a href="functions.html#cb291-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">&quot;Measure&quot;</span>,</span>
<span id="cb291-40"><a href="functions.html#cb291-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">est =</span> <span class="st">&quot;Estimate&quot;</span>,</span>
<span id="cb291-41"><a href="functions.html#cb291-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci =</span> <span class="st">&quot;CI&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb291-42"><a href="functions.html#cb291-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_footnote</span>(</span>
<span id="cb291-43"><a href="functions.html#cb291-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">footnote =</span> ci_label,</span>
<span id="cb291-44"><a href="functions.html#cb291-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb291-45"><a href="functions.html#cb291-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb291-46"><a href="functions.html#cb291-46" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="chapter-4-2" class="section level2" number="9.3">
<h2><span class="header-section-number">C.3</span> Chapter 4</h2>
<div id="gt_measures_modif.r" class="section level3" number="9.3.1">
<h3><span class="header-section-number">C.3.1</span> <code>gt_measures_modif.R</code></h3>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="functions.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a table of effect-measure modifications with their CI</span></span>
<span id="cb292-2"><a href="functions.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb292-3"><a href="functions.html#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a table of effect-measure modifications with their CI.</span></span>
<span id="cb292-4"><a href="functions.html#cb292-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb292-5"><a href="functions.html#cb292-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The table will have 3 columns for each of the 2 strata and the</span></span>
<span id="cb292-6"><a href="functions.html#cb292-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; difference column. The measure name, the estimates and the </span></span>
<span id="cb292-7"><a href="functions.html#cb292-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; confidence interval.</span></span>
<span id="cb292-8"><a href="functions.html#cb292-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb292-9"><a href="functions.html#cb292-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param df Dataframe of results</span></span>
<span id="cb292-10"><a href="functions.html#cb292-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param conf Numeric, confidence interval</span></span>
<span id="cb292-11"><a href="functions.html#cb292-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param digits Integer, number of digits to the right of the decimal.</span></span>
<span id="cb292-12"><a href="functions.html#cb292-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title The title of the table</span></span>
<span id="cb292-13"><a href="functions.html#cb292-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subtitle Subtitle of the table</span></span>
<span id="cb292-14"><a href="functions.html#cb292-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb292-15"><a href="functions.html#cb292-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A gt object create by the \code{gt} package</span></span>
<span id="cb292-16"><a href="functions.html#cb292-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb292-17"><a href="functions.html#cb292-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb292-18"><a href="functions.html#cb292-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb292-19"><a href="functions.html#cb292-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb292-20"><a href="functions.html#cb292-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb292-21"><a href="functions.html#cb292-21" aria-hidden="true" tabindex="-1"></a>gt_measures_modif <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">conf =</span> df<span class="sc">$</span>conf[<span class="dv">1</span>], <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb292-22"><a href="functions.html#cb292-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">&quot;Title&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Effect-measure Modification&quot;</span>) {</span>
<span id="cb292-23"><a href="functions.html#cb292-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb292-24"><a href="functions.html#cb292-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># confidence interval label used in footnote</span></span>
<span id="cb292-25"><a href="functions.html#cb292-25" aria-hidden="true" tabindex="-1"></a>  ci_label <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.0f%% confidence interval&quot;</span>, <span class="dv">100</span> <span class="sc">*</span> conf)</span>
<span id="cb292-26"><a href="functions.html#cb292-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb292-27"><a href="functions.html#cb292-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare the dataframe to create the table</span></span>
<span id="cb292-28"><a href="functions.html#cb292-28" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb292-29"><a href="functions.html#cb292-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&quot;log.+&quot;</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb292-30"><a href="functions.html#cb292-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>conf) <span class="sc">%&gt;%</span></span>
<span id="cb292-31"><a href="functions.html#cb292-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">est =</span> <span class="fu">round</span>(est, <span class="at">digits =</span> digits),</span>
<span id="cb292-32"><a href="functions.html#cb292-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">lci =</span> <span class="fu">round</span>(lci, <span class="at">digits =</span> digits),</span>
<span id="cb292-33"><a href="functions.html#cb292-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">uci =</span> <span class="fu">round</span>(uci, <span class="at">digits =</span> digits)) <span class="sc">%&gt;%</span></span>
<span id="cb292-34"><a href="functions.html#cb292-34" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(est, lci, uci), <span class="at">names_to =</span> <span class="st">&quot;point&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-35"><a href="functions.html#cb292-35" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;stratum&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;[.]&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-36"><a href="functions.html#cb292-36" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unite</span>(<span class="at">col =</span> <span class="st">&quot;estimate&quot;</span>, stratum, point, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-37"><a href="functions.html#cb292-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;estimate&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-38"><a href="functions.html#cb292-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">M0_ci =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, M0_lci, <span class="st">&quot;, &quot;</span>, M0_uci, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb292-39"><a href="functions.html#cb292-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">M1_ci =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, M1_lci, <span class="st">&quot;, &quot;</span>, M1_uci, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb292-40"><a href="functions.html#cb292-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">diff_ci =</span> <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, diff_lci, <span class="st">&quot;, &quot;</span>, diff_uci, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb292-41"><a href="functions.html#cb292-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">M0_lci =</span> <span class="cn">NULL</span>, <span class="at">M0_uci =</span> <span class="cn">NULL</span>,</span>
<span id="cb292-42"><a href="functions.html#cb292-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">M1_lci =</span> <span class="cn">NULL</span>, <span class="at">M1_uci =</span> <span class="cn">NULL</span>,</span>
<span id="cb292-43"><a href="functions.html#cb292-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">diff_lci =</span> <span class="cn">NULL</span>, <span class="at">diff_uci =</span> <span class="cn">NULL</span>)</span>
<span id="cb292-44"><a href="functions.html#cb292-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb292-45"><a href="functions.html#cb292-45" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>(df, <span class="at">rowname_col =</span> <span class="st">&quot;name&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-46"><a href="functions.html#cb292-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt_basic</span>(title, subtitle) <span class="sc">%&gt;%</span></span>
<span id="cb292-47"><a href="functions.html#cb292-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_spanner_delim</span>(<span class="at">delim =</span> <span class="st">&quot;_&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">split =</span> <span class="st">&quot;last&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-48"><a href="functions.html#cb292-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb292-49"><a href="functions.html#cb292-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">&quot;Measure&quot;</span>,</span>
<span id="cb292-50"><a href="functions.html#cb292-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">M0_est =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">M0_ci =</span> <span class="st">&quot;CI&quot;</span>,</span>
<span id="cb292-51"><a href="functions.html#cb292-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">M1_est =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">M1_ci =</span> <span class="st">&quot;CI&quot;</span>,</span>
<span id="cb292-52"><a href="functions.html#cb292-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">diff_est =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="at">diff_ci =</span> <span class="st">&quot;CI&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb292-53"><a href="functions.html#cb292-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb292-54"><a href="functions.html#cb292-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_borders</span>(<span class="at">sides =</span> <span class="st">&quot;left&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey60&quot;</span>, </span>
<span id="cb292-55"><a href="functions.html#cb292-55" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weight =</span> <span class="fu">px</span>(<span class="fl">1.5</span>), <span class="at">style =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb292-56"><a href="functions.html#cb292-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;M1_est&quot;</span>, <span class="st">&quot;diff_est&quot;</span>))</span>
<span id="cb292-57"><a href="functions.html#cb292-57" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb292-58"><a href="functions.html#cb292-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb292-59"><a href="functions.html#cb292-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_borders</span>(<span class="at">sides =</span> <span class="st">&quot;left&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey60&quot;</span>, </span>
<span id="cb292-60"><a href="functions.html#cb292-60" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weight =</span> <span class="fu">px</span>(<span class="fl">1.5</span>), <span class="at">style =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb292-61"><a href="functions.html#cb292-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;M1_est&quot;</span>, <span class="st">&quot;diff_est&quot;</span>))</span>
<span id="cb292-62"><a href="functions.html#cb292-62" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb292-63"><a href="functions.html#cb292-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_footnote</span>(</span>
<span id="cb292-64"><a href="functions.html#cb292-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">footnote =</span> ci_label,</span>
<span id="cb292-65"><a href="functions.html#cb292-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;M0_ci&quot;</span>, <span class="st">&quot;M1_ci&quot;</span>, <span class="st">&quot;diff_ci&quot;</span>))</span>
<span id="cb292-66"><a href="functions.html#cb292-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb292-67"><a href="functions.html#cb292-67" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ggp_measures_modif.r" class="section level3" number="9.3.2">
<h3><span class="header-section-number">C.3.2</span> <code>ggp_measures_modif.R</code></h3>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="functions.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a plot of effect-measures modifications</span></span>
<span id="cb293-2"><a href="functions.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb293-3"><a href="functions.html#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a plot of effect-measures modifications</span></span>
<span id="cb293-4"><a href="functions.html#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb293-5"><a href="functions.html#cb293-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create a plot of effect-measures modifications. The measures are shoen</span></span>
<span id="cb293-6"><a href="functions.html#cb293-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as solid lines. The actual effects are shown in dashed lines</span></span>
<span id="cb293-7"><a href="functions.html#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb293-8"><a href="functions.html#cb293-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param df Dataframe to plot</span></span>
<span id="cb293-9"><a href="functions.html#cb293-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title Title of the plot</span></span>
<span id="cb293-10"><a href="functions.html#cb293-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb293-11"><a href="functions.html#cb293-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A ggplot object</span></span>
<span id="cb293-12"><a href="functions.html#cb293-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb293-13"><a href="functions.html#cb293-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb293-14"><a href="functions.html#cb293-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb293-15"><a href="functions.html#cb293-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb293-16"><a href="functions.html#cb293-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb293-17"><a href="functions.html#cb293-17" aria-hidden="true" tabindex="-1"></a>ggp_measures_modif <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">title =</span> <span class="st">&quot;Change in effect measures&quot;</span>,</span>
<span id="cb293-18"><a href="functions.html#cb293-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">subtitle =</span> <span class="st">&quot;Effect-Measure Modification and Statistical Interaction&quot;</span>) {</span>
<span id="cb293-19"><a href="functions.html#cb293-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare the dataframe used to pcreate the plot</span></span>
<span id="cb293-20"><a href="functions.html#cb293-20" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb293-21"><a href="functions.html#cb293-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&quot;log.+&quot;</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb293-22"><a href="functions.html#cb293-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>conf) <span class="sc">%&gt;%</span></span>
<span id="cb293-23"><a href="functions.html#cb293-23" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;stratum&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;[.]&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb293-24"><a href="functions.html#cb293-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(stratum <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb293-25"><a href="functions.html#cb293-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb293-26"><a href="functions.html#cb293-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the plot</span></span>
<span id="cb293-27"><a href="functions.html#cb293-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, </span>
<span id="cb293-28"><a href="functions.html#cb293-28" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> stratum, <span class="at">y =</span> est, <span class="at">color =</span> name, <span class="at">linetype =</span> name, <span class="at">group =</span> name)) <span class="sc">+</span></span>
<span id="cb293-29"><a href="functions.html#cb293-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb293-30"><a href="functions.html#cb293-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> name), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb293-31"><a href="functions.html#cb293-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(est, <span class="dv">1</span>)),</span>
<span id="cb293-32"><a href="functions.html#cb293-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">nudge_x =</span> <span class="fl">0.05</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb293-33"><a href="functions.html#cb293-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> <span class="st">&quot;dashed&quot;</span>, <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb293-34"><a href="functions.html#cb293-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;RD&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, </span>
<span id="cb293-35"><a href="functions.html#cb293-35" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;RR*&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>)) <span class="sc">+</span></span>
<span id="cb293-36"><a href="functions.html#cb293-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb293-37"><a href="functions.html#cb293-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb293-38"><a href="functions.html#cb293-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb293-39"><a href="functions.html#cb293-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">subtitle =</span> subtitle, <span class="at">y =</span> <span class="st">&quot;estimated expected value&quot;</span>)</span>
<span id="cb293-40"><a href="functions.html#cb293-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mc_beta_effect_measures.r" class="section level3" number="9.3.3">
<h3><span class="header-section-number">C.3.3</span> <code>mc_beta_effect_measures.R</code></h3>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="functions.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Monte Carlo Sim of Effect Measures using the Beta distribution</span></span>
<span id="cb294-2"><a href="functions.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb294-3"><a href="functions.html#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Monte Carlo Sim of Effect Measures using the Beta distribution.</span></span>
<span id="cb294-4"><a href="functions.html#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb294-5"><a href="functions.html#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Perform a Monte Carlo simulation of effect measures using a grid</span></span>
<span id="cb294-6"><a href="functions.html#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of \code{shape1} and \code{shape2} parameters. See the `rbeta()` function</span></span>
<span id="cb294-7"><a href="functions.html#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for more details</span></span>
<span id="cb294-8"><a href="functions.html#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb294-9"><a href="functions.html#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param shape1_prms Vector of shape 2 parameter for the `rbeta` function</span></span>
<span id="cb294-10"><a href="functions.html#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param shape2_prms Vector of shape 2 parameter for the `rbeta` function</span></span>
<span id="cb294-11"><a href="functions.html#cb294-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nrep Nb of repetitions</span></span>
<span id="cb294-12"><a href="functions.html#cb294-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param constrained Logical. If \code{FALSE} the data is not constrained.</span></span>
<span id="cb294-13"><a href="functions.html#cb294-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Otherwise it is constrained. That is when \code{RR0} and \code{RR1} are on</span></span>
<span id="cb294-14"><a href="functions.html#cb294-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different sides of 1, the data point is excluded.</span></span>
<span id="cb294-15"><a href="functions.html#cb294-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb294-16"><a href="functions.html#cb294-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return List of matrices. One per event of effect measure.</span></span>
<span id="cb294-17"><a href="functions.html#cb294-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb294-18"><a href="functions.html#cb294-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb294-19"><a href="functions.html#cb294-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb294-20"><a href="functions.html#cb294-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb294-21"><a href="functions.html#cb294-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb294-22"><a href="functions.html#cb294-22" aria-hidden="true" tabindex="-1"></a>mc_beta_effect_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1_prms =</span> <span class="dv">1</span>, <span class="at">shape2_prms =</span> <span class="dv">1</span>, <span class="at">nrep =</span> <span class="dv">5000</span>, </span>
<span id="cb294-23"><a href="functions.html#cb294-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">constrained =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb294-24"><a href="functions.html#cb294-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(nrep <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb294-25"><a href="functions.html#cb294-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the shape parameters must be &gt;= 0.5 to maintain</span></span>
<span id="cb294-26"><a href="functions.html#cb294-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the positivity assumption</span></span>
<span id="cb294-27"><a href="functions.html#cb294-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(shape1_prms <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="fu">all</span>(shape2_prms <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb294-28"><a href="functions.html#cb294-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-29"><a href="functions.html#cb294-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the function used by Monte Carlo for each parameter in the grid</span></span>
<span id="cb294-30"><a href="functions.html#cb294-30" aria-hidden="true" tabindex="-1"></a>  calc_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(shape1, shape2) {</span>
<span id="cb294-31"><a href="functions.html#cb294-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-32"><a href="functions.html#cb294-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the random sample from beta distribution</span></span>
<span id="cb294-33"><a href="functions.html#cb294-33" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2)</span>
<span id="cb294-34"><a href="functions.html#cb294-34" aria-hidden="true" tabindex="-1"></a>    EY_T0_M0 <span class="ot">&lt;-</span> s[<span class="dv">1</span>]</span>
<span id="cb294-35"><a href="functions.html#cb294-35" aria-hidden="true" tabindex="-1"></a>    EY_T1_M0 <span class="ot">&lt;-</span> s[<span class="dv">2</span>]</span>
<span id="cb294-36"><a href="functions.html#cb294-36" aria-hidden="true" tabindex="-1"></a>    EY_T0_M1 <span class="ot">&lt;-</span> s[<span class="dv">3</span>]</span>
<span id="cb294-37"><a href="functions.html#cb294-37" aria-hidden="true" tabindex="-1"></a>    EY_T1_M1 <span class="ot">&lt;-</span> s[<span class="dv">4</span>]</span>
<span id="cb294-38"><a href="functions.html#cb294-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-39"><a href="functions.html#cb294-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># IMPORTANT: Make sure the positivity assumption is met.</span></span>
<span id="cb294-40"><a href="functions.html#cb294-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(EY_T0_M0 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T0_M0 <span class="sc">&lt;</span> <span class="dv">1</span>, EY_T1_M0 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T1_M0 <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb294-41"><a href="functions.html#cb294-41" aria-hidden="true" tabindex="-1"></a>              EY_T0_M1 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T0_M1 <span class="sc">&lt;</span> <span class="dv">1</span>, EY_T1_M1 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T1_M1 <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb294-42"><a href="functions.html#cb294-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-43"><a href="functions.html#cb294-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute the effect measures</span></span>
<span id="cb294-44"><a href="functions.html#cb294-44" aria-hidden="true" tabindex="-1"></a>    RD0 <span class="ot">&lt;-</span> EY_T1_M0 <span class="sc">-</span> EY_T0_M0</span>
<span id="cb294-45"><a href="functions.html#cb294-45" aria-hidden="true" tabindex="-1"></a>    RD1 <span class="ot">&lt;-</span> EY_T1_M1 <span class="sc">-</span> EY_T0_M1</span>
<span id="cb294-46"><a href="functions.html#cb294-46" aria-hidden="true" tabindex="-1"></a>    RR0 <span class="ot">&lt;-</span> EY_T1_M0 <span class="sc">/</span> EY_T0_M0</span>
<span id="cb294-47"><a href="functions.html#cb294-47" aria-hidden="true" tabindex="-1"></a>    RR1 <span class="ot">&lt;-</span> EY_T1_M1 <span class="sc">/</span> EY_T0_M1</span>
<span id="cb294-48"><a href="functions.html#cb294-48" aria-hidden="true" tabindex="-1"></a>    RR0star <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T0_M0) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T1_M0)</span>
<span id="cb294-49"><a href="functions.html#cb294-49" aria-hidden="true" tabindex="-1"></a>    RR1star <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T0_M1) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T1_M1)</span>
<span id="cb294-50"><a href="functions.html#cb294-50" aria-hidden="true" tabindex="-1"></a>    OR0 <span class="ot">&lt;-</span> RR0 <span class="sc">*</span> RR0star</span>
<span id="cb294-51"><a href="functions.html#cb294-51" aria-hidden="true" tabindex="-1"></a>    OR1 <span class="ot">&lt;-</span> RR1 <span class="sc">*</span> RR1star</span>
<span id="cb294-52"><a href="functions.html#cb294-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-53"><a href="functions.html#cb294-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># How did the measures change with the modifier?</span></span>
<span id="cb294-54"><a href="functions.html#cb294-54" aria-hidden="true" tabindex="-1"></a>    RD <span class="ot">&lt;-</span> <span class="fu">sign</span>(RD1 <span class="sc">-</span> RD0)</span>
<span id="cb294-55"><a href="functions.html#cb294-55" aria-hidden="true" tabindex="-1"></a>    RR <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR1 <span class="sc">-</span> RR0)</span>
<span id="cb294-56"><a href="functions.html#cb294-56" aria-hidden="true" tabindex="-1"></a>    RRstar <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR1star <span class="sc">-</span> RR0star)</span>
<span id="cb294-57"><a href="functions.html#cb294-57" aria-hidden="true" tabindex="-1"></a>    OR <span class="ot">&lt;-</span> <span class="fu">sign</span>(OR1 <span class="sc">-</span> OR0)</span>
<span id="cb294-58"><a href="functions.html#cb294-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-59"><a href="functions.html#cb294-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We want to know if the various subsets of the four causal measures would</span></span>
<span id="cb294-60"><a href="functions.html#cb294-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># agree (i.e. change together from one stratum to the other)</span></span>
<span id="cb294-61"><a href="functions.html#cb294-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-62"><a href="functions.html#cb294-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 pair only</span></span>
<span id="cb294-63"><a href="functions.html#cb294-63" aria-hidden="true" tabindex="-1"></a>    RD_RR <span class="ot">&lt;-</span> </span>
<span id="cb294-64"><a href="functions.html#cb294-64" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-65"><a href="functions.html#cb294-65" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-66"><a href="functions.html#cb294-66" aria-hidden="true" tabindex="-1"></a>    RD_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb294-67"><a href="functions.html#cb294-67" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-68"><a href="functions.html#cb294-68" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-69"><a href="functions.html#cb294-69" aria-hidden="true" tabindex="-1"></a>    RD_OR <span class="ot">&lt;-</span></span>
<span id="cb294-70"><a href="functions.html#cb294-70" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-71"><a href="functions.html#cb294-71" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-72"><a href="functions.html#cb294-72" aria-hidden="true" tabindex="-1"></a>    RR_RRstar <span class="ot">&lt;-</span></span>
<span id="cb294-73"><a href="functions.html#cb294-73" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-74"><a href="functions.html#cb294-74" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-75"><a href="functions.html#cb294-75" aria-hidden="true" tabindex="-1"></a>    RR_OR <span class="ot">&lt;-</span></span>
<span id="cb294-76"><a href="functions.html#cb294-76" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-77"><a href="functions.html#cb294-77" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-78"><a href="functions.html#cb294-78" aria-hidden="true" tabindex="-1"></a>    RRstar_OR <span class="ot">&lt;-</span></span>
<span id="cb294-79"><a href="functions.html#cb294-79" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-80"><a href="functions.html#cb294-80" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb294-81"><a href="functions.html#cb294-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 pairs not being 3-wise</span></span>
<span id="cb294-82"><a href="functions.html#cb294-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># called &quot;Opposite pairwise events&quot;</span></span>
<span id="cb294-83"><a href="functions.html#cb294-83" aria-hidden="true" tabindex="-1"></a>    RD_RR_vs_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-84"><a href="functions.html#cb294-84" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-85"><a href="functions.html#cb294-85" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb294-86"><a href="functions.html#cb294-86" aria-hidden="true" tabindex="-1"></a>    RD_RRstar_vs_RR_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-87"><a href="functions.html#cb294-87" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-88"><a href="functions.html#cb294-88" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-89"><a href="functions.html#cb294-89" aria-hidden="true" tabindex="-1"></a>    RD_OR_vs_RR_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb294-90"><a href="functions.html#cb294-90" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-91"><a href="functions.html#cb294-91" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-92"><a href="functions.html#cb294-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3-wise</span></span>
<span id="cb294-93"><a href="functions.html#cb294-93" aria-hidden="true" tabindex="-1"></a>    RD_RR_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb294-94"><a href="functions.html#cb294-94" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-95"><a href="functions.html#cb294-95" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-96"><a href="functions.html#cb294-96" aria-hidden="true" tabindex="-1"></a>    RD_RR_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-97"><a href="functions.html#cb294-97" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-98"><a href="functions.html#cb294-98" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-99"><a href="functions.html#cb294-99" aria-hidden="true" tabindex="-1"></a>    RD_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-100"><a href="functions.html#cb294-100" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-101"><a href="functions.html#cb294-101" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb294-102"><a href="functions.html#cb294-102" aria-hidden="true" tabindex="-1"></a>    RR_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-103"><a href="functions.html#cb294-103" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-104"><a href="functions.html#cb294-104" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb294-105"><a href="functions.html#cb294-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4-wise</span></span>
<span id="cb294-106"><a href="functions.html#cb294-106" aria-hidden="true" tabindex="-1"></a>    RD_RR_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb294-107"><a href="functions.html#cb294-107" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-108"><a href="functions.html#cb294-108" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb294-109"><a href="functions.html#cb294-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All measures move in different directions</span></span>
<span id="cb294-110"><a href="functions.html#cb294-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is an impossible event and represent the empty set</span></span>
<span id="cb294-111"><a href="functions.html#cb294-111" aria-hidden="true" tabindex="-1"></a>    NONE <span class="ot">&lt;-</span> </span>
<span id="cb294-112"><a href="functions.html#cb294-112" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb294-113"><a href="functions.html#cb294-113" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb294-114"><a href="functions.html#cb294-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-115"><a href="functions.html#cb294-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the output list</span></span>
<span id="cb294-116"><a href="functions.html#cb294-116" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;RD_RR&quot;</span> <span class="ot">=</span> RD_RR, <span class="st">&quot;RD_RRstar&quot;</span> <span class="ot">=</span> RD_RRstar, <span class="st">&quot;RD_OR&quot;</span> <span class="ot">=</span> RD_OR, </span>
<span id="cb294-117"><a href="functions.html#cb294-117" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RR_RRstar&quot;</span> <span class="ot">=</span> RR_RRstar, <span class="st">&quot;RR_OR&quot;</span> <span class="ot">=</span> RR_OR, <span class="st">&quot;RRstar_OR&quot;</span> <span class="ot">=</span> RRstar_OR,</span>
<span id="cb294-118"><a href="functions.html#cb294-118" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RR_vs_RRstar_OR, </span>
<span id="cb294-119"><a href="functions.html#cb294-119" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span> <span class="ot">=</span> RD_RRstar_vs_RR_OR,</span>
<span id="cb294-120"><a href="functions.html#cb294-120" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span> <span class="ot">=</span> RD_OR_vs_RR_RRstar,</span>
<span id="cb294-121"><a href="functions.html#cb294-121" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_RRstar&quot;</span> <span class="ot">=</span> RD_RR_RRstar, <span class="st">&quot;RD_RR_OR&quot;</span> <span class="ot">=</span> RD_RR_OR, </span>
<span id="cb294-122"><a href="functions.html#cb294-122" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RRstar_OR, <span class="st">&quot;RR_RRstar_OR&quot;</span> <span class="ot">=</span> RR_RRstar_OR,</span>
<span id="cb294-123"><a href="functions.html#cb294-123" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RR_RRstar_OR, <span class="st">&quot;NONE&quot;</span> <span class="ot">=</span> NONE)</span>
<span id="cb294-124"><a href="functions.html#cb294-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-125"><a href="functions.html#cb294-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-126"><a href="functions.html#cb294-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if constrained and condition is met, set to NA</span></span>
<span id="cb294-127"><a href="functions.html#cb294-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># is constrained the set to NA</span></span>
<span id="cb294-128"><a href="functions.html#cb294-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if RR0 and RR1 are on different side of 1</span></span>
<span id="cb294-129"><a href="functions.html#cb294-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then the constraint is met</span></span>
<span id="cb294-130"><a href="functions.html#cb294-130" aria-hidden="true" tabindex="-1"></a>    cond <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR0 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">!=</span> <span class="fu">sign</span>(RR1 <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb294-131"><a href="functions.html#cb294-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (constrained <span class="sc">&amp;</span> cond) out[<span class="fu">seq_along</span>(out)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb294-132"><a href="functions.html#cb294-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-133"><a href="functions.html#cb294-133" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb294-134"><a href="functions.html#cb294-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb294-135"><a href="functions.html#cb294-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-136"><a href="functions.html#cb294-136" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run parametric Monte Carlo simulation</span></span>
<span id="cb294-137"><a href="functions.html#cb294-137" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;shape1&quot;</span> <span class="ot">=</span> shape1_prms, <span class="st">&quot;shape2&quot;</span> <span class="ot">=</span> shape2_prms)</span>
<span id="cb294-138"><a href="functions.html#cb294-138" aria-hidden="true" tabindex="-1"></a>  mc.out <span class="ot">&lt;-</span> MonteCarlo<span class="sc">::</span><span class="fu">MonteCarlo</span>(<span class="at">func =</span> calc_measures, <span class="at">nrep =</span> nrep, </span>
<span id="cb294-139"><a href="functions.html#cb294-139" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">param_list =</span> params)</span>
<span id="cb294-140"><a href="functions.html#cb294-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-141"><a href="functions.html#cb294-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output the results. One matrix per event where every matrix element</span></span>
<span id="cb294-142"><a href="functions.html#cb294-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is a percentage frequency for given shape1 and shape2 parameters</span></span>
<span id="cb294-143"><a href="functions.html#cb294-143" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mc.out<span class="sc">$</span>results, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb294-144"><a href="functions.html#cb294-144" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb294-145"><a href="functions.html#cb294-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">X =</span> <span class="fu">seq_len</span>(<span class="fu">dim</span>(x)[<span class="dv">1</span>]), <span class="at">FUN =</span> <span class="cf">function</span>(s1) {</span>
<span id="cb294-146"><a href="functions.html#cb294-146" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sapply</span>(<span class="at">X =</span> <span class="fu">seq_len</span>(<span class="fu">dim</span>(x)[<span class="dv">2</span>]), <span class="cf">function</span>(s2) {</span>
<span id="cb294-147"><a href="functions.html#cb294-147" aria-hidden="true" tabindex="-1"></a>          <span class="co"># since the constrained items are set to NA, we must</span></span>
<span id="cb294-148"><a href="functions.html#cb294-148" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove NA from the calculations, only has an effect </span></span>
<span id="cb294-149"><a href="functions.html#cb294-149" aria-hidden="true" tabindex="-1"></a>          <span class="co"># when constrained = TRUE</span></span>
<span id="cb294-150"><a href="functions.html#cb294-150" aria-hidden="true" tabindex="-1"></a>          nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x[s1, s2, ]))</span>
<span id="cb294-151"><a href="functions.html#cb294-151" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(x[s1, s2, ], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> nb</span>
<span id="cb294-152"><a href="functions.html#cb294-152" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb294-153"><a href="functions.html#cb294-153" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb294-154"><a href="functions.html#cb294-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert array to matrix and name row and columns</span></span>
<span id="cb294-155"><a href="functions.html#cb294-155" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m)</span>
<span id="cb294-156"><a href="functions.html#cb294-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;s2&quot;</span>, shape2_prms, <span class="at">sep =</span> <span class="st">&quot;=&quot;</span>)</span>
<span id="cb294-157"><a href="functions.html#cb294-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;s1&quot;</span>, shape1_prms, <span class="at">sep =</span> <span class="st">&quot;=&quot;</span>)</span>
<span id="cb294-158"><a href="functions.html#cb294-158" aria-hidden="true" tabindex="-1"></a>    m</span>
<span id="cb294-159"><a href="functions.html#cb294-159" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb294-160"><a href="functions.html#cb294-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-161"><a href="functions.html#cb294-161" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb294-162"><a href="functions.html#cb294-162" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ggp_venn_sim.r" class="section level3" number="9.3.4">
<h3><span class="header-section-number">C.3.4</span> <code>ggp_venn_sim.R</code></h3>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="functions.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create Venn diagram of the Monte Carlo with beta distribution</span></span>
<span id="cb295-2"><a href="functions.html#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb295-3"><a href="functions.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create Venn diagram of the Monte Carlo with beta distribution.</span></span>
<span id="cb295-4"><a href="functions.html#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb295-5"><a href="functions.html#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create Venn diagram of the Monte Carlo. The colors can be changed.</span></span>
<span id="cb295-6"><a href="functions.html#cb295-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb295-7"><a href="functions.html#cb295-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param data Monte Carlo data from \code{mc_beta_effect_measures()}</span></span>
<span id="cb295-8"><a href="functions.html#cb295-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n total nb of elements in the whole diagram</span></span>
<span id="cb295-9"><a href="functions.html#cb295-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fill_colr Vector of 4 fill colors</span></span>
<span id="cb295-10"><a href="functions.html#cb295-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title Title of the diagram</span></span>
<span id="cb295-11"><a href="functions.html#cb295-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb295-12"><a href="functions.html#cb295-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return ggplot object</span></span>
<span id="cb295-13"><a href="functions.html#cb295-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb295-14"><a href="functions.html#cb295-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb295-15"><a href="functions.html#cb295-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @seealso mc_beta_effect_measures</span></span>
<span id="cb295-16"><a href="functions.html#cb295-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb295-17"><a href="functions.html#cb295-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb295-18"><a href="functions.html#cb295-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb295-19"><a href="functions.html#cb295-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb295-20"><a href="functions.html#cb295-20" aria-hidden="true" tabindex="-1"></a>ggp_venn_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb295-21"><a href="functions.html#cb295-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill_colr =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb295-22"><a href="functions.html#cb295-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">title =</span> <span class="st">&quot;Venn diagram of effect measure modifications&quot;</span>) {</span>
<span id="cb295-23"><a href="functions.html#cb295-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the_events &lt;- c(&quot;RD_RR&quot;, &quot;RD_RRstar&quot;, &quot;RD_OR&quot;, &quot;RR_RRstar&quot;, &quot;RR_OR&quot;,</span></span>
<span id="cb295-24"><a href="functions.html#cb295-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               &quot;RRstar_OR&quot;, &quot;RD_RR_RRstar&quot;, &quot;RD_RR_OR&quot;, &quot;RD_RRstar_OR&quot;,</span></span>
<span id="cb295-25"><a href="functions.html#cb295-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#               &quot;RR_RRstar_OR&quot;, &quot;RD_RR_RRstar_OR&quot;)</span></span>
<span id="cb295-26"><a href="functions.html#cb295-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dfs &lt;- vector(mode = &quot;list&quot;, length = length(the_events))</span></span>
<span id="cb295-27"><a href="functions.html#cb295-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names(dfs) &lt;- the_events</span></span>
<span id="cb295-28"><a href="functions.html#cb295-28" aria-hidden="true" tabindex="-1"></a>  dfs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb295-29"><a href="functions.html#cb295-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-30"><a href="functions.html#cb295-30" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RR&quot;</span></span>
<span id="cb295-31"><a href="functions.html#cb295-31" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-32"><a href="functions.html#cb295-32" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-33"><a href="functions.html#cb295-33" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-34"><a href="functions.html#cb295-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-35"><a href="functions.html#cb295-35" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RRstar&quot;</span></span>
<span id="cb295-36"><a href="functions.html#cb295-36" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-37"><a href="functions.html#cb295-37" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-38"><a href="functions.html#cb295-38" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-39"><a href="functions.html#cb295-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-40"><a href="functions.html#cb295-40" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_OR&quot;</span></span>
<span id="cb295-41"><a href="functions.html#cb295-41" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-42"><a href="functions.html#cb295-42" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-43"><a href="functions.html#cb295-43" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-44"><a href="functions.html#cb295-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-45"><a href="functions.html#cb295-45" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RR_RRstar&quot;</span></span>
<span id="cb295-46"><a href="functions.html#cb295-46" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-47"><a href="functions.html#cb295-47" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-48"><a href="functions.html#cb295-48" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-49"><a href="functions.html#cb295-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-50"><a href="functions.html#cb295-50" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RR_OR&quot;</span></span>
<span id="cb295-51"><a href="functions.html#cb295-51" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-52"><a href="functions.html#cb295-52" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-53"><a href="functions.html#cb295-53" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-54"><a href="functions.html#cb295-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-55"><a href="functions.html#cb295-55" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RRstar_OR&quot;</span></span>
<span id="cb295-56"><a href="functions.html#cb295-56" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-57"><a href="functions.html#cb295-57" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-58"><a href="functions.html#cb295-58" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-59"><a href="functions.html#cb295-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-60"><a href="functions.html#cb295-60" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span></span>
<span id="cb295-61"><a href="functions.html#cb295-61" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n <span class="sc">*</span> <span class="fl">0.5</span></span>
<span id="cb295-62"><a href="functions.html#cb295-62" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-63"><a href="functions.html#cb295-63" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_RR_vs_RRstar_OR_1&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-64"><a href="functions.html#cb295-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-65"><a href="functions.html#cb295-65" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-66"><a href="functions.html#cb295-66" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_RR_vs_RRstar_OR_2&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-67"><a href="functions.html#cb295-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-68"><a href="functions.html#cb295-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-69"><a href="functions.html#cb295-69" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span></span>
<span id="cb295-70"><a href="functions.html#cb295-70" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n <span class="sc">*</span> <span class="fl">0.5</span></span>
<span id="cb295-71"><a href="functions.html#cb295-71" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-72"><a href="functions.html#cb295-72" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_RRstar_vs_RR_OR_1&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-73"><a href="functions.html#cb295-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-74"><a href="functions.html#cb295-74" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-75"><a href="functions.html#cb295-75" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_RRstar_vs_RR_OR_2&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-76"><a href="functions.html#cb295-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-77"><a href="functions.html#cb295-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-78"><a href="functions.html#cb295-78" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span></span>
<span id="cb295-79"><a href="functions.html#cb295-79" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> data[[id]]</span>
<span id="cb295-80"><a href="functions.html#cb295-80" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n <span class="sc">*</span> <span class="fl">0.5</span></span>
<span id="cb295-81"><a href="functions.html#cb295-81" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-82"><a href="functions.html#cb295-82" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_OR_vs_RR_RRstar_1&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-83"><a href="functions.html#cb295-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-84"><a href="functions.html#cb295-84" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-85"><a href="functions.html#cb295-85" aria-hidden="true" tabindex="-1"></a>  dfs[[<span class="st">&quot;RD_OR_vs_RR_RRstar_2&quot;</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb295-86"><a href="functions.html#cb295-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-87"><a href="functions.html#cb295-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-88"><a href="functions.html#cb295-88" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RR_RRstar&quot;</span></span>
<span id="cb295-89"><a href="functions.html#cb295-89" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-90"><a href="functions.html#cb295-90" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> F)</span>
<span id="cb295-91"><a href="functions.html#cb295-91" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-92"><a href="functions.html#cb295-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-93"><a href="functions.html#cb295-93" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RR_OR&quot;</span></span>
<span id="cb295-94"><a href="functions.html#cb295-94" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-95"><a href="functions.html#cb295-95" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-96"><a href="functions.html#cb295-96" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-97"><a href="functions.html#cb295-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-98"><a href="functions.html#cb295-98" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RRstar_OR&quot;</span></span>
<span id="cb295-99"><a href="functions.html#cb295-99" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-100"><a href="functions.html#cb295-100" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-101"><a href="functions.html#cb295-101" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-102"><a href="functions.html#cb295-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-103"><a href="functions.html#cb295-103" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RR_RRstar_OR&quot;</span></span>
<span id="cb295-104"><a href="functions.html#cb295-104" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-105"><a href="functions.html#cb295-105" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> F, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-106"><a href="functions.html#cb295-106" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-107"><a href="functions.html#cb295-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-108"><a href="functions.html#cb295-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-109"><a href="functions.html#cb295-109" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="st">&quot;RD_RR_RRstar_OR&quot;</span></span>
<span id="cb295-110"><a href="functions.html#cb295-110" aria-hidden="true" tabindex="-1"></a>  nreps <span class="ot">&lt;-</span> data[[id]] <span class="sc">*</span> n</span>
<span id="cb295-111"><a href="functions.html#cb295-111" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> T, <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> T)</span>
<span id="cb295-112"><a href="functions.html#cb295-112" aria-hidden="true" tabindex="-1"></a>  dfs[[id]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">replicate</span>(nreps, df, <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb295-113"><a href="functions.html#cb295-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-114"><a href="functions.html#cb295-114" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dfs)</span>
<span id="cb295-115"><a href="functions.html#cb295-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb295-116"><a href="functions.html#cb295-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the venn diagram</span></span>
<span id="cb295-117"><a href="functions.html#cb295-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb295-118"><a href="functions.html#cb295-118" aria-hidden="true" tabindex="-1"></a>    ggvenn<span class="sc">::</span><span class="fu">geom_venn</span>(<span class="fu">aes</span>(<span class="at">A =</span> RD, <span class="at">B =</span> RR, <span class="at">C =</span> RRstar, <span class="at">D =</span> OR), <span class="at">show_percentage =</span> <span class="cn">TRUE</span>,</span>
<span id="cb295-119"><a href="functions.html#cb295-119" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill_color =</span> fill_colr) <span class="sc">+</span></span>
<span id="cb295-120"><a href="functions.html#cb295-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb295-121"><a href="functions.html#cb295-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%d items&quot;</span>, n))</span>
<span id="cb295-122"><a href="functions.html#cb295-122" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ggp_betasim.r" class="section level3" number="9.3.5">
<h3><span class="header-section-number">C.3.5</span> <code>ggp_betasim.R</code></h3>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="functions.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Heatmap of a matrix from \code{betasim_effect_measures()}</span></span>
<span id="cb296-2"><a href="functions.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb296-3"><a href="functions.html#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Heatmap of a matrix from \code{betasim_effect_measures()}.</span></span>
<span id="cb296-4"><a href="functions.html#cb296-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb296-5"><a href="functions.html#cb296-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Heatmap of a matrix from \code{betasim_effect_measures()} with the</span></span>
<span id="cb296-6"><a href="functions.html#cb296-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; possibilitiy of changing the color.</span></span>
<span id="cb296-7"><a href="functions.html#cb296-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb296-8"><a href="functions.html#cb296-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sim Monte Carlo sim data from \code{betasim_effect_measures()}</span></span>
<span id="cb296-9"><a href="functions.html#cb296-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Variable from the Monte Carlo sim to plot.</span></span>
<span id="cb296-10"><a href="functions.html#cb296-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param colr Vector of colors for the heatmap.</span></span>
<span id="cb296-11"><a href="functions.html#cb296-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title Title of the plot</span></span>
<span id="cb296-12"><a href="functions.html#cb296-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb296-13"><a href="functions.html#cb296-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return ggplot object</span></span>
<span id="cb296-14"><a href="functions.html#cb296-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb296-15"><a href="functions.html#cb296-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb296-16"><a href="functions.html#cb296-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @seealso betasim_effect_measures</span></span>
<span id="cb296-17"><a href="functions.html#cb296-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb296-18"><a href="functions.html#cb296-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb296-19"><a href="functions.html#cb296-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb296-20"><a href="functions.html#cb296-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb296-21"><a href="functions.html#cb296-21" aria-hidden="true" tabindex="-1"></a>ggp_betasim <span class="ot">&lt;-</span> <span class="cf">function</span>(sim, <span class="at">var =</span> <span class="st">&quot;RD_RR_RRstar_OR&quot;</span>,</span>
<span id="cb296-22"><a href="functions.html#cb296-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">colr =</span> <span class="fu">list</span>(<span class="st">&quot;low&quot;</span> <span class="ot">=</span> <span class="st">&quot;cadetblue1&quot;</span>, <span class="st">&quot;high&quot;</span> <span class="ot">=</span> <span class="st">&quot;cadetblue4&quot;</span>),</span>
<span id="cb296-23"><a href="functions.html#cb296-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">title =</span> <span class="st">&quot;Monte Carlo simulation with beta distribution&quot;</span>) {</span>
<span id="cb296-24"><a href="functions.html#cb296-24" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> sim[[var]]</span>
<span id="cb296-25"><a href="functions.html#cb296-25" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> mat <span class="sc">%&gt;%</span></span>
<span id="cb296-26"><a href="functions.html#cb296-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb296-27"><a href="functions.html#cb296-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">shape2 =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb296-28"><a href="functions.html#cb296-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;s1&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;shape1&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb296-29"><a href="functions.html#cb296-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb296-30"><a href="functions.html#cb296-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> shape1, <span class="at">y =</span> shape2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb296-31"><a href="functions.html#cb296-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb296-32"><a href="functions.html#cb296-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(value, <span class="dv">2</span>)), <span class="at">color =</span> <span class="st">&quot;floralwhite&quot;</span>,</span>
<span id="cb296-33"><a href="functions.html#cb296-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb296-34"><a href="functions.html#cb296-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> colr<span class="sc">$</span>low, <span class="at">high =</span> colr<span class="sc">$</span>high) <span class="sc">+</span></span>
<span id="cb296-35"><a href="functions.html#cb296-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb296-36"><a href="functions.html#cb296-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb296-37"><a href="functions.html#cb296-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title, <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">&quot;Event =  %s&quot;</span>, var))</span>
<span id="cb296-38"><a href="functions.html#cb296-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="chapter-5-1" class="section level2" number="9.4">
<h2><span class="header-section-number">C.4</span> Chapter 5</h2>
<div id="ggp_dag.r" class="section level3" number="9.4.1">
<h3><span class="header-section-number">C.4.1</span> <code>ggp_dag.R</code></h3>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="functions.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Plot a DAG with ggplot and node names with subscripts</span></span>
<span id="cb297-2"><a href="functions.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb297-3"><a href="functions.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Plot a DAG with ggplot and node names with subscripts.</span></span>
<span id="cb297-4"><a href="functions.html#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb297-5"><a href="functions.html#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The DAG will be plotted using \code{ggplot2} and the nodes&#39; names can have</span></span>
<span id="cb297-6"><a href="functions.html#cb297-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subscript as in mathematical notations. See the \code{source} below for</span></span>
<span id="cb297-7"><a href="functions.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; more details.</span></span>
<span id="cb297-8"><a href="functions.html#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-9"><a href="functions.html#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param dag </span></span>
<span id="cb297-10"><a href="functions.html#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param layout </span></span>
<span id="cb297-11"><a href="functions.html#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param text_labels If NULL (default) the nodes&#39; names are used as is. If</span></span>
<span id="cb297-12"><a href="functions.html#cb297-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a vector of text labels is given they MUST BE IN ALPHABETICAL ORDER.</span></span>
<span id="cb297-13"><a href="functions.html#cb297-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param text_size Integer. Size of the nodes&#39; name.</span></span>
<span id="cb297-14"><a href="functions.html#cb297-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-15"><a href="functions.html#cb297-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return ggplot object</span></span>
<span id="cb297-16"><a href="functions.html#cb297-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb297-17"><a href="functions.html#cb297-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-18"><a href="functions.html#cb297-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @source https://www.r-bloggers.com/2019/10/how-to-use-math-symbols-with-ggdag-2/</span></span>
<span id="cb297-19"><a href="functions.html#cb297-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-20"><a href="functions.html#cb297-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb297-21"><a href="functions.html#cb297-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb297-22"><a href="functions.html#cb297-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb297-23"><a href="functions.html#cb297-23" aria-hidden="true" tabindex="-1"></a>ggp_dag <span class="ot">&lt;-</span> <span class="cf">function</span>(dag, <span class="at">layout =</span> <span class="st">&quot;sugiyama&quot;</span>, <span class="at">text_labels =</span> <span class="cn">NULL</span>, <span class="at">text_size =</span> <span class="dv">7</span>,</span>
<span id="cb297-24"><a href="functions.html#cb297-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">box_padding =</span> <span class="dv">1</span>, <span class="at">legend_pos =</span> <span class="st">&quot;bottom&quot;</span>) {</span>
<span id="cb297-25"><a href="functions.html#cb297-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-26"><a href="functions.html#cb297-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the default colors</span></span>
<span id="cb297-27"><a href="functions.html#cb297-27" aria-hidden="true" tabindex="-1"></a>  bg_colr <span class="ot">&lt;-</span> <span class="st">&quot;snow&quot;</span></span>
<span id="cb297-28"><a href="functions.html#cb297-28" aria-hidden="true" tabindex="-1"></a>  label_colr <span class="ot">&lt;-</span> <span class="st">&quot;oldlace&quot;</span></span>
<span id="cb297-29"><a href="functions.html#cb297-29" aria-hidden="true" tabindex="-1"></a>  text_colr <span class="ot">&lt;-</span> <span class="st">&quot;midnightblue&quot;</span></span>
<span id="cb297-30"><a href="functions.html#cb297-30" aria-hidden="true" tabindex="-1"></a>  status_colrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;latent&quot;</span> <span class="ot">=</span> <span class="st">&quot;snow3&quot;</span>, <span class="st">&quot;exposure&quot;</span> <span class="ot">=</span> <span class="st">&quot;burlywood&quot;</span>, <span class="st">&quot;outcome&quot;</span> <span class="ot">=</span> <span class="st">&quot;aquamarine&quot;</span>)</span>
<span id="cb297-31"><a href="functions.html#cb297-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-32"><a href="functions.html#cb297-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if any variable was given a status</span></span>
<span id="cb297-33"><a href="functions.html#cb297-33" aria-hidden="true" tabindex="-1"></a>  is_status <span class="ot">&lt;-</span> <span class="fu">any</span>(<span class="fu">length</span>(<span class="fu">exposures</span>(dag)) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">length</span>(<span class="fu">outcomes</span>(dag)) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb297-34"><a href="functions.html#cb297-34" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">length</span>(<span class="fu">latents</span>(dag)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb297-35"><a href="functions.html#cb297-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_status) {</span>
<span id="cb297-36"><a href="functions.html#cb297-36" aria-hidden="true" tabindex="-1"></a>    status_guide <span class="ot">&lt;-</span> <span class="st">&quot;legend&quot;</span></span>
<span id="cb297-37"><a href="functions.html#cb297-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb297-38"><a href="functions.html#cb297-38" aria-hidden="true" tabindex="-1"></a>    status_guide <span class="ot">&lt;-</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb297-39"><a href="functions.html#cb297-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-40"><a href="functions.html#cb297-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-41"><a href="functions.html#cb297-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the dagitty object</span></span>
<span id="cb297-42"><a href="functions.html#cb297-42" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> dag <span class="sc">%&gt;%</span> </span>
<span id="cb297-43"><a href="functions.html#cb297-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy_dagitty</span>(<span class="at">layout =</span> layout) <span class="sc">%&gt;%</span></span>
<span id="cb297-44"><a href="functions.html#cb297-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(name)  <span class="co"># must sort by name to use mathematical expressions</span></span>
<span id="cb297-45"><a href="functions.html#cb297-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-46"><a href="functions.html#cb297-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the names of the variables</span></span>
<span id="cb297-47"><a href="functions.html#cb297-47" aria-hidden="true" tabindex="-1"></a>  the_names <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(out<span class="sc">$</span>data<span class="sc">$</span>name))</span>
<span id="cb297-48"><a href="functions.html#cb297-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-49"><a href="functions.html#cb297-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flag if label column is available</span></span>
<span id="cb297-50"><a href="functions.html#cb297-50" aria-hidden="true" tabindex="-1"></a>  is_label <span class="ot">&lt;-</span> <span class="st">&quot;label&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(out<span class="sc">$</span>data)</span>
<span id="cb297-51"><a href="functions.html#cb297-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-52"><a href="functions.html#cb297-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the plot</span></span>
<span id="cb297-53"><a href="functions.html#cb297-53" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> out <span class="sc">%&gt;%</span></span>
<span id="cb297-54"><a href="functions.html#cb297-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggdag_status</span>(<span class="at">color =</span> status) <span class="sc">+</span></span>
<span id="cb297-55"><a href="functions.html#cb297-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb297-56"><a href="functions.html#cb297-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> status_colrs, <span class="at">na.value =</span> bg_colr,</span>
<span id="cb297-57"><a href="functions.html#cb297-57" aria-hidden="true" tabindex="-1"></a>                       <span class="at">guide =</span> status_guide) <span class="sc">+</span></span>
<span id="cb297-58"><a href="functions.html#cb297-58" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">theme_dag_blank</span>(<span class="at">panel.background =</span> </span>
<span id="cb297-59"><a href="functions.html#cb297-59" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">element_rect</span>(<span class="at">fill=</span>bg_colr, <span class="at">color=</span>bg_colr)) <span class="sc">+</span></span>
<span id="cb297-60"><a href="functions.html#cb297-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> legend_pos,</span>
<span id="cb297-61"><a href="functions.html#cb297-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb297-62"><a href="functions.html#cb297-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-63"><a href="functions.html#cb297-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the node names</span></span>
<span id="cb297-64"><a href="functions.html#cb297-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(text_labels)) {</span>
<span id="cb297-65"><a href="functions.html#cb297-65" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> out <span class="sc">+</span></span>
<span id="cb297-66"><a href="functions.html#cb297-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_text</span>(<span class="at">size =</span> text_size, <span class="at">color =</span> text_colr)</span>
<span id="cb297-67"><a href="functions.html#cb297-67" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb297-68"><a href="functions.html#cb297-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a common mistake is to forget a variable</span></span>
<span id="cb297-69"><a href="functions.html#cb297-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(text_labels) <span class="sc">==</span> <span class="fu">length</span>(the_names))</span>
<span id="cb297-70"><a href="functions.html#cb297-70" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> out <span class="sc">+</span></span>
<span id="cb297-71"><a href="functions.html#cb297-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_text</span>(<span class="at">size =</span> text_size, <span class="at">color =</span> text_colr, <span class="at">parse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb297-72"><a href="functions.html#cb297-72" aria-hidden="true" tabindex="-1"></a>                    <span class="at">label =</span> text_labels)</span>
<span id="cb297-73"><a href="functions.html#cb297-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-74"><a href="functions.html#cb297-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-75"><a href="functions.html#cb297-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the labels when the label column is available</span></span>
<span id="cb297-76"><a href="functions.html#cb297-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (is_label) {</span>
<span id="cb297-77"><a href="functions.html#cb297-77" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> out <span class="sc">+</span></span>
<span id="cb297-78"><a href="functions.html#cb297-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dag_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">color =</span> text_colr, </span>
<span id="cb297-79"><a href="functions.html#cb297-79" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fill =</span> label_colr, <span class="at">box.padding =</span> box_padding)</span>
<span id="cb297-80"><a href="functions.html#cb297-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-81"><a href="functions.html#cb297-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-82"><a href="functions.html#cb297-82" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb297-83"><a href="functions.html#cb297-83" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="gt_probs.r" class="section level3" number="9.4.2">
<h3><span class="header-section-number">C.4.2</span> <code>gt_probs.R</code></h3>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="functions.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create table of probabilities with \code{gt} package</span></span>
<span id="cb298-2"><a href="functions.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb298-3"><a href="functions.html#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create table of probabilities with \code{gt} package.</span></span>
<span id="cb298-4"><a href="functions.html#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb298-5"><a href="functions.html#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create table of probabilities with \code{gt} package. The last column</span></span>
<span id="cb298-6"><a href="functions.html#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; repesents the probabilitis.</span></span>
<span id="cb298-7"><a href="functions.html#cb298-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-8"><a href="functions.html#cb298-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param df Datafframe</span></span>
<span id="cb298-9"><a href="functions.html#cb298-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param digits Integer, number of digits to the right of decimal</span></span>
<span id="cb298-10"><a href="functions.html#cb298-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param title Title of the table</span></span>
<span id="cb298-11"><a href="functions.html#cb298-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subtitle Subtitle of the table</span></span>
<span id="cb298-12"><a href="functions.html#cb298-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-13"><a href="functions.html#cb298-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A gt object create by the \code{gt} package</span></span>
<span id="cb298-14"><a href="functions.html#cb298-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb298-15"><a href="functions.html#cb298-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-16"><a href="functions.html#cb298-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb298-17"><a href="functions.html#cb298-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb298-18"><a href="functions.html#cb298-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb298-19"><a href="functions.html#cb298-19" aria-hidden="true" tabindex="-1"></a>gt_probs <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">digits =</span> <span class="dv">3</span>, title, subtitle) {</span>
<span id="cb298-20"><a href="functions.html#cb298-20" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb298-21"><a href="functions.html#cb298-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb298-22"><a href="functions.html#cb298-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt_basic</span>(title, subtitle) <span class="sc">%&gt;%</span></span>
<span id="cb298-23"><a href="functions.html#cb298-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="st">&quot;prob&quot;</span>, <span class="at">decimals =</span> digits)</span>
<span id="cb298-24"><a href="functions.html#cb298-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="chapter-6-2" class="section level2" number="9.5">
<h2><span class="header-section-number">C.5</span> Chapter 6</h2>
<div id="new_simdr" class="section level3" number="9.5.1">
<h3><span class="header-section-number">C.5.1</span> Doubly Robust Standardization</h3>
<p>The simulation is done with <code>new_simdr</code> which is coded as follows</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="functions.html#cb299-1" aria-hidden="true" tabindex="-1"></a>mc_simdr <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb299-2"><a href="functions.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-3"><a href="functions.html#cb299-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb299-4"><a href="functions.html#cb299-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-5"><a href="functions.html#cb299-5" aria-hidden="true" tabindex="-1"></a>new_simdr <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">ss =</span> <span class="dv">100</span>, <span class="at">probH =</span> <span class="fl">0.05</span>, <span class="at">seed =</span> <span class="cn">NULL</span>,</span>
<span id="cb299-6"><a href="functions.html#cb299-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">out_choice =</span> <span class="fu">c</span>(<span class="st">&quot;all&quot;</span>, <span class="st">&quot;sim&quot;</span>, <span class="st">&quot;est&quot;</span>)) {</span>
<span id="cb299-7"><a href="functions.html#cb299-7" aria-hidden="true" tabindex="-1"></a>  out_choice <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(out_choice)</span>
<span id="cb299-8"><a href="functions.html#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb299-9"><a href="functions.html#cb299-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-10"><a href="functions.html#cb299-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># matrix of independent Bernoulli vector with prob = 0.05</span></span>
<span id="cb299-11"><a href="functions.html#cb299-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;The columns of H were independent indicator variables each</span></span>
<span id="cb299-12"><a href="functions.html#cb299-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  with probability 0.05&quot;</span></span>
<span id="cb299-13"><a href="functions.html#cb299-13" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">replicate</span>(<span class="at">n =</span> ss, <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probH)))</span>
<span id="cb299-14"><a href="functions.html#cb299-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-15"><a href="functions.html#cb299-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the treatment depend on a function of H</span></span>
<span id="cb299-16"><a href="functions.html#cb299-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;We simulated T  as indicator variables with probabilities that varied as</span></span>
<span id="cb299-17"><a href="functions.html#cb299-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a linear function  of H such that approximately 600 individuals had T=1&quot;</span></span>
<span id="cb299-18"><a href="functions.html#cb299-18" aria-hidden="true" tabindex="-1"></a>  sumH <span class="ot">&lt;-</span> <span class="fu">apply</span>(H, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> sum) <span class="sc">*</span> <span class="dv">20</span> <span class="sc">/</span> ss</span>
<span id="cb299-19"><a href="functions.html#cb299-19" aria-hidden="true" tabindex="-1"></a>  probT <span class="ot">&lt;-</span> <span class="fl">0.13</span> <span class="sc">*</span> sumH <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb299-20"><a href="functions.html#cb299-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(T=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb299-21"><a href="functions.html#cb299-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(probT <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="fu">all</span>(probT <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb299-22"><a href="functions.html#cb299-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probT)</span>
<span id="cb299-23"><a href="functions.html#cb299-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-24"><a href="functions.html#cb299-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-25"><a href="functions.html#cb299-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the outcome depend on T and H</span></span>
<span id="cb299-26"><a href="functions.html#cb299-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;We simulated Y as a function T ans sumH such hat approximatey 35 </span></span>
<span id="cb299-27"><a href="functions.html#cb299-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># individuals had Y = 1&quot;</span></span>
<span id="cb299-28"><a href="functions.html#cb299-28" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> sumH</span>
<span id="cb299-29"><a href="functions.html#cb299-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(Y=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb299-30"><a href="functions.html#cb299-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">NOTE</span><span class="co"> ON ASSUMPTION:</span></span>
<span id="cb299-31"><a href="functions.html#cb299-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># positivity assumtion not met because we need probY &gt;= 0</span></span>
<span id="cb299-32"><a href="functions.html#cb299-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(probY <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">all</span>(probY <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb299-33"><a href="functions.html#cb299-33" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb299-34"><a href="functions.html#cb299-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-35"><a href="functions.html#cb299-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put results in a list</span></span>
<span id="cb299-36"><a href="functions.html#cb299-36" aria-hidden="true" tabindex="-1"></a>  sim <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;sumH&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(sumH),</span>
<span id="cb299-37"><a href="functions.html#cb299-37" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;probT&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(probT),</span>
<span id="cb299-38"><a href="functions.html#cb299-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;sumT&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>),</span>
<span id="cb299-39"><a href="functions.html#cb299-39" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;probY&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(probY),</span>
<span id="cb299-40"><a href="functions.html#cb299-40" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;sumY&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(Y)</span>
<span id="cb299-41"><a href="functions.html#cb299-41" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb299-42"><a href="functions.html#cb299-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-43"><a href="functions.html#cb299-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate the expected potential outcomes</span></span>
<span id="cb299-44"><a href="functions.html#cb299-44" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> <span class="fu">simdr_est</span>(Y, <span class="st">`</span><span class="at">T</span><span class="st">`</span>, H)</span>
<span id="cb299-45"><a href="functions.html#cb299-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-46"><a href="functions.html#cb299-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (out_choice <span class="sc">==</span> <span class="st">&quot;all&quot;</span>) {</span>
<span id="cb299-47"><a href="functions.html#cb299-47" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">append</span>(sim, est)</span>
<span id="cb299-48"><a href="functions.html#cb299-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;sim&quot;</span>) {</span>
<span id="cb299-49"><a href="functions.html#cb299-49" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> sim</span>
<span id="cb299-50"><a href="functions.html#cb299-50" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;est&quot;</span>) {</span>
<span id="cb299-51"><a href="functions.html#cb299-51" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> est</span>
<span id="cb299-52"><a href="functions.html#cb299-52" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb299-53"><a href="functions.html#cb299-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s is an invalid out_choice&quot;</span>, out_choice))</span>
<span id="cb299-54"><a href="functions.html#cb299-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb299-55"><a href="functions.html#cb299-55" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb299-56"><a href="functions.html#cb299-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb299-57"><a href="functions.html#cb299-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-58"><a href="functions.html#cb299-58" aria-hidden="true" tabindex="-1"></a>simdr_est <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, <span class="st">`</span><span class="at">T</span><span class="st">`</span>, H) {</span>
<span id="cb299-59"><a href="functions.html#cb299-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-60"><a href="functions.html#cb299-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit the exposure model</span></span>
<span id="cb299-61"><a href="functions.html#cb299-61" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="fu">lm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H))</span>
<span id="cb299-62"><a href="functions.html#cb299-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-63"><a href="functions.html#cb299-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the exposure model using an incorrect logistic model</span></span>
<span id="cb299-64"><a href="functions.html#cb299-64" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">glm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb299-65"><a href="functions.html#cb299-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-66"><a href="functions.html#cb299-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the weights</span></span>
<span id="cb299-67"><a href="functions.html#cb299-67" aria-hidden="true" tabindex="-1"></a>  w0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e)</span>
<span id="cb299-68"><a href="functions.html#cb299-68" aria-hidden="true" tabindex="-1"></a>  w1 <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">/</span> e</span>
<span id="cb299-69"><a href="functions.html#cb299-69" aria-hidden="true" tabindex="-1"></a>  w02 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e2)</span>
<span id="cb299-70"><a href="functions.html#cb299-70" aria-hidden="true" tabindex="-1"></a>  w12 <span class="ot">&lt;-</span> T <span class="sc">/</span> e2</span>
<span id="cb299-71"><a href="functions.html#cb299-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-72"><a href="functions.html#cb299-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit an overspecified (saturated) outcome model</span></span>
<span id="cb299-73"><a href="functions.html#cb299-73" aria-hidden="true" tabindex="-1"></a>  mod.out <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">*</span> H)</span>
<span id="cb299-74"><a href="functions.html#cb299-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-75"><a href="functions.html#cb299-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate the expected potential outcomes using the various methods</span></span>
<span id="cb299-76"><a href="functions.html#cb299-76" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Y&quot;</span> <span class="ot">=</span> Y, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb299-77"><a href="functions.html#cb299-77" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> dat</span>
<span id="cb299-78"><a href="functions.html#cb299-78" aria-hidden="true" tabindex="-1"></a>  dat0<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb299-79"><a href="functions.html#cb299-79" aria-hidden="true" tabindex="-1"></a>  dat1 <span class="ot">&lt;-</span> dat</span>
<span id="cb299-80"><a href="functions.html#cb299-80" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb299-81"><a href="functions.html#cb299-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-82"><a href="functions.html#cb299-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the predicted data</span></span>
<span id="cb299-83"><a href="functions.html#cb299-83" aria-hidden="true" tabindex="-1"></a>  preds0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat0)</span>
<span id="cb299-84"><a href="functions.html#cb299-84" aria-hidden="true" tabindex="-1"></a>  preds1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat1)</span>
<span id="cb299-85"><a href="functions.html#cb299-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-86"><a href="functions.html#cb299-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the estimates</span></span>
<span id="cb299-87"><a href="functions.html#cb299-87" aria-hidden="true" tabindex="-1"></a>  EY0out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds0)</span>
<span id="cb299-88"><a href="functions.html#cb299-88" aria-hidden="true" tabindex="-1"></a>  EY1out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds1)</span>
<span id="cb299-89"><a href="functions.html#cb299-89" aria-hidden="true" tabindex="-1"></a>  EY0exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w0)</span>
<span id="cb299-90"><a href="functions.html#cb299-90" aria-hidden="true" tabindex="-1"></a>  EY1exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w1)</span>
<span id="cb299-91"><a href="functions.html#cb299-91" aria-hidden="true" tabindex="-1"></a>  EY0exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w02)</span>
<span id="cb299-92"><a href="functions.html#cb299-92" aria-hidden="true" tabindex="-1"></a>  EY1exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w12)</span>
<span id="cb299-93"><a href="functions.html#cb299-93" aria-hidden="true" tabindex="-1"></a>  EY0dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w0 <span class="sc">*</span> Y <span class="sc">+</span> preds0 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e))</span>
<span id="cb299-94"><a href="functions.html#cb299-94" aria-hidden="true" tabindex="-1"></a>  EY1dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w1 <span class="sc">*</span> Y <span class="sc">-</span> preds1 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> e)</span>
<span id="cb299-95"><a href="functions.html#cb299-95" aria-hidden="true" tabindex="-1"></a>  EYT0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb299-96"><a href="functions.html#cb299-96" aria-hidden="true" tabindex="-1"></a>  EYT1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb299-97"><a href="functions.html#cb299-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb299-98"><a href="functions.html#cb299-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;EY0out&quot;</span> <span class="ot">=</span> EY0out,</span>
<span id="cb299-99"><a href="functions.html#cb299-99" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1out&quot;</span> <span class="ot">=</span> EY1out,</span>
<span id="cb299-100"><a href="functions.html#cb299-100" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0exp&quot;</span> <span class="ot">=</span> EY0exp,</span>
<span id="cb299-101"><a href="functions.html#cb299-101" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1exp&quot;</span> <span class="ot">=</span> EY1exp,</span>
<span id="cb299-102"><a href="functions.html#cb299-102" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0exp2&quot;</span> <span class="ot">=</span> EY0exp2,</span>
<span id="cb299-103"><a href="functions.html#cb299-103" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1exp2&quot;</span> <span class="ot">=</span> EY1exp2,</span>
<span id="cb299-104"><a href="functions.html#cb299-104" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0dr&quot;</span> <span class="ot">=</span> EY0dr,</span>
<span id="cb299-105"><a href="functions.html#cb299-105" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1dr&quot;</span> <span class="ot">=</span> EY1dr,</span>
<span id="cb299-106"><a href="functions.html#cb299-106" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> EYT0,</span>
<span id="cb299-107"><a href="functions.html#cb299-107" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> EYT1)</span>
<span id="cb299-108"><a href="functions.html#cb299-108" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The book use the function <code>simdr</code> found on p. 127-128.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="functions.html#cb300-1" aria-hidden="true" tabindex="-1"></a>simdr <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">ss =</span> <span class="dv">100</span>, <span class="at">probH =</span> <span class="fl">0.05</span>, <span class="at">seed =</span> <span class="cn">NULL</span>,</span>
<span id="cb300-2"><a href="functions.html#cb300-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">out_choice =</span> <span class="fu">c</span>(<span class="st">&quot;all&quot;</span>, <span class="st">&quot;sim&quot;</span>, <span class="st">&quot;est&quot;</span>)) {</span>
<span id="cb300-3"><a href="functions.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  out_choice <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(out_choice)</span>
<span id="cb300-4"><a href="functions.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb300-5"><a href="functions.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-6"><a href="functions.html#cb300-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ss is the number of confounders</span></span>
<span id="cb300-7"><a href="functions.html#cb300-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i.e. the number of columns of H</span></span>
<span id="cb300-8"><a href="functions.html#cb300-8" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, ss)</span>
<span id="cb300-9"><a href="functions.html#cb300-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let all componentsof H be independent Bernoulli variables with p=0.05</span></span>
<span id="cb300-10"><a href="functions.html#cb300-10" aria-hidden="true" tabindex="-1"></a>  probH <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.05</span>, n)</span>
<span id="cb300-11"><a href="functions.html#cb300-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ss) {</span>
<span id="cb300-12"><a href="functions.html#cb300-12" aria-hidden="true" tabindex="-1"></a>    H[, i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probH)</span>
<span id="cb300-13"><a href="functions.html#cb300-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb300-14"><a href="functions.html#cb300-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let the treatment depend on a function of H</span></span>
<span id="cb300-15"><a href="functions.html#cb300-15" aria-hidden="true" tabindex="-1"></a>  sumH <span class="ot">&lt;-</span> <span class="fu">apply</span>(H, <span class="dv">1</span>, sum) <span class="sc">*</span> <span class="dv">20</span> <span class="sc">/</span> ss</span>
<span id="cb300-16"><a href="functions.html#cb300-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(T=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb300-17"><a href="functions.html#cb300-17" aria-hidden="true" tabindex="-1"></a>  probT <span class="ot">&lt;-</span> <span class="fl">0.13</span> <span class="sc">*</span> sumH <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb300-18"><a href="functions.html#cb300-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-19"><a href="functions.html#cb300-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probT)</span>
<span id="cb300-20"><a href="functions.html#cb300-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-21"><a href="functions.html#cb300-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the outcome depend on T and H</span></span>
<span id="cb300-22"><a href="functions.html#cb300-22" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> sumH</span>
<span id="cb300-23"><a href="functions.html#cb300-23" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb300-24"><a href="functions.html#cb300-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-25"><a href="functions.html#cb300-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put the simulated resuts in a list</span></span>
<span id="cb300-26"><a href="functions.html#cb300-26" aria-hidden="true" tabindex="-1"></a>  sim <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;sumH&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(sumH),</span>
<span id="cb300-27"><a href="functions.html#cb300-27" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;probT&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(probT),</span>
<span id="cb300-28"><a href="functions.html#cb300-28" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;sumT&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>),</span>
<span id="cb300-29"><a href="functions.html#cb300-29" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;probY&quot;</span> <span class="ot">=</span> <span class="fu">fivenum</span>(probY),</span>
<span id="cb300-30"><a href="functions.html#cb300-30" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;sumY&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(Y))</span>
<span id="cb300-31"><a href="functions.html#cb300-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-32"><a href="functions.html#cb300-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit the exposure model</span></span>
<span id="cb300-33"><a href="functions.html#cb300-33" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="fu">lm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H))</span>
<span id="cb300-34"><a href="functions.html#cb300-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-35"><a href="functions.html#cb300-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the exposure model using an incorrect logistic model</span></span>
<span id="cb300-36"><a href="functions.html#cb300-36" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">glm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb300-37"><a href="functions.html#cb300-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-38"><a href="functions.html#cb300-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the weights</span></span>
<span id="cb300-39"><a href="functions.html#cb300-39" aria-hidden="true" tabindex="-1"></a>  w0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e)</span>
<span id="cb300-40"><a href="functions.html#cb300-40" aria-hidden="true" tabindex="-1"></a>  w1 <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">/</span> e</span>
<span id="cb300-41"><a href="functions.html#cb300-41" aria-hidden="true" tabindex="-1"></a>  w02 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e2)</span>
<span id="cb300-42"><a href="functions.html#cb300-42" aria-hidden="true" tabindex="-1"></a>  w12 <span class="ot">&lt;-</span> T <span class="sc">/</span> e2</span>
<span id="cb300-43"><a href="functions.html#cb300-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-44"><a href="functions.html#cb300-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit an overspecified (saturated) outcome model</span></span>
<span id="cb300-45"><a href="functions.html#cb300-45" aria-hidden="true" tabindex="-1"></a>  mod.out <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">*</span> H)</span>
<span id="cb300-46"><a href="functions.html#cb300-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-47"><a href="functions.html#cb300-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate the expected potential outcomes using the various methods</span></span>
<span id="cb300-48"><a href="functions.html#cb300-48" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Y&quot;</span> <span class="ot">=</span> Y, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb300-49"><a href="functions.html#cb300-49" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> dat</span>
<span id="cb300-50"><a href="functions.html#cb300-50" aria-hidden="true" tabindex="-1"></a>  dat0<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb300-51"><a href="functions.html#cb300-51" aria-hidden="true" tabindex="-1"></a>  dat1 <span class="ot">&lt;-</span> dat</span>
<span id="cb300-52"><a href="functions.html#cb300-52" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb300-53"><a href="functions.html#cb300-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-54"><a href="functions.html#cb300-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the predicted data</span></span>
<span id="cb300-55"><a href="functions.html#cb300-55" aria-hidden="true" tabindex="-1"></a>  preds0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat0)</span>
<span id="cb300-56"><a href="functions.html#cb300-56" aria-hidden="true" tabindex="-1"></a>  preds1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat1)</span>
<span id="cb300-57"><a href="functions.html#cb300-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-58"><a href="functions.html#cb300-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the estimates</span></span>
<span id="cb300-59"><a href="functions.html#cb300-59" aria-hidden="true" tabindex="-1"></a>  EY0out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds0)</span>
<span id="cb300-60"><a href="functions.html#cb300-60" aria-hidden="true" tabindex="-1"></a>  EY1out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds1)</span>
<span id="cb300-61"><a href="functions.html#cb300-61" aria-hidden="true" tabindex="-1"></a>  EY0exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w0)</span>
<span id="cb300-62"><a href="functions.html#cb300-62" aria-hidden="true" tabindex="-1"></a>  EY1exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w1)</span>
<span id="cb300-63"><a href="functions.html#cb300-63" aria-hidden="true" tabindex="-1"></a>  EY0exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w02)</span>
<span id="cb300-64"><a href="functions.html#cb300-64" aria-hidden="true" tabindex="-1"></a>  EY1exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w12)</span>
<span id="cb300-65"><a href="functions.html#cb300-65" aria-hidden="true" tabindex="-1"></a>  EY0dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w0 <span class="sc">*</span> Y <span class="sc">+</span> preds0 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e))</span>
<span id="cb300-66"><a href="functions.html#cb300-66" aria-hidden="true" tabindex="-1"></a>  EY1dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w1 <span class="sc">*</span> Y <span class="sc">-</span> preds1 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> e)</span>
<span id="cb300-67"><a href="functions.html#cb300-67" aria-hidden="true" tabindex="-1"></a>  EYT0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb300-68"><a href="functions.html#cb300-68" aria-hidden="true" tabindex="-1"></a>  EYT1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb300-69"><a href="functions.html#cb300-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-70"><a href="functions.html#cb300-70" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb300-71"><a href="functions.html#cb300-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0out&quot;</span> <span class="ot">=</span> EY0out,</span>
<span id="cb300-72"><a href="functions.html#cb300-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1out&quot;</span> <span class="ot">=</span> EY1out,</span>
<span id="cb300-73"><a href="functions.html#cb300-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0exp&quot;</span> <span class="ot">=</span> EY0exp,</span>
<span id="cb300-74"><a href="functions.html#cb300-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1exp&quot;</span> <span class="ot">=</span> EY1exp,</span>
<span id="cb300-75"><a href="functions.html#cb300-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0exp2&quot;</span> <span class="ot">=</span> EY0exp2,</span>
<span id="cb300-76"><a href="functions.html#cb300-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1exp2&quot;</span> <span class="ot">=</span> EY1exp2,</span>
<span id="cb300-77"><a href="functions.html#cb300-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0dr&quot;</span> <span class="ot">=</span> EY0dr,</span>
<span id="cb300-78"><a href="functions.html#cb300-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1dr&quot;</span> <span class="ot">=</span> EY1dr,</span>
<span id="cb300-79"><a href="functions.html#cb300-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> EYT0,</span>
<span id="cb300-80"><a href="functions.html#cb300-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> EYT1)</span>
<span id="cb300-81"><a href="functions.html#cb300-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-82"><a href="functions.html#cb300-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (out_choice <span class="sc">==</span> <span class="st">&quot;all&quot;</span>) {</span>
<span id="cb300-83"><a href="functions.html#cb300-83" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">append</span>(sim, est)</span>
<span id="cb300-84"><a href="functions.html#cb300-84" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;sim&quot;</span>) {</span>
<span id="cb300-85"><a href="functions.html#cb300-85" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> sim</span>
<span id="cb300-86"><a href="functions.html#cb300-86" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;est&quot;</span>) {</span>
<span id="cb300-87"><a href="functions.html#cb300-87" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> est</span>
<span id="cb300-88"><a href="functions.html#cb300-88" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb300-89"><a href="functions.html#cb300-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s is an invalid out_choice&quot;</span>, out_choice))</span>
<span id="cb300-90"><a href="functions.html#cb300-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb300-91"><a href="functions.html#cb300-91" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb300-92"><a href="functions.html#cb300-92" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="notes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/93-Functions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 2
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
