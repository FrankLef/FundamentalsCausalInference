<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Effect-Measure Modification and Causal Interaction | Study project: Fundamentals of Causal Inferences With R</title>
  <meta name="description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Effect-Measure Modification and Causal Interaction | Study project: Fundamentals of Causal Inferences With R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Effect-Measure Modification and Causal Interaction | Study project: Fundamentals of Causal Inferences With R" />
  
  <meta name="twitter:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  

<meta name="author" content="François Lefebvre" />


<meta name="date" content="2022-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="outcomes.html"/>
<link rel="next" href="dag.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Study Project</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html"><i class="fa fa-check"></i>Errata</a>
<ul>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#chapter-1"><i class="fa fa-check"></i>Chapter 1</a>
<ul>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#section-1.2.3.2-p.-11"><i class="fa fa-check"></i>Section 1.2.3.2, p. 11</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#chapter-2"><i class="fa fa-check"></i>Chapter 2</a>
<ul>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#figure-2.1-p.-30"><i class="fa fa-check"></i>Figure 2.1, p. 30</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#chapter-3"><i class="fa fa-check"></i>Chapter 3</a>
<ul>
<li class="chapter" data-level="" data-path="errata.html"><a href="errata.html#typography-section-3.2-p.-40-equation-3.1"><i class="fa fa-check"></i>Typography: section 3.2 p. 40, equation 3.1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html"><i class="fa fa-check"></i>Comments</a>
<ul>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#chapter-2-1"><i class="fa fa-check"></i>Chapter 2</a>
<ul>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#section-2.4-p.-31"><i class="fa fa-check"></i>section 2.4 p. 31</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#chapter-4"><i class="fa fa-check"></i>Chapter 4</a>
<ul>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#section-4.1"><i class="fa fa-check"></i>Section 4.1</a></li>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#section-4.2"><i class="fa fa-check"></i>Section 4.2</a></li>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="comments.html"><a href="comments.html#chapter-5"><i class="fa fa-check"></i>Chapter 5</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-brief-history"><i class="fa fa-check"></i><b>1.1</b> A Brief History</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.2</b> Data Examples</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#mortality-rates-by-country"><i class="fa fa-check"></i><b>1.2.1</b> Mortality Rates by Country</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#national-center-for-education-statistics"><i class="fa fa-check"></i><b>1.2.2</b> National Center for Education Statistics</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#reducing-alcohol-consumption"><i class="fa fa-check"></i><b>1.2.3</b> Reducing Alcohol Consumption</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#general-social-survey"><i class="fa fa-check"></i><b>1.2.4</b> General Social Survey</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#a-cancer-clinical-trial"><i class="fa fa-check"></i><b>1.2.5</b> A Cancer Clinical Trial</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises-1"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#exercise-1-1"><i class="fa fa-check"></i><b>1.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#exercise-2"><i class="fa fa-check"></i><b>1.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#exercise-3"><i class="fa fa-check"></i><b>1.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#exercise-4"><i class="fa fa-check"></i><b>1.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#exercise-5-1"><i class="fa fa-check"></i><b>1.3.5</b> Exercise 5</a></li>
<li class="chapter" data-level="1.3.6" data-path="intro.html"><a href="intro.html#exercise-6"><i class="fa fa-check"></i><b>1.3.6</b> Exercise 6</a></li>
<li class="chapter" data-level="1.3.7" data-path="intro.html"><a href="intro.html#exercise-7"><i class="fa fa-check"></i><b>1.3.7</b> Exercise 7</a></li>
<li class="chapter" data-level="1.3.8" data-path="intro.html"><a href="intro.html#exercise-8"><i class="fa fa-check"></i><b>1.3.8</b> Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>2</b> Conditional Probability and Expectation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>2.1</b> Conditional Probability</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="probability.html"><a href="probability.html#law-of-total-probability"><i class="fa fa-check"></i><b>2.1.1</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability.html"><a href="probability.html#conditional-expectation-and-he-law-of-total-expectation"><i class="fa fa-check"></i><b>2.2</b> Conditional Expectation and he Law of Total expectation</a></li>
<li class="chapter" data-level="2.3" data-path="probability.html"><a href="probability.html#estimation"><i class="fa fa-check"></i><b>2.3</b> Estimation</a></li>
<li class="chapter" data-level="2.4" data-path="probability.html"><a href="probability.html#sampling-distributions-and-the-bootstrap"><i class="fa fa-check"></i><b>2.4</b> Sampling Distributions and the Bootstrap</a></li>
<li class="chapter" data-level="2.5" data-path="probability.html"><a href="probability.html#exercises-2"><i class="fa fa-check"></i><b>2.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="probability.html"><a href="probability.html#exercise-1-2"><i class="fa fa-check"></i><b>2.5.1</b> Exercise 1</a></li>
<li class="chapter" data-level="2.5.2" data-path="probability.html"><a href="probability.html#exercise-2-1"><i class="fa fa-check"></i><b>2.5.2</b> Exercise 2</a></li>
<li class="chapter" data-level="2.5.3" data-path="probability.html"><a href="probability.html#exercise-3-1"><i class="fa fa-check"></i><b>2.5.3</b> Exercise 3</a></li>
<li class="chapter" data-level="2.5.4" data-path="probability.html"><a href="probability.html#exercise-4-1"><i class="fa fa-check"></i><b>2.5.4</b> Exercise 4</a></li>
<li class="chapter" data-level="2.5.5" data-path="probability.html"><a href="probability.html#exercise-5-2"><i class="fa fa-check"></i><b>2.5.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="outcomes.html"><a href="outcomes.html"><i class="fa fa-check"></i><b>3</b> Potential Outcomes and the Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="outcomes.html"><a href="outcomes.html#potential-outcomes-and-the-consistency-assumption"><i class="fa fa-check"></i><b>3.1</b> Potential Outcomes and the Consistency Assumption</a></li>
<li class="chapter" data-level="3.2" data-path="outcomes.html"><a href="outcomes.html#circumventing-the-fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>3.2</b> Circumventing the Fundamental Problem of Causal Inference</a></li>
<li class="chapter" data-level="3.3" data-path="outcomes.html"><a href="outcomes.html#effect-measures"><i class="fa fa-check"></i><b>3.3</b> Effect Measures</a></li>
<li class="chapter" data-level="3.4" data-path="outcomes.html"><a href="outcomes.html#exercises-3"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="outcomes.html"><a href="outcomes.html#exercise-1-3"><i class="fa fa-check"></i><b>3.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="3.4.2" data-path="outcomes.html"><a href="outcomes.html#exercise-2-2"><i class="fa fa-check"></i><b>3.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4.3" data-path="outcomes.html"><a href="outcomes.html#exercise-3-2"><i class="fa fa-check"></i><b>3.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="3.4.4" data-path="outcomes.html"><a href="outcomes.html#exercise-4-2"><i class="fa fa-check"></i><b>3.4.4</b> Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>4</b> Effect-Measure Modification and Causal Interaction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="measures.html"><a href="measures.html#effect-measure-modification-and-statistical-interaction"><i class="fa fa-check"></i><b>4.1</b> Effect-Measure Modification and Statistical Interaction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="measures.html"><a href="measures.html#recovery-trial"><i class="fa fa-check"></i><b>4.1.1</b> RECOVERY trial</a></li>
<li class="chapter" data-level="4.1.2" data-path="measures.html"><a href="measures.html#nces"><i class="fa fa-check"></i><b>4.1.2</b> NCES</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="measures.html"><a href="measures.html#qualitative-agreement-of-effect-measures-in-modification"><i class="fa fa-check"></i><b>4.2</b> Qualitative Agreement of Effect Measures in Modification</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="measures.html"><a href="measures.html#algorithm"><i class="fa fa-check"></i><b>4.2.1</b> Algorithm</a></li>
<li class="chapter" data-level="4.2.2" data-path="measures.html"><a href="measures.html#simulate-the-effect-measures"><i class="fa fa-check"></i><b>4.2.2</b> Simulate the effect measures</a></li>
<li class="chapter" data-level="4.2.3" data-path="measures.html"><a href="measures.html#applications-1"><i class="fa fa-check"></i><b>4.2.3</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="measures.html"><a href="measures.html#causal-interaction"><i class="fa fa-check"></i><b>4.3</b> Causal Interaction</a></li>
<li class="chapter" data-level="4.4" data-path="measures.html"><a href="measures.html#exercises-4"><i class="fa fa-check"></i><b>4.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="measures.html"><a href="measures.html#exercise-1-4"><i class="fa fa-check"></i><b>4.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="measures.html"><a href="measures.html#exercise-2-3"><i class="fa fa-check"></i><b>4.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="measures.html"><a href="measures.html#exercise-3-3"><i class="fa fa-check"></i><b>4.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="measures.html"><a href="measures.html#exercise-4-3"><i class="fa fa-check"></i><b>4.4.4</b> Exercise 4</a></li>
<li class="chapter" data-level="4.4.5" data-path="measures.html"><a href="measures.html#exercise-5-3"><i class="fa fa-check"></i><b>4.4.5</b> Exercise 5</a></li>
<li class="chapter" data-level="4.4.6" data-path="measures.html"><a href="measures.html#exercise-6-1"><i class="fa fa-check"></i><b>4.4.6</b> Exercise 6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dag.html"><a href="dag.html"><i class="fa fa-check"></i><b>5</b> Causal Directed Acyclic Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dag.html"><a href="dag.html#theory"><i class="fa fa-check"></i><b>5.1</b> Theory</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dag.html"><a href="dag.html#conditional-indepence-and-dag"><i class="fa fa-check"></i><b>5.1.1</b> Conditional Indepence and DAG</a></li>
<li class="chapter" data-level="5.1.2" data-path="dag.html"><a href="dag.html#d-separation"><i class="fa fa-check"></i><b>5.1.2</b> D-Separation</a></li>
<li class="chapter" data-level="5.1.3" data-path="dag.html"><a href="dag.html#causal-dag-with-collider"><i class="fa fa-check"></i><b>5.1.3</b> Causal DAG with collider</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dag.html"><a href="dag.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="dag.html"><a href="dag.html#causal-dag-with-intermediate-value"><i class="fa fa-check"></i><b>5.2.1</b> Causal DAG With Intermediate Value</a></li>
<li class="chapter" data-level="5.2.2" data-path="dag.html"><a href="dag.html#a-counfounder-may-occur-after-the-exposure"><i class="fa fa-check"></i><b>5.2.2</b> A counfounder may occur after the exposure</a></li>
<li class="chapter" data-level="5.2.3" data-path="dag.html"><a href="dag.html#potential-outcomes-are-the-ultimate-counfounder"><i class="fa fa-check"></i><b>5.2.3</b> Potential Outcomes are the Ultimate Counfounder</a></li>
<li class="chapter" data-level="5.2.4" data-path="dag.html"><a href="dag.html#structural-causal-model-5.7"><i class="fa fa-check"></i><b>5.2.4</b> Structural Causal Model 5.7</a></li>
<li class="chapter" data-level="5.2.5" data-path="dag.html"><a href="dag.html#potential-outcomes-behind-the-scenes"><i class="fa fa-check"></i><b>5.2.5</b> Potential Outcomes Behind the Scenes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dag.html"><a href="dag.html#exercises-5"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="dag.html"><a href="dag.html#exercise-1-5"><i class="fa fa-check"></i><b>5.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="5.3.2" data-path="dag.html"><a href="dag.html#exercise-2-4"><i class="fa fa-check"></i><b>5.3.2</b> Exercise 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="backdoor.html"><a href="backdoor.html"><i class="fa fa-check"></i><b>6</b> Backdoor Method via Standardization</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study project: Fundamentals of Causal Inferences With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="measures" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Effect-Measure Modification and Causal Interaction</h1>
<div id="effect-measure-modification-and-statistical-interaction" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Effect-Measure Modification and Statistical Interaction</h2>
<div id="recovery-trial" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> RECOVERY trial</h3>
<p>Create the data.frame for <em>RECOVERY</em> trial</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="measures.html#cb70-1" aria-hidden="true" tabindex="-1"></a>recovery <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">Y =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">M =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb70-2"><a href="measures.html#cb70-2" aria-hidden="true" tabindex="-1"></a>recovery<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">787</span>, <span class="dv">2851</span>, <span class="dv">368</span>, <span class="dv">1412</span>, <span class="dv">278</span>, <span class="dv">405</span>, <span class="dv">86</span>, <span class="dv">238</span>))</span>
<span id="cb70-3"><a href="measures.html#cb70-3" aria-hidden="true" tabindex="-1"></a>recovery <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(recovery)), <span class="at">FUN =</span> <span class="cf">function</span>(i) {</span>
<span id="cb70-4"><a href="measures.html#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb70-5"><a href="measures.html#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">M =</span> <span class="fu">rep</span>(recovery<span class="sc">$</span>M[i], recovery<span class="sc">$</span>n[i]),</span>
<span id="cb70-6"><a href="measures.html#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rep</span>(recovery<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span>[i], recovery<span class="sc">$</span>n[i]),</span>
<span id="cb70-7"><a href="measures.html#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">rep</span>(recovery<span class="sc">$</span>Y[i], recovery<span class="sc">$</span>n[i])</span>
<span id="cb70-8"><a href="measures.html#cb70-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-9"><a href="measures.html#cb70-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb70-10"><a href="measures.html#cb70-10" aria-hidden="true" tabindex="-1"></a>recovery <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, recovery)</span>
<span id="cb70-11"><a href="measures.html#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create an id variable for use with gee() later</span></span>
<span id="cb70-12"><a href="measures.html#cb70-12" aria-hidden="true" tabindex="-1"></a>recovery<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(recovery))</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="measures.html#cb71-1" aria-hidden="true" tabindex="-1"></a>boot.r <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">formula =</span> Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> M, <span class="at">R =</span> <span class="dv">1000</span>, <span class="at">conf =</span> <span class="fl">0.95</span>) {</span>
<span id="cb71-2"><a href="measures.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT:</span></span>
<span id="cb71-3"><a href="measures.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  The formula must always be in form Y ~ `T` + M, that is with only</span></span>
<span id="cb71-4"><a href="measures.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  2 predictors: T as the treatment variable and M as the modifier</span></span>
<span id="cb71-5"><a href="measures.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  variable</span></span>
<span id="cb71-6"><a href="measures.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-7"><a href="measures.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the name of the response variable</span></span>
<span id="cb71-8"><a href="measures.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">all.vars</span>(formula[[<span class="dv">2</span>]])</span>
<span id="cb71-9"><a href="measures.html#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the name of the treatment variable</span></span>
<span id="cb71-10"><a href="measures.html#cb71-10" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">all.vars</span>(formula[[<span class="dv">3</span>]])[<span class="dv">1</span>]</span>
<span id="cb71-11"><a href="measures.html#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the name of the modifier variable</span></span>
<span id="cb71-12"><a href="measures.html#cb71-12" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">all.vars</span>(formula[[<span class="dv">3</span>]])[<span class="dv">2</span>]</span>
<span id="cb71-13"><a href="measures.html#cb71-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-14"><a href="measures.html#cb71-14" aria-hidden="true" tabindex="-1"></a>  bootinside.r <span class="ot">&lt;-</span> <span class="cf">function</span>(data, ids) {</span>
<span id="cb71-15"><a href="measures.html#cb71-15" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> data[ids, ]</span>
<span id="cb71-16"><a href="measures.html#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># estimate the expected potential outcomes</span></span>
<span id="cb71-17"><a href="measures.html#cb71-17" aria-hidden="true" tabindex="-1"></a>    EYT0.M0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat[dat[, t] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dat[, m] <span class="sc">==</span> <span class="dv">0</span>, y])</span>
<span id="cb71-18"><a href="measures.html#cb71-18" aria-hidden="true" tabindex="-1"></a>    EYT0.M1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat[dat[, t] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> dat[, m] <span class="sc">==</span> <span class="dv">1</span>, y])</span>
<span id="cb71-19"><a href="measures.html#cb71-19" aria-hidden="true" tabindex="-1"></a>    EYT1.M0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat[dat[, t] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> dat[, m] <span class="sc">==</span> <span class="dv">0</span>, y])</span>
<span id="cb71-20"><a href="measures.html#cb71-20" aria-hidden="true" tabindex="-1"></a>    EYT1.M1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat[dat[, t] <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> dat[, m] <span class="sc">==</span> <span class="dv">1</span>, y])</span>
<span id="cb71-21"><a href="measures.html#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># estimate the effect measures</span></span>
<span id="cb71-22"><a href="measures.html#cb71-22" aria-hidden="true" tabindex="-1"></a>    RD.M0 <span class="ot">&lt;-</span> EYT1.M0 <span class="sc">-</span> EYT0.M0</span>
<span id="cb71-23"><a href="measures.html#cb71-23" aria-hidden="true" tabindex="-1"></a>    RD.M1 <span class="ot">&lt;-</span> EYT1.M1 <span class="sc">-</span> EYT0.M1</span>
<span id="cb71-24"><a href="measures.html#cb71-24" aria-hidden="true" tabindex="-1"></a>    logRR.M0 <span class="ot">&lt;-</span> <span class="fu">log</span>(EYT1.M0 <span class="sc">/</span> EYT0.M0)</span>
<span id="cb71-25"><a href="measures.html#cb71-25" aria-hidden="true" tabindex="-1"></a>    logRR.M1 <span class="ot">&lt;-</span> <span class="fu">log</span>(EYT1.M1 <span class="sc">/</span> EYT0.M1)</span>
<span id="cb71-26"><a href="measures.html#cb71-26" aria-hidden="true" tabindex="-1"></a>    logRRstar.M0 <span class="ot">&lt;-</span> <span class="fu">log</span>((<span class="dv">1</span> <span class="sc">-</span> EYT0.M0) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EYT1.M0))</span>
<span id="cb71-27"><a href="measures.html#cb71-27" aria-hidden="true" tabindex="-1"></a>    logRRstar.M1 <span class="ot">&lt;-</span> <span class="fu">log</span>((<span class="dv">1</span> <span class="sc">-</span> EYT0.M1) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EYT1.M1))</span>
<span id="cb71-28"><a href="measures.html#cb71-28" aria-hidden="true" tabindex="-1"></a>    logOR.M0 <span class="ot">&lt;-</span> logRR.M0 <span class="sc">+</span> logRRstar.M0</span>
<span id="cb71-29"><a href="measures.html#cb71-29" aria-hidden="true" tabindex="-1"></a>    logOR.M1 <span class="ot">&lt;-</span> logRR.M1 <span class="sc">+</span> logRRstar.M1</span>
<span id="cb71-30"><a href="measures.html#cb71-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the effect measure difference</span></span>
<span id="cb71-31"><a href="measures.html#cb71-31" aria-hidden="true" tabindex="-1"></a>    EYT0.diff <span class="ot">&lt;-</span> EYT0.M1 <span class="sc">-</span> EYT0.M0</span>
<span id="cb71-32"><a href="measures.html#cb71-32" aria-hidden="true" tabindex="-1"></a>    EYT1.diff <span class="ot">&lt;-</span> EYT1.M1 <span class="sc">-</span> EYT1.M0</span>
<span id="cb71-33"><a href="measures.html#cb71-33" aria-hidden="true" tabindex="-1"></a>    RD.diff <span class="ot">&lt;-</span> RD.M1 <span class="sc">-</span> RD.M0</span>
<span id="cb71-34"><a href="measures.html#cb71-34" aria-hidden="true" tabindex="-1"></a>    logRR.diff <span class="ot">&lt;-</span> logRR.M1 <span class="sc">-</span> logRR.M0</span>
<span id="cb71-35"><a href="measures.html#cb71-35" aria-hidden="true" tabindex="-1"></a>    logRRstar.diff <span class="ot">&lt;-</span> logRRstar.M1 <span class="sc">-</span> logRRstar.M0</span>
<span id="cb71-36"><a href="measures.html#cb71-36" aria-hidden="true" tabindex="-1"></a>    logOR.diff <span class="ot">&lt;-</span> logOR.M1 <span class="sc">-</span> logOR.M0</span>
<span id="cb71-37"><a href="measures.html#cb71-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-38"><a href="measures.html#cb71-38" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(EYT0.M0, EYT0.M1, EYT1.M0, EYT1.M1, RD.M0, RD.M1,</span>
<span id="cb71-39"><a href="measures.html#cb71-39" aria-hidden="true" tabindex="-1"></a>             logRR.M0, logRR.M1, logRRstar.M0, logRRstar.M1,</span>
<span id="cb71-40"><a href="measures.html#cb71-40" aria-hidden="true" tabindex="-1"></a>             logOR.M0, logOR.M1, EYT0.diff, EYT1.diff, </span>
<span id="cb71-41"><a href="measures.html#cb71-41" aria-hidden="true" tabindex="-1"></a>             RD.diff, logRR.diff, logRRstar.diff, logOR.diff)</span>
<span id="cb71-42"><a href="measures.html#cb71-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;EYT0.M0&quot;</span>, <span class="st">&quot;EYT0.M1&quot;</span>, <span class="st">&quot;EYT1.M0&quot;</span>, <span class="st">&quot;EYT1.M1&quot;</span>, <span class="st">&quot;RD.M0&quot;</span>, <span class="st">&quot;RD.M1&quot;</span>,</span>
<span id="cb71-43"><a href="measures.html#cb71-43" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;logRR.M0&quot;</span>, <span class="st">&quot;logRR.M1&quot;</span>, <span class="st">&quot;logRRstar.M0&quot;</span>, <span class="st">&quot;logRRstar.M1&quot;</span>,</span>
<span id="cb71-44"><a href="measures.html#cb71-44" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;logOR.M0&quot;</span>, <span class="st">&quot;logOR.M1&quot;</span>, <span class="st">&quot;EYT0.diff&quot;</span>, <span class="st">&quot;EYT1.diff&quot;</span>, </span>
<span id="cb71-45"><a href="measures.html#cb71-45" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;RD.diff&quot;</span>, <span class="st">&quot;logRR.diff&quot;</span>, <span class="st">&quot;logRRstar.diff&quot;</span>, <span class="st">&quot;logOR.diff&quot;</span>)</span>
<span id="cb71-46"><a href="measures.html#cb71-46" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb71-47"><a href="measures.html#cb71-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-48"><a href="measures.html#cb71-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate bootstrap confidence intervals and point estimate</span></span>
<span id="cb71-49"><a href="measures.html#cb71-49" aria-hidden="true" tabindex="-1"></a>  boot.out <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot</span>(<span class="at">data =</span> dat, <span class="at">statistic =</span> bootinside.r, <span class="at">R =</span> R)</span>
<span id="cb71-50"><a href="measures.html#cb71-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-51"><a href="measures.html#cb71-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the estimated values and confidence intervals from the boot object</span></span>
<span id="cb71-52"><a href="measures.html#cb71-52" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> <span class="fu">seq_along</span>(boot.out<span class="sc">$</span>t0), <span class="at">FUN =</span> <span class="cf">function</span>(i) {</span>
<span id="cb71-53"><a href="measures.html#cb71-53" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">&lt;-</span> boot.out<span class="sc">$</span>t0[i]</span>
<span id="cb71-54"><a href="measures.html#cb71-54" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> boot<span class="sc">::</span><span class="fu">boot.ci</span>(boot.out, <span class="at">conf =</span> conf, <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>, <span class="at">index =</span> i)<span class="sc">$</span>normal</span>
<span id="cb71-55"><a href="measures.html#cb71-55" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">c</span>(est, ci)</span>
<span id="cb71-56"><a href="measures.html#cb71-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(out) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;conf&quot;</span>, <span class="st">&quot;lci&quot;</span>, <span class="st">&quot;uci&quot;</span>)</span>
<span id="cb71-57"><a href="measures.html#cb71-57" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb71-58"><a href="measures.html#cb71-58" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb71-59"><a href="measures.html#cb71-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-60"><a href="measures.html#cb71-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the dataframe to hold the results</span></span>
<span id="cb71-61"><a href="measures.html#cb71-61" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(out))</span>
<span id="cb71-62"><a href="measures.html#cb71-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the first column as the names of the results</span></span>
<span id="cb71-63"><a href="measures.html#cb71-63" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">names</span>(boot.out<span class="sc">$</span>t0), out)</span>
<span id="cb71-64"><a href="measures.html#cb71-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-65"><a href="measures.html#cb71-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert link to natural scales and add to output</span></span>
<span id="cb71-66"><a href="measures.html#cb71-66" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;RR.M0&quot;</span> <span class="ot">=</span> <span class="st">&quot;logRR.M0&quot;</span>, <span class="st">&quot;RR.M1&quot;</span> <span class="ot">=</span> <span class="st">&quot;logRR.M1&quot;</span>, <span class="st">&quot;RR.diff&quot;</span>  <span class="ot">=</span> <span class="st">&quot;logRR.diff&quot;</span>,</span>
<span id="cb71-67"><a href="measures.html#cb71-67" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;RRstar.M0&quot;</span>  <span class="ot">=</span> <span class="st">&quot;logRRstar.M0&quot;</span>, <span class="st">&quot;RRstar.M1&quot;</span>  <span class="ot">=</span> <span class="st">&quot;logRRstar.M1&quot;</span>, <span class="st">&quot;RRstar.diff&quot;</span> <span class="ot">=</span> <span class="st">&quot;logRRstar.diff&quot;</span>,</span>
<span id="cb71-68"><a href="measures.html#cb71-68" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;OR.M0&quot;</span> <span class="ot">=</span> <span class="st">&quot;logOR.M0&quot;</span>, <span class="st">&quot;OR.M1&quot;</span> <span class="ot">=</span> <span class="st">&quot;logOR.M1&quot;</span>, <span class="st">&quot;OR.diff&quot;</span> <span class="ot">=</span> <span class="st">&quot;logOR.diff&quot;</span>)</span>
<span id="cb71-69"><a href="measures.html#cb71-69" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> out[<span class="fu">match</span>(sel, out<span class="sc">$</span>name), ]</span>
<span id="cb71-70"><a href="measures.html#cb71-70" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(<span class="at">X =</span> df[, <span class="fu">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;lci&quot;</span>, <span class="st">&quot;uci&quot;</span>)], <span class="at">FUN =</span> exp))</span>
<span id="cb71-71"><a href="measures.html#cb71-71" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">name =</span> <span class="fu">names</span>(sel), <span class="at">conf =</span> conf, df)</span>
<span id="cb71-72"><a href="measures.html#cb71-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-73"><a href="measures.html#cb71-73" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">rbind</span>(out, df)</span>
<span id="cb71-74"><a href="measures.html#cb71-74" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb71-75"><a href="measures.html#cb71-75" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>run <code>boot.r()</code> with the RECOVERY data set</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="measures.html#cb72-1" aria-hidden="true" tabindex="-1"></a>recovery.out <span class="ot">&lt;-</span> <span class="fu">boot.r</span>(recovery, <span class="at">formula =</span> Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> M)</span></code></pre></div>
<p>verify the results with the author’s on p. 65.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="measures.html#cb73-1" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-2"><a href="measures.html#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;EYT0.M0&quot;</span>, <span class="st">&quot;EYT0.M1&quot;</span>, <span class="st">&quot;EYT1.M0&quot;</span>, <span class="st">&quot;EYT1.M1&quot;</span>, <span class="st">&quot;RD.M0&quot;</span>, <span class="st">&quot;RD.M1&quot;</span>,</span>
<span id="cb73-3"><a href="measures.html#cb73-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;EYT0.diff&quot;</span>, <span class="st">&quot;EYT1.diff&quot;</span>, <span class="st">&quot;RD.diff&quot;</span>, <span class="st">&quot;RR.M0&quot;</span>, <span class="st">&quot;RR.M1&quot;</span>, <span class="st">&quot;RR.diff&quot;</span>,</span>
<span id="cb73-4"><a href="measures.html#cb73-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;RRstar.M0&quot;</span>, <span class="st">&quot;RRstar.M1&quot;</span>, <span class="st">&quot;RRstar.diff&quot;</span>, <span class="st">&quot;OR.M0&quot;</span>, <span class="st">&quot;OR.M1&quot;</span>, <span class="st">&quot;OR.diff&quot;</span>),</span>
<span id="cb73-5"><a href="measures.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">est =</span> <span class="fu">c</span>(<span class="fl">0.784</span>, <span class="fl">0.593</span>, <span class="fl">0.793</span>, <span class="fl">0.735</span>, <span class="fl">0.01</span>, <span class="fl">0.142</span>,</span>
<span id="cb73-6"><a href="measures.html#cb73-6" aria-hidden="true" tabindex="-1"></a>          <span class="sc">-</span><span class="fl">0.191</span>, <span class="sc">-</span><span class="fl">0.059</span>, <span class="fl">0.132</span>, <span class="fl">1.012</span>, <span class="fl">1.239</span>, <span class="fl">1.224</span>,</span>
<span id="cb73-7"><a href="measures.html#cb73-7" aria-hidden="true" tabindex="-1"></a>          <span class="fl">1.046</span>, <span class="fl">1.533</span>, <span class="fl">1.466</span>, <span class="fl">1.059</span>, <span class="fl">1.9</span>, <span class="fl">1.794</span>)</span>
<span id="cb73-8"><a href="measures.html#cb73-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-9"><a href="measures.html#cb73-9" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bb =</span> bb,</span>
<span id="cb73-10"><a href="measures.html#cb73-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">d =</span> recovery.out[<span class="fu">match</span>(bb<span class="sc">$</span>name, recovery.out<span class="sc">$</span>name), <span class="st">&quot;est&quot;</span>])</span>
<span id="cb73-11"><a href="measures.html#cb73-11" aria-hidden="true" tabindex="-1"></a>comp<span class="sc">$</span>dev <span class="ot">&lt;-</span> <span class="fu">abs</span>(comp<span class="sc">$</span>bb.est <span class="sc">-</span> comp<span class="sc">$</span>d)</span>
<span id="cb73-12"><a href="measures.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">sum</span>(comp<span class="sc">$</span>dev) <span class="sc">&lt;</span> <span class="fl">0.01</span>)</span></code></pre></div>
<p>and we communicate the results in a table</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="measures.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we create a function for the table as it will be used again</span></span>
<span id="cb74-2"><a href="measures.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># later in this chapter</span></span>
<span id="cb74-3"><a href="measures.html#cb74-3" aria-hidden="true" tabindex="-1"></a>tbl_boot.r <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">title =</span> <span class="st">&quot;Effect Measures and CI&quot;</span>,</span>
<span id="cb74-4"><a href="measures.html#cb74-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">subtitle =</span> <span class="st">&quot;Effect-measure Modification&quot;</span>) {</span>
<span id="cb74-5"><a href="measures.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prepare the dataframe to create the table</span></span>
<span id="cb74-6"><a href="measures.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="measures.html#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&quot;log.+&quot;</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="measures.html#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>conf) <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="measures.html#cb74-9" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(est, lci, uci), <span class="at">names_to =</span> <span class="st">&quot;point&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-10"><a href="measures.html#cb74-10" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;stratum&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;[.]&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-11"><a href="measures.html#cb74-11" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unite</span>(<span class="at">col =</span> <span class="st">&quot;estimate&quot;</span>, stratum, point, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-12"><a href="measures.html#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;estimate&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb74-13"><a href="measures.html#cb74-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-14"><a href="measures.html#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the table with gt</span></span>
<span id="cb74-15"><a href="measures.html#cb74-15" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>(df, <span class="at">rowname_col =</span> <span class="st">&quot;name&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-16"><a href="measures.html#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, title, <span class="st">&quot;**&quot;</span>)), </span>
<span id="cb74-17"><a href="measures.html#cb74-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="fu">paste0</span>(<span class="st">&quot;**&quot;</span>, subtitle, <span class="st">&quot;**&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb74-18"><a href="measures.html#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_spanner_delim</span>(<span class="at">delim =</span> <span class="st">&quot;_&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">split =</span> <span class="st">&quot;last&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-19"><a href="measures.html#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-20"><a href="measures.html#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">columns =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb74-21"><a href="measures.html#cb74-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">opt_row_striping</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-22"><a href="measures.html#cb74-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb74-23"><a href="measures.html#cb74-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_borders</span>(<span class="at">sides =</span> <span class="st">&quot;left&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey60&quot;</span>, </span>
<span id="cb74-24"><a href="measures.html#cb74-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weight =</span> <span class="fu">px</span>(<span class="fl">1.5</span>), <span class="at">style =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb74-25"><a href="measures.html#cb74-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_body</span>( <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;M1_est&quot;</span>, <span class="st">&quot;diff_est&quot;</span>))</span>
<span id="cb74-26"><a href="measures.html#cb74-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb74-27"><a href="measures.html#cb74-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb74-28"><a href="measures.html#cb74-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_borders</span>(<span class="at">sides =</span> <span class="st">&quot;left&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey60&quot;</span>, </span>
<span id="cb74-29"><a href="measures.html#cb74-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weight =</span> <span class="fu">px</span>(<span class="fl">1.5</span>), <span class="at">style =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb74-30"><a href="measures.html#cb74-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">&quot;M1_est&quot;</span>, <span class="st">&quot;diff_est&quot;</span>))</span>
<span id="cb74-31"><a href="measures.html#cb74-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb74-32"><a href="measures.html#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_options</span>(</span>
<span id="cb74-33"><a href="measures.html#cb74-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.title.font.weight =</span> <span class="st">&quot;bold&quot;</span>, </span>
<span id="cb74-34"><a href="measures.html#cb74-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.subtitle.font.weight =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb74-35"><a href="measures.html#cb74-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.background.color =</span> <span class="st">&quot;gainsboro&quot;</span>,</span>
<span id="cb74-36"><a href="measures.html#cb74-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">column_labels.font.weight =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb74-37"><a href="measures.html#cb74-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-38"><a href="measures.html#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_boot.r</span>(recovery.out, <span class="at">title =</span> <span class="st">&quot;Table 4.2 RECOVERY Trial&quot;</span>)</span></code></pre></div>
<div id="eulqiaiajz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#eulqiaiajz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#eulqiaiajz .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eulqiaiajz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#eulqiaiajz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: bold;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#eulqiaiajz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eulqiaiajz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eulqiaiajz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#eulqiaiajz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#eulqiaiajz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#eulqiaiajz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#eulqiaiajz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#eulqiaiajz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#eulqiaiajz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#eulqiaiajz .gt_from_md > :first-child {
  margin-top: 0;
}

#eulqiaiajz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#eulqiaiajz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#eulqiaiajz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#eulqiaiajz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eulqiaiajz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#eulqiaiajz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eulqiaiajz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#eulqiaiajz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#eulqiaiajz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eulqiaiajz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eulqiaiajz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#eulqiaiajz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eulqiaiajz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#eulqiaiajz .gt_left {
  text-align: left;
}

#eulqiaiajz .gt_center {
  text-align: center;
}

#eulqiaiajz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#eulqiaiajz .gt_font_normal {
  font-weight: normal;
}

#eulqiaiajz .gt_font_bold {
  font-weight: bold;
}

#eulqiaiajz .gt_font_italic {
  font-style: italic;
}

#eulqiaiajz .gt_super {
  font-size: 65%;
}

#eulqiaiajz .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="10" class="gt_heading gt_title gt_font_normal" style><strong>Table 4.2 RECOVERY Trial</strong></th>
    </tr>
    <tr>
      <th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Effect-measure Modification</strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1"></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M0</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M1</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">diff</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left gt_stub">EYT0</td>
<td class="gt_row gt_center">0.78</td>
<td class="gt_row gt_center">0.77</td>
<td class="gt_row gt_center">0.80</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.59</td>
<td class="gt_row gt_center">0.55</td>
<td class="gt_row gt_center">0.63</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.19</td>
<td class="gt_row gt_center">&minus;0.23</td>
<td class="gt_row gt_center">&minus;0.15</td></tr>
    <tr><td class="gt_row gt_left gt_stub">EYT1</td>
<td class="gt_row gt_center gt_striped">0.79</td>
<td class="gt_row gt_center gt_striped">0.78</td>
<td class="gt_row gt_center gt_striped">0.81</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.73</td>
<td class="gt_row gt_center gt_striped">0.69</td>
<td class="gt_row gt_center gt_striped">0.78</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.06</td>
<td class="gt_row gt_center gt_striped">&minus;0.11</td>
<td class="gt_row gt_center gt_striped">&minus;0.01</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RD</td>
<td class="gt_row gt_center">0.01</td>
<td class="gt_row gt_center">&minus;0.01</td>
<td class="gt_row gt_center">0.03</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.14</td>
<td class="gt_row gt_center">0.08</td>
<td class="gt_row gt_center">0.20</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.13</td>
<td class="gt_row gt_center">0.07</td>
<td class="gt_row gt_center">0.20</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RR</td>
<td class="gt_row gt_center gt_striped">1.01</td>
<td class="gt_row gt_center gt_striped">0.98</td>
<td class="gt_row gt_center gt_striped">1.04</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.24</td>
<td class="gt_row gt_center gt_striped">1.13</td>
<td class="gt_row gt_center gt_striped">1.36</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.22</td>
<td class="gt_row gt_center gt_striped">1.11</td>
<td class="gt_row gt_center gt_striped">1.35</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RRstar</td>
<td class="gt_row gt_center">1.05</td>
<td class="gt_row gt_center">0.94</td>
<td class="gt_row gt_center">1.17</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.53</td>
<td class="gt_row gt_center">1.25</td>
<td class="gt_row gt_center">1.87</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.47</td>
<td class="gt_row gt_center">1.16</td>
<td class="gt_row gt_center">1.84</td></tr>
    <tr><td class="gt_row gt_left gt_stub">OR</td>
<td class="gt_row gt_center gt_striped">1.06</td>
<td class="gt_row gt_center gt_striped">0.92</td>
<td class="gt_row gt_center gt_striped">1.22</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.90</td>
<td class="gt_row gt_center gt_striped">1.43</td>
<td class="gt_row gt_center gt_striped">2.52</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.79</td>
<td class="gt_row gt_center gt_striped">1.29</td>
<td class="gt_row gt_center gt_striped">2.47</td></tr>
  </tbody>
  
  
</table>
</div>
<p>plotting the results makes it easier to see the measures vary among
the strata. We can clearly see here significant difference in effect measures
between the 2 strata.</p>
<p>It supports the observation in the text concerning the
lack of effect of dexamethasone without intrusive mechanical ventilation (M0)
vs its use with intrusive mechanical ventilation (M1) which is significant.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="measures.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we create a function for the plot as it will be used </span></span>
<span id="cb75-2"><a href="measures.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># again later in this chapter</span></span>
<span id="cb75-3"><a href="measures.html#cb75-3" aria-hidden="true" tabindex="-1"></a>plot_boot.r <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">title =</span> <span class="st">&quot;Change in effect measures&quot;</span>) {</span>
<span id="cb75-4"><a href="measures.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># preapre the dataframe used to pcreate the plot</span></span>
<span id="cb75-5"><a href="measures.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="measures.html#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&quot;log.+&quot;</span>, name)) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="measures.html#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>conf) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="measures.html#cb75-8" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> <span class="st">&quot;name&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;stratum&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;[.]&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-9"><a href="measures.html#cb75-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(stratum <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb75-10"><a href="measures.html#cb75-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-11"><a href="measures.html#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the plot</span></span>
<span id="cb75-12"><a href="measures.html#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, </span>
<span id="cb75-13"><a href="measures.html#cb75-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> stratum, <span class="at">y =</span> est, <span class="at">color =</span> name, <span class="at">linetype =</span> name, <span class="at">group =</span> name)) <span class="sc">+</span></span>
<span id="cb75-14"><a href="measures.html#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb75-15"><a href="measures.html#cb75-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> name), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb75-16"><a href="measures.html#cb75-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(est, <span class="dv">1</span>)),</span>
<span id="cb75-17"><a href="measures.html#cb75-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">nudge_x =</span> <span class="fl">0.05</span>, <span class="at">nudge_y =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb75-18"><a href="measures.html#cb75-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> <span class="st">&quot;dashed&quot;</span>, <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb75-19"><a href="measures.html#cb75-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;OR&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;RD&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, </span>
<span id="cb75-20"><a href="measures.html#cb75-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> <span class="st">&quot;solid&quot;</span>)) <span class="sc">+</span></span>
<span id="cb75-21"><a href="measures.html#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb75-22"><a href="measures.html#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb75-23"><a href="measures.html#cb75-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb75-24"><a href="measures.html#cb75-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title,</span>
<span id="cb75-25"><a href="measures.html#cb75-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">&quot;Effect-Measure Modification and Statistical Interaction&quot;</span>,</span>
<span id="cb75-26"><a href="measures.html#cb75-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;estimated expected value&quot;</span>)</span>
<span id="cb75-27"><a href="measures.html#cb75-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="measures.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_boot.r</span>(recovery.out, <span class="at">title =</span> <span class="st">&quot;RECOVERY trial&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>The <code>gee::gee()</code> function is used to find information on the coefficients
and see if they are statistically significant. The same could be done
withe <code>glm::glm()</code> but <code>gee</code> offers results with robust statistics which
is very useful in practical terms.</p>
<p>Luckily, the <code>gee()</code> works exactly like the <code>glm()</code> functions, with the same
extractor functions <code>coefficients()</code>, <code>effects()</code>, etc. See the documentation
of <code>lm</code> with <code>?lm</code> for more details.</p>
<p>We are going through an example just below to illustrate how tthe extractor
functions are used which is not shown in the textbook.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="measures.html#cb77-1" aria-hidden="true" tabindex="-1"></a>linmod <span class="ot">&lt;-</span> gee<span class="sc">::</span><span class="fu">gee</span>(Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> M <span class="sc">+</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">*</span> M,</span>
<span id="cb77-2"><a href="measures.html#cb77-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> id,</span>
<span id="cb77-3"><a href="measures.html#cb77-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> recovery,</span>
<span id="cb77-4"><a href="measures.html#cb77-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> gaussian)</span></code></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>## (Intercept)           T           M         T:M 
##  0.78367235  0.00958608 -0.19070017  0.13200964</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="measures.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linmod)</span></code></pre></div>
<pre><code>## 
##  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA
##  gee S-function, version 4.13 modified 98/01/27 (1998) 
## 
## Model:
##  Link:                      Identity 
##  Variance to Mean Relation: Gaussian 
##  Correlation Structure:     Independent 
## 
## Call:
## gee::gee(formula = Y ~ T + M + T * M, id = id, data = recovery, 
##     family = gaussian)
## 
## Summary of Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.7932584  0.2067416  0.2163277  0.2163277  0.4070278 
## 
## 
## Coefficients:
##                Estimate  Naive S.E.     Naive z Robust S.E.    Robust z
## (Intercept)  0.78367235 0.006975704 112.3431253 0.006826403 114.8001855
## T            0.00958608 0.012170195   0.7876686 0.011778554   0.8138588
## M           -0.19070017 0.017545664 -10.8687918 0.019999408  -9.5352906
## T:M          0.13200964 0.030881745   4.2746820 0.033074076   3.9913327
## 
## Estimated Scale Parameter:  0.1770267
## Number of Iterations:  1
## 
## Working Correlation
##      [,1]
## [1,]    1</code></pre>
<p>To extract the coefficients from the <code>gee</code> object we use the extractor function
<code>coefficients()</code> or its alias <code>coef()</code></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="measures.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(linmod)</span></code></pre></div>
<pre><code>## (Intercept)           T           M         T:M 
##  0.78367235  0.00958608 -0.19070017  0.13200964</code></pre>
<p>and to extract the entire coefficient data to work
with it, just use <code>coefficients()</code> with <code>summary()</code></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="measures.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(linmod))</span></code></pre></div>
<pre><code>##                Estimate  Naive S.E.     Naive z Robust S.E.    Robust z
## (Intercept)  0.78367235 0.006975704 112.3431253 0.006826403 114.8001855
## T            0.00958608 0.012170195   0.7876686 0.011778554   0.8138588
## M           -0.19070017 0.017545664 -10.8687918 0.019999408  -9.5352906
## T:M          0.13200964 0.030881745   4.2746820 0.033074076   3.9913327</code></pre>
<p>and in this case we are concerned about how significant the interaction is.
Therefore the <em>Robust z</em> is extracted with <code>coefficients()</code> alias <code>coef()</code></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="measures.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(linmod))[, <span class="st">&quot;Robust z&quot;</span>]</span></code></pre></div>
<pre><code>## (Intercept)           T           M         T:M 
## 114.8001855   0.8138588  -9.5352906   3.9913327</code></pre>
<p>we see that <span class="math inline">\(T:M\)</span> is 3.99 standard deviations away from zero which will give
us the 2-sided p-value that is significant</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="measures.html#cb89-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(linmod))[<span class="st">&quot;T:M&quot;</span>, <span class="st">&quot;Robust z&quot;</span>]</span>
<span id="cb89-2"><a href="measures.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z))</span></code></pre></div>
<pre><code>## [1] 6.570304e-05</code></pre>
</div>
<div id="nces" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> NCES</h3>
<p>We process the <code>NCES</code> data the same way we did for the RECOVERY trial.</p>
<p>Run the bootsrap</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="measures.html#cb91-1" aria-hidden="true" tabindex="-1"></a>nces.out <span class="ot">&lt;-</span> <span class="fu">boot.r</span>(nces, <span class="at">formula =</span> highmathsat <span class="sc">~</span> female <span class="sc">+</span> selective)</span></code></pre></div>
<p>verify the results with the author’s on p. 70.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="measures.html#cb92-1" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb92-2"><a href="measures.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;EYT0.M0&quot;</span>, <span class="st">&quot;EYT0.M1&quot;</span>, <span class="st">&quot;EYT1.M0&quot;</span>, <span class="st">&quot;EYT1.M1&quot;</span>, <span class="st">&quot;RD.M0&quot;</span>, <span class="st">&quot;RD.M1&quot;</span>,</span>
<span id="cb92-3"><a href="measures.html#cb92-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;EYT0.diff&quot;</span>, <span class="st">&quot;EYT1.diff&quot;</span>, <span class="st">&quot;RD.diff&quot;</span>, <span class="st">&quot;RR.M0&quot;</span>, <span class="st">&quot;RR.M1&quot;</span>, <span class="st">&quot;RR.diff&quot;</span>,</span>
<span id="cb92-4"><a href="measures.html#cb92-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;RRstar.M0&quot;</span>, <span class="st">&quot;RRstar.M1&quot;</span>, <span class="st">&quot;RRstar.diff&quot;</span>, <span class="st">&quot;OR.M0&quot;</span>, <span class="st">&quot;OR.M1&quot;</span>, <span class="st">&quot;OR.diff&quot;</span>),</span>
<span id="cb92-5"><a href="measures.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">est =</span> <span class="fu">c</span>(<span class="fl">0.167</span>, <span class="fl">0.675</span>, <span class="fl">0.081</span>, <span class="fl">0.345</span>, <span class="sc">-</span><span class="fl">0.086</span>, <span class="sc">-</span><span class="fl">0.33</span>,</span>
<span id="cb92-6"><a href="measures.html#cb92-6" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.509</span>, <span class="fl">0.264</span>, <span class="sc">-</span><span class="fl">0.244</span>, <span class="fl">0.486</span>, <span class="fl">0.511</span>, <span class="fl">1.052</span>,</span>
<span id="cb92-7"><a href="measures.html#cb92-7" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.907</span>, <span class="fl">0.496</span>, <span class="fl">0.547</span>, <span class="fl">0.44</span>, <span class="fl">0.254</span>, <span class="fl">0.576</span>)</span>
<span id="cb92-8"><a href="measures.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-9"><a href="measures.html#cb92-9" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bb =</span> bb, <span class="at">d =</span> nces.out[<span class="fu">match</span>(bb<span class="sc">$</span>name, nces.out<span class="sc">$</span>name), <span class="st">&quot;est&quot;</span>])</span>
<span id="cb92-10"><a href="measures.html#cb92-10" aria-hidden="true" tabindex="-1"></a>comp<span class="sc">$</span>dev <span class="ot">&lt;-</span> <span class="fu">abs</span>(comp<span class="sc">$</span>bb.est <span class="sc">-</span> comp<span class="sc">$</span>d)</span>
<span id="cb92-11"><a href="measures.html#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">sum</span>(comp<span class="sc">$</span>dev) <span class="sc">&lt;</span> <span class="fl">0.01</span>)</span></code></pre></div>
<p>and the table is</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="measures.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tbl_boot.r</span>(nces.out, <span class="at">title =</span> <span class="st">&quot;Table 4.3 NCES data&quot;</span>)</span></code></pre></div>
<div id="srhkwtblts" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#srhkwtblts .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#srhkwtblts .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srhkwtblts .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#srhkwtblts .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: bold;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#srhkwtblts .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srhkwtblts .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#srhkwtblts .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#srhkwtblts .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#srhkwtblts .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#srhkwtblts .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#srhkwtblts .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#srhkwtblts .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#srhkwtblts .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#srhkwtblts .gt_from_md > :first-child {
  margin-top: 0;
}

#srhkwtblts .gt_from_md > :last-child {
  margin-bottom: 0;
}

#srhkwtblts .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#srhkwtblts .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#srhkwtblts .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srhkwtblts .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#srhkwtblts .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#srhkwtblts .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#srhkwtblts .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#srhkwtblts .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#srhkwtblts .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srhkwtblts .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#srhkwtblts .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#srhkwtblts .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#srhkwtblts .gt_left {
  text-align: left;
}

#srhkwtblts .gt_center {
  text-align: center;
}

#srhkwtblts .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#srhkwtblts .gt_font_normal {
  font-weight: normal;
}

#srhkwtblts .gt_font_bold {
  font-weight: bold;
}

#srhkwtblts .gt_font_italic {
  font-style: italic;
}

#srhkwtblts .gt_super {
  font-size: 65%;
}

#srhkwtblts .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="10" class="gt_heading gt_title gt_font_normal" style><strong>Table 4.3 NCES data</strong></th>
    </tr>
    <tr>
      <th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Effect-measure Modification</strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1"></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M0</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M1</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">diff</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left gt_stub">EYT0</td>
<td class="gt_row gt_center">0.17</td>
<td class="gt_row gt_center">0.14</td>
<td class="gt_row gt_center">0.20</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.68</td>
<td class="gt_row gt_center">0.61</td>
<td class="gt_row gt_center">0.75</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.51</td>
<td class="gt_row gt_center">0.43</td>
<td class="gt_row gt_center">0.59</td></tr>
    <tr><td class="gt_row gt_left gt_stub">EYT1</td>
<td class="gt_row gt_center gt_striped">0.08</td>
<td class="gt_row gt_center gt_striped">0.06</td>
<td class="gt_row gt_center gt_striped">0.11</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.35</td>
<td class="gt_row gt_center gt_striped">0.25</td>
<td class="gt_row gt_center gt_striped">0.44</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.26</td>
<td class="gt_row gt_center gt_striped">0.16</td>
<td class="gt_row gt_center gt_striped">0.37</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RD</td>
<td class="gt_row gt_center">&minus;0.09</td>
<td class="gt_row gt_center">&minus;0.12</td>
<td class="gt_row gt_center">&minus;0.05</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.33</td>
<td class="gt_row gt_center">&minus;0.45</td>
<td class="gt_row gt_center">&minus;0.21</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.24</td>
<td class="gt_row gt_center">&minus;0.37</td>
<td class="gt_row gt_center">&minus;0.12</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RR</td>
<td class="gt_row gt_center gt_striped">0.49</td>
<td class="gt_row gt_center gt_striped">0.34</td>
<td class="gt_row gt_center gt_striped">0.71</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.51</td>
<td class="gt_row gt_center gt_striped">0.38</td>
<td class="gt_row gt_center gt_striped">0.70</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.05</td>
<td class="gt_row gt_center gt_striped">0.65</td>
<td class="gt_row gt_center gt_striped">1.67</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RRstar</td>
<td class="gt_row gt_center">0.91</td>
<td class="gt_row gt_center">0.87</td>
<td class="gt_row gt_center">0.95</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.50</td>
<td class="gt_row gt_center">0.38</td>
<td class="gt_row gt_center">0.64</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.55</td>
<td class="gt_row gt_center">0.42</td>
<td class="gt_row gt_center">0.71</td></tr>
    <tr><td class="gt_row gt_left gt_stub">OR</td>
<td class="gt_row gt_center gt_striped">0.44</td>
<td class="gt_row gt_center gt_striped">0.30</td>
<td class="gt_row gt_center gt_striped">0.67</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.25</td>
<td class="gt_row gt_center gt_striped">0.15</td>
<td class="gt_row gt_center gt_striped">0.44</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.58</td>
<td class="gt_row gt_center gt_striped">0.29</td>
<td class="gt_row gt_center gt_striped">1.11</td></tr>
  </tbody>
  
  
</table>
</div>
<p>and we plot the results</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="measures.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_boot.r</span>(nces.out, <span class="at">title =</span> <span class="st">&quot;NCES data&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>We observe that</p>
<ul>
<li>RD: Risk difference shows that using selection to accept more women
seem to decrease the % of school with hogh math SAT</li>
<li>OR and RRstar: Show the same results as RD</li>
<li>RR: Indicates that selection, in relative terms <em>has no significant effect</em></li>
</ul>
</div>
</div>
<div id="qualitative-agreement-of-effect-measures-in-modification" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Qualitative Agreement of Effect Measures in Modification</h2>
<p>This section relies heavily on the paper from Shannin and Brumback (2021)
<span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span>. It used a Monte-Carlo simulation
in java by <a href="https://github.com/gatorjake/EffectMeasures">jake</a> running 1000000
times for six effect measures (the 4 in this chapter, the hazard ratio HR and
the recovery ration HR*).</p>
<p>For the purpose of this project we only simulate the 4 effect measures
discussed so far (RD, RR, RR* and OR). We use R package <code>MonteCarlo</code> with 5000
repetitions. The distribution used for simulation is the beta distribution
which is generally used for values in [0,1]. It is also used as a prior of
binomial regression in Bayes analysis which is the subject covered a little
later in this section. Regardless if the 6 effects measures from <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span>
or the 4 from <span class="citation"><a href="#ref-brumback2022" role="doc-biblioref">Brumback</a> (<a href="#ref-brumback2022" role="doc-biblioref">2022</a>)</span> are used, the process and conclusion are the
same.</p>
<p>We point out that using the distribution <span class="math inline">\(Beta(1, 1) \sim Uniform(0, 1)\)</span> is
equivalent to running a grid search. It is also equivalent to the uniform
distribution used in <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span>.</p>
<div id="algorithm" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Algorithm</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="measures.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a Monte Carlo simulation using the beta distribution</span></span>
<span id="cb95-2"><a href="measures.html#cb95-2" aria-hidden="true" tabindex="-1"></a>betasim_effect_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">shape1_prms =</span> <span class="dv">1</span>, <span class="at">shape2_prms =</span> <span class="dv">1</span>, <span class="at">nrep =</span> <span class="dv">5000</span>, </span>
<span id="cb95-3"><a href="measures.html#cb95-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">constrained =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb95-4"><a href="measures.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(nrep <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb95-5"><a href="measures.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the shape parameters must be &gt;= 0.5 to maintain</span></span>
<span id="cb95-6"><a href="measures.html#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the positivity assumption</span></span>
<span id="cb95-7"><a href="measures.html#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(shape1_prms <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="fu">all</span>(shape2_prms <span class="sc">&gt;=</span> <span class="fl">0.5</span>))</span>
<span id="cb95-8"><a href="measures.html#cb95-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-9"><a href="measures.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the function used by Monte Carlo for each parameter in the grid</span></span>
<span id="cb95-10"><a href="measures.html#cb95-10" aria-hidden="true" tabindex="-1"></a>  calc_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(shape1, shape2) {</span>
<span id="cb95-11"><a href="measures.html#cb95-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-12"><a href="measures.html#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the random sample from beta distribution</span></span>
<span id="cb95-13"><a href="measures.html#cb95-13" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">shape1 =</span> shape1, <span class="at">shape2 =</span> shape2)</span>
<span id="cb95-14"><a href="measures.html#cb95-14" aria-hidden="true" tabindex="-1"></a>    EY_T0_M0 <span class="ot">&lt;-</span> s[<span class="dv">1</span>]</span>
<span id="cb95-15"><a href="measures.html#cb95-15" aria-hidden="true" tabindex="-1"></a>    EY_T1_M0 <span class="ot">&lt;-</span> s[<span class="dv">2</span>]</span>
<span id="cb95-16"><a href="measures.html#cb95-16" aria-hidden="true" tabindex="-1"></a>    EY_T0_M1 <span class="ot">&lt;-</span> s[<span class="dv">3</span>]</span>
<span id="cb95-17"><a href="measures.html#cb95-17" aria-hidden="true" tabindex="-1"></a>    EY_T1_M1 <span class="ot">&lt;-</span> s[<span class="dv">4</span>]</span>
<span id="cb95-18"><a href="measures.html#cb95-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-19"><a href="measures.html#cb95-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># IMPORTANT: Make sure the positivity assumption is met.</span></span>
<span id="cb95-20"><a href="measures.html#cb95-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(EY_T0_M0 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T0_M0 <span class="sc">&lt;</span> <span class="dv">1</span>, EY_T1_M0 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T1_M0 <span class="sc">&lt;</span> <span class="dv">1</span>,</span>
<span id="cb95-21"><a href="measures.html#cb95-21" aria-hidden="true" tabindex="-1"></a>              EY_T0_M1 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T0_M1 <span class="sc">&lt;</span> <span class="dv">1</span>, EY_T1_M1 <span class="sc">&gt;</span> <span class="dv">0</span>, EY_T1_M1 <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb95-22"><a href="measures.html#cb95-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-23"><a href="measures.html#cb95-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute the effect measures</span></span>
<span id="cb95-24"><a href="measures.html#cb95-24" aria-hidden="true" tabindex="-1"></a>    RD0 <span class="ot">&lt;-</span> EY_T1_M0 <span class="sc">-</span> EY_T0_M0</span>
<span id="cb95-25"><a href="measures.html#cb95-25" aria-hidden="true" tabindex="-1"></a>    RD1 <span class="ot">&lt;-</span> EY_T1_M1 <span class="sc">-</span> EY_T0_M1</span>
<span id="cb95-26"><a href="measures.html#cb95-26" aria-hidden="true" tabindex="-1"></a>    RR0 <span class="ot">&lt;-</span> EY_T1_M0 <span class="sc">/</span> EY_T0_M0</span>
<span id="cb95-27"><a href="measures.html#cb95-27" aria-hidden="true" tabindex="-1"></a>    RR1 <span class="ot">&lt;-</span> EY_T1_M1 <span class="sc">/</span> EY_T0_M1</span>
<span id="cb95-28"><a href="measures.html#cb95-28" aria-hidden="true" tabindex="-1"></a>    RR0star <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T0_M0) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T1_M0)</span>
<span id="cb95-29"><a href="measures.html#cb95-29" aria-hidden="true" tabindex="-1"></a>    RR1star <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T0_M1) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> EY_T1_M1)</span>
<span id="cb95-30"><a href="measures.html#cb95-30" aria-hidden="true" tabindex="-1"></a>    OR0 <span class="ot">&lt;-</span> RR0 <span class="sc">*</span> RR0star</span>
<span id="cb95-31"><a href="measures.html#cb95-31" aria-hidden="true" tabindex="-1"></a>    OR1 <span class="ot">&lt;-</span> RR1 <span class="sc">*</span> RR1star</span>
<span id="cb95-32"><a href="measures.html#cb95-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-33"><a href="measures.html#cb95-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># How did the measures change with the modifier?</span></span>
<span id="cb95-34"><a href="measures.html#cb95-34" aria-hidden="true" tabindex="-1"></a>    RD <span class="ot">&lt;-</span> <span class="fu">sign</span>(RD1 <span class="sc">-</span> RD0)</span>
<span id="cb95-35"><a href="measures.html#cb95-35" aria-hidden="true" tabindex="-1"></a>    RR <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR1 <span class="sc">-</span> RR0)</span>
<span id="cb95-36"><a href="measures.html#cb95-36" aria-hidden="true" tabindex="-1"></a>    RRstar <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR1star <span class="sc">-</span> RR0star)</span>
<span id="cb95-37"><a href="measures.html#cb95-37" aria-hidden="true" tabindex="-1"></a>    OR <span class="ot">&lt;-</span> <span class="fu">sign</span>(OR1 <span class="sc">-</span> OR0)</span>
<span id="cb95-38"><a href="measures.html#cb95-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-39"><a href="measures.html#cb95-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We want to know if the various subsets of the four causal measures would</span></span>
<span id="cb95-40"><a href="measures.html#cb95-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># agree (i.e. change together from one stratum to the other)</span></span>
<span id="cb95-41"><a href="measures.html#cb95-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-42"><a href="measures.html#cb95-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1 pair only</span></span>
<span id="cb95-43"><a href="measures.html#cb95-43" aria-hidden="true" tabindex="-1"></a>    RD_RR <span class="ot">&lt;-</span> </span>
<span id="cb95-44"><a href="measures.html#cb95-44" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-45"><a href="measures.html#cb95-45" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-46"><a href="measures.html#cb95-46" aria-hidden="true" tabindex="-1"></a>    RD_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb95-47"><a href="measures.html#cb95-47" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-48"><a href="measures.html#cb95-48" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-49"><a href="measures.html#cb95-49" aria-hidden="true" tabindex="-1"></a>    RD_OR <span class="ot">&lt;-</span></span>
<span id="cb95-50"><a href="measures.html#cb95-50" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-51"><a href="measures.html#cb95-51" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-52"><a href="measures.html#cb95-52" aria-hidden="true" tabindex="-1"></a>    RR_RRstar <span class="ot">&lt;-</span></span>
<span id="cb95-53"><a href="measures.html#cb95-53" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-54"><a href="measures.html#cb95-54" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-55"><a href="measures.html#cb95-55" aria-hidden="true" tabindex="-1"></a>    RR_OR <span class="ot">&lt;-</span></span>
<span id="cb95-56"><a href="measures.html#cb95-56" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-57"><a href="measures.html#cb95-57" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-58"><a href="measures.html#cb95-58" aria-hidden="true" tabindex="-1"></a>    RRstar_OR <span class="ot">&lt;-</span></span>
<span id="cb95-59"><a href="measures.html#cb95-59" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-60"><a href="measures.html#cb95-60" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb95-61"><a href="measures.html#cb95-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 pairs not being 3-wise</span></span>
<span id="cb95-62"><a href="measures.html#cb95-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># called &quot;Opposite pairwise events&quot;</span></span>
<span id="cb95-63"><a href="measures.html#cb95-63" aria-hidden="true" tabindex="-1"></a>    RD_RR_vs_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-64"><a href="measures.html#cb95-64" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-65"><a href="measures.html#cb95-65" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb95-66"><a href="measures.html#cb95-66" aria-hidden="true" tabindex="-1"></a>    RD_RRstar_vs_RR_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-67"><a href="measures.html#cb95-67" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-68"><a href="measures.html#cb95-68" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-69"><a href="measures.html#cb95-69" aria-hidden="true" tabindex="-1"></a>    RD_OR_vs_RR_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb95-70"><a href="measures.html#cb95-70" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-71"><a href="measures.html#cb95-71" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-72"><a href="measures.html#cb95-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3-wise</span></span>
<span id="cb95-73"><a href="measures.html#cb95-73" aria-hidden="true" tabindex="-1"></a>    RD_RR_RRstar <span class="ot">&lt;-</span> </span>
<span id="cb95-74"><a href="measures.html#cb95-74" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-75"><a href="measures.html#cb95-75" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-76"><a href="measures.html#cb95-76" aria-hidden="true" tabindex="-1"></a>    RD_RR_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-77"><a href="measures.html#cb95-77" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-78"><a href="measures.html#cb95-78" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-79"><a href="measures.html#cb95-79" aria-hidden="true" tabindex="-1"></a>    RD_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-80"><a href="measures.html#cb95-80" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-81"><a href="measures.html#cb95-81" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb95-82"><a href="measures.html#cb95-82" aria-hidden="true" tabindex="-1"></a>    RR_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-83"><a href="measures.html#cb95-83" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-84"><a href="measures.html#cb95-84" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb95-85"><a href="measures.html#cb95-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4-wise</span></span>
<span id="cb95-86"><a href="measures.html#cb95-86" aria-hidden="true" tabindex="-1"></a>    RD_RR_RRstar_OR <span class="ot">&lt;-</span> </span>
<span id="cb95-87"><a href="measures.html#cb95-87" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">==</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">==</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-88"><a href="measures.html#cb95-88" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">==</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">==</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">==</span> OR)</span>
<span id="cb95-89"><a href="measures.html#cb95-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All measures move in different directions</span></span>
<span id="cb95-90"><a href="measures.html#cb95-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is an impossible event and represent the empty set</span></span>
<span id="cb95-91"><a href="measures.html#cb95-91" aria-hidden="true" tabindex="-1"></a>    NONE <span class="ot">&lt;-</span> </span>
<span id="cb95-92"><a href="measures.html#cb95-92" aria-hidden="true" tabindex="-1"></a>      (RD <span class="sc">!=</span> RR) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RD <span class="sc">!=</span> OR) <span class="sc">&amp;</span> </span>
<span id="cb95-93"><a href="measures.html#cb95-93" aria-hidden="true" tabindex="-1"></a>      (RR <span class="sc">!=</span> RRstar) <span class="sc">&amp;</span> (RR <span class="sc">!=</span> OR) <span class="sc">&amp;</span> (RRstar <span class="sc">!=</span> OR)</span>
<span id="cb95-94"><a href="measures.html#cb95-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-95"><a href="measures.html#cb95-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the output list</span></span>
<span id="cb95-96"><a href="measures.html#cb95-96" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;RD_RR&quot;</span> <span class="ot">=</span> RD_RR, <span class="st">&quot;RD_RRstar&quot;</span> <span class="ot">=</span> RD_RRstar, <span class="st">&quot;RD_OR&quot;</span> <span class="ot">=</span> RD_OR, </span>
<span id="cb95-97"><a href="measures.html#cb95-97" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RR_RRstar&quot;</span> <span class="ot">=</span> RR_RRstar, <span class="st">&quot;RR_OR&quot;</span> <span class="ot">=</span> RR_OR, <span class="st">&quot;RRstar_OR&quot;</span> <span class="ot">=</span> RRstar_OR,</span>
<span id="cb95-98"><a href="measures.html#cb95-98" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RR_vs_RRstar_OR, </span>
<span id="cb95-99"><a href="measures.html#cb95-99" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span> <span class="ot">=</span> RD_RRstar_vs_RR_OR,</span>
<span id="cb95-100"><a href="measures.html#cb95-100" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span> <span class="ot">=</span> RD_OR_vs_RR_RRstar,</span>
<span id="cb95-101"><a href="measures.html#cb95-101" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_RRstar&quot;</span> <span class="ot">=</span> RD_RR_RRstar, <span class="st">&quot;RD_RR_OR&quot;</span> <span class="ot">=</span> RD_RR_OR, </span>
<span id="cb95-102"><a href="measures.html#cb95-102" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RRstar_OR, <span class="st">&quot;RR_RRstar_OR&quot;</span> <span class="ot">=</span> RR_RRstar_OR,</span>
<span id="cb95-103"><a href="measures.html#cb95-103" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;RD_RR_RRstar_OR&quot;</span> <span class="ot">=</span> RD_RR_RRstar_OR, <span class="st">&quot;NONE&quot;</span> <span class="ot">=</span> NONE)</span>
<span id="cb95-104"><a href="measures.html#cb95-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-105"><a href="measures.html#cb95-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-106"><a href="measures.html#cb95-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if constrained and condition is met, set to NA</span></span>
<span id="cb95-107"><a href="measures.html#cb95-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># is constrained the set to NA</span></span>
<span id="cb95-108"><a href="measures.html#cb95-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if RR0 and RR1 are on different side of 1</span></span>
<span id="cb95-109"><a href="measures.html#cb95-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then the constraint is met</span></span>
<span id="cb95-110"><a href="measures.html#cb95-110" aria-hidden="true" tabindex="-1"></a>    cond <span class="ot">&lt;-</span> <span class="fu">sign</span>(RR0 <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">!=</span> <span class="fu">sign</span>(RR1 <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb95-111"><a href="measures.html#cb95-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (constrained <span class="sc">&amp;</span> cond) out[<span class="fu">seq_along</span>(out)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb95-112"><a href="measures.html#cb95-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb95-113"><a href="measures.html#cb95-113" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb95-114"><a href="measures.html#cb95-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb95-115"><a href="measures.html#cb95-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-116"><a href="measures.html#cb95-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run parametric Monte Carlo simulation</span></span>
<span id="cb95-117"><a href="measures.html#cb95-117" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;shape1&quot;</span> <span class="ot">=</span> shape1_prms, <span class="st">&quot;shape2&quot;</span> <span class="ot">=</span> shape2_prms)</span>
<span id="cb95-118"><a href="measures.html#cb95-118" aria-hidden="true" tabindex="-1"></a>  mc.out <span class="ot">&lt;-</span> <span class="fu">MonteCarlo</span>(<span class="at">func =</span> calc_measures, <span class="at">nrep =</span> nrep, <span class="at">param_list =</span> params)</span>
<span id="cb95-119"><a href="measures.html#cb95-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-120"><a href="measures.html#cb95-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output the results. One matrix per event where every matrix element</span></span>
<span id="cb95-121"><a href="measures.html#cb95-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is a percentage frequency for given shape1 and shape2 parameters</span></span>
<span id="cb95-122"><a href="measures.html#cb95-122" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mc.out<span class="sc">$</span>results, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb95-123"><a href="measures.html#cb95-123" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb95-124"><a href="measures.html#cb95-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">X =</span> <span class="fu">seq_len</span>(<span class="fu">dim</span>(x)[<span class="dv">1</span>]), <span class="at">FUN =</span> <span class="cf">function</span>(s1) {</span>
<span id="cb95-125"><a href="measures.html#cb95-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sapply</span>(<span class="at">X =</span> <span class="fu">seq_len</span>(<span class="fu">dim</span>(x)[<span class="dv">2</span>]), <span class="cf">function</span>(s2) {</span>
<span id="cb95-126"><a href="measures.html#cb95-126" aria-hidden="true" tabindex="-1"></a>          <span class="co"># since the constrained items are set to NA, we must</span></span>
<span id="cb95-127"><a href="measures.html#cb95-127" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove NA from the calculations, only has an effect </span></span>
<span id="cb95-128"><a href="measures.html#cb95-128" aria-hidden="true" tabindex="-1"></a>          <span class="co"># when constrained = TRUE</span></span>
<span id="cb95-129"><a href="measures.html#cb95-129" aria-hidden="true" tabindex="-1"></a>          nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x[s1, s2, ]))</span>
<span id="cb95-130"><a href="measures.html#cb95-130" aria-hidden="true" tabindex="-1"></a>          <span class="fu">sum</span>(x[s1, s2, ], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> nb</span>
<span id="cb95-131"><a href="measures.html#cb95-131" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb95-132"><a href="measures.html#cb95-132" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb95-133"><a href="measures.html#cb95-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert array to matrix and name row and columns</span></span>
<span id="cb95-134"><a href="measures.html#cb95-134" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(m)</span>
<span id="cb95-135"><a href="measures.html#cb95-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;s2&quot;</span>, shape2_prms, <span class="at">sep =</span> <span class="st">&quot;=&quot;</span>)</span>
<span id="cb95-136"><a href="measures.html#cb95-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;s1&quot;</span>, shape1_prms, <span class="at">sep =</span> <span class="st">&quot;=&quot;</span>)</span>
<span id="cb95-137"><a href="measures.html#cb95-137" aria-hidden="true" tabindex="-1"></a>    m</span>
<span id="cb95-138"><a href="measures.html#cb95-138" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb95-139"><a href="measures.html#cb95-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-140"><a href="measures.html#cb95-140" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb95-141"><a href="measures.html#cb95-141" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="simulate-the-effect-measures" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Simulate the effect measures</h3>
<p>We run the Monte-Carlo simulation without constraint and with <span class="math inline">\(Beta(1,1)\)</span> which
is equivalent to <span class="math inline">\(Uniform(0,1)\)</span> used by <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="measures.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;this takes 1 sec.: we load a saved file instead&quot;</span>)</span></code></pre></div>
<pre><code>## this takes 1 sec.: we load a saved file instead</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="measures.html#cb98-1" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb98-2"><a href="measures.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gridsim &lt;- betasim_effect_measures(shape1 = 1, shape2 = 1, nrep = 5000)</span></span>
<span id="cb98-3"><a href="measures.html#cb98-3" aria-hidden="true" tabindex="-1"></a>a_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_data, <span class="st">&quot;chap04_gridsim.rds&quot;</span>)</span>
<span id="cb98-4"><a href="measures.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(gridsim, file = a_file)</span></span>
<span id="cb98-5"><a href="measures.html#cb98-5" aria-hidden="true" tabindex="-1"></a>gridsim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> a_file)</span>
<span id="cb98-6"><a href="measures.html#cb98-6" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb98-7"><a href="measures.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(endTime - startTime)</span></span></code></pre></div>
<p>which gives the vector of percentages</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="measures.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(gridsim)</span></code></pre></div>
<pre><code>##              RD_RR          RD_RRstar              RD_OR          RR_RRstar 
##             0.0000             0.0000             0.0000             0.0000 
##              RR_OR          RRstar_OR RD_RR_vs_RRstar_OR RD_RRstar_vs_RR_OR 
##             0.0000             0.0000             0.0282             0.0272 
## RD_OR_vs_RR_RRstar       RD_RR_RRstar           RD_RR_OR       RD_RRstar_OR 
##             0.0000             0.0000             0.0572             0.0538 
##       RR_RRstar_OR    RD_RR_RRstar_OR               NONE 
##             0.0000             0.8336             0.0000</code></pre>
<p>For the following discussion, we must note the following about the vector of
percentages returned by the simulation.</p>
<ol style="list-style-type: decimal">
<li><strong>Pairwise events</strong>: Some measures move as <em>1 pair</em> in the same direction while
all the other pairs move in different direction between each other.
These are 6 possibilities named <code>RD_RR</code>,<code>RD_RRstar</code>, <code>RD_OR</code>, <code>RR_RRstar</code>, <code>RR_OR</code>, <code>RRstar_OR</code>.</li>
<li><strong>Opposite pairwise events</strong>: Some measures move as <em>2 pairs</em> but
<em>each of the 2 pairs does not move in the same direction</em>.
There are 3 possibilities, called <code>RD_RR_vs_RRstar_OR</code>,
<code>RD_RRstar_vs_RR_OR</code> and <code>RD_OR_vs_RR_RRstar</code>. <strong>These are the problematic ones
as they cannot be represented in the Venn diagram of section 4.2</strong>. However
we can distribute them to ensure probabilities add up to 1. For example
<code>RD_RR_vs_RRstar_OR</code> will be split 50% between pairwise events <code>RD_RR</code> and
50% to pairwise event<code>RRstar_OR</code>. This enforces the very important rule
that probabilities must add up to 1 without consequences on the conclusions
reached.</li>
<li><strong>3-wise events</strong>: Some 3 measures move in the same direction together There are 4 possibilities
called <code>RD_RR_RRstar</code>, <code>RD_RR_OR</code>, <code>RD_RRstar_OR</code> and <code>RR_RRstar_OR</code>.</li>
<li><strong>All events</strong>: Sometimes all measures move together.
<strong>This is the possibility of interest</strong> discussed by Shannin and Brumback (2021).
This possibility is called <code>ALL</code>.</li>
<li><strong>No event</strong>: The possibility <code>NONE</code> concerns the event that no pair of
measures move in the same direction. It is impossible and represents the empty set
<span class="math inline">\(\emptyset\)</span> which is one of the 3 conditions of a <span class="math inline">\(\sigma-field\)</span>.</li>
<li><strong>Validation</strong>: The sum of the vector’s elements must be one.</li>
</ol>
<p>The event definitions above ensure that the sample space is actually a <span class="math inline">\(\sigma-field\)</span>.
See <span class="citation"><a href="#ref-grimmett" role="doc-biblioref">Geoffrey R. Grimmet</a> (<a href="#ref-grimmett" role="doc-biblioref">2001</a>)</span>, section 1.2.</p>
<p>then we compare with the author’s results</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="measures.html#cb101-1" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;RD_RR&quot;</span> <span class="ot">=</span> <span class="fl">0.026</span>, <span class="st">&quot;RD_RRstar&quot;</span> <span class="ot">=</span> <span class="fl">0.026</span>, <span class="st">&quot;RD_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="cb101-2"><a href="measures.html#cb101-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;RR_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.026</span>, <span class="st">&quot;RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.026</span>,</span>
<span id="cb101-3"><a href="measures.html#cb101-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb101-4"><a href="measures.html#cb101-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb101-5"><a href="measures.html#cb101-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb101-6"><a href="measures.html#cb101-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;RD_RR_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.057</span>, </span>
<span id="cb101-7"><a href="measures.html#cb101-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.057</span>, <span class="st">&quot;RR_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb101-8"><a href="measures.html#cb101-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.833</span>, <span class="st">&quot;NONE&quot;</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb101-9"><a href="measures.html#cb101-9" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bb =</span> <span class="fu">round</span>(bb, <span class="dv">4</span>), <span class="at">sim =</span> <span class="fu">round</span>(<span class="fu">unlist</span>(gridsim), <span class="dv">4</span>))</span>
<span id="cb101-10"><a href="measures.html#cb101-10" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##                       bb    sim
## RD_RR              0.026 0.0000
## RD_RRstar          0.026 0.0000
## RD_OR              0.000 0.0000
## RR_RRstar          0.000 0.0000
## RR_OR              0.026 0.0000
## RRstar_OR          0.026 0.0000
## RD_RR_vs_RRstar_OR 0.000 0.0282
## RD_RRstar_vs_RR_OR 0.000 0.0272
## RD_OR_vs_RR_RRstar 0.000 0.0000
## RD_RR_RRstar       0.000 0.0000
## RD_RR_OR           0.057 0.0572
## RD_RRstar_OR       0.057 0.0538
## RR_RRstar_OR       0.000 0.0000
## RD_RR_RRstar_OR    0.833 0.8336
## NONE               0.000 0.0000</code></pre>
<p>The results from the Monte Carlo simulation above confirm the main conclusion
from <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span> that all effect measures move together 84% of the time.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="measures.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;simulation&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(gridsim[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>])), </span>
<span id="cb103-2"><a href="measures.html#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;author&#39;s&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(bb[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]))</span></code></pre></div>
<pre><code>## simulation   author&#39;s 
##     0.8336     0.8330</code></pre>
<p>We note that the sim adds up correctly to 1 but not the author’s which adds up
to 1.051. This is explained on p. 72 as a bit of arbitrary allocations. The
<span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span> paper (caption figure 1) mentions that they do not
add to 1 because they include events that <em>are not mutually exclusive</em>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="measures.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;simulation&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">unlist</span>(gridsim)), <span class="st">&quot;author&#39;s&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(bb))</span></code></pre></div>
<pre><code>## simulation   author&#39;s 
##      1.000      1.051</code></pre>
<p>Actually, this is caused by the <strong>Opposite pairwise events</strong> which cannot be
represented in the 4-set Venn diagram. For the purpose of this
books we will simply split them between the events that makes them up without
consequence on the conclusion.</p>
<p>The <strong>Opposite pairwise events</strong> are the following</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="measures.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The events that pair of measures move together but in opposite</span></span>
<span id="cb107-2"><a href="measures.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co"># direction of another pair who also move together</span></span>
<span id="cb107-3"><a href="measures.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(gridsim[<span class="fu">c</span>(<span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span>, <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span>, <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span>)])</span></code></pre></div>
<pre><code>## RD_RR_vs_RRstar_OR RD_RRstar_vs_RR_OR RD_OR_vs_RR_RRstar 
##             0.0282             0.0272             0.0000</code></pre>
<p>and when we split them between their 2 sub-events we can generate the
Venn diagram as follows</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="measures.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a custom function using the venn package</span></span>
<span id="cb109-2"><a href="measures.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">venn_sim</span>(gridsim, <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb109-3"><a href="measures.html#cb109-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill_colr =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>),</span>
<span id="cb109-4"><a href="measures.html#cb109-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Venn diagram of effect measure modifications&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>now for <strong>constrained data</strong></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="measures.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;this takes 1 sec.: we load a saved file instead&quot;</span>)</span></code></pre></div>
<pre><code>## this takes 1 sec.: we load a saved file instead</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="measures.html#cb112-1" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb112-2"><a href="measures.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gridsim_const &lt;- betasim_effect_measures(shape1 = 1, shape2 = 1, nrep = 5000,</span></span>
<span id="cb112-3"><a href="measures.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                       constrained = TRUE)</span></span>
<span id="cb112-4"><a href="measures.html#cb112-4" aria-hidden="true" tabindex="-1"></a>a_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_data, <span class="st">&quot;chap04_gridsim_const.rds&quot;</span>)</span>
<span id="cb112-5"><a href="measures.html#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(gridsim_const, file = a_file)</span></span>
<span id="cb112-6"><a href="measures.html#cb112-6" aria-hidden="true" tabindex="-1"></a>gridsim_const <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> a_file)</span>
<span id="cb112-7"><a href="measures.html#cb112-7" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb112-8"><a href="measures.html#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(endTime - startTime)</span></span></code></pre></div>
<p>which gives the vector of percentages</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="measures.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(gridsim_const)</span></code></pre></div>
<pre><code>##              RD_RR          RD_RRstar              RD_OR          RR_RRstar 
##          0.0000000          0.0000000          0.0000000          0.0000000 
##              RR_OR          RRstar_OR RD_RR_vs_RRstar_OR RD_RRstar_vs_RR_OR 
##          0.0000000          0.0000000          0.0486166          0.0541502 
## RD_OR_vs_RR_RRstar       RD_RR_RRstar           RD_RR_OR       RD_RRstar_OR 
##          0.0000000          0.0000000          0.1177866          0.1158103 
##       RR_RRstar_OR    RD_RR_RRstar_OR               NONE 
##          0.0000000          0.6636364          0.0000000</code></pre>
<p>and comparing to the author’s results</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="measures.html#cb115-1" aria-hidden="true" tabindex="-1"></a>bb_const <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;RD_RR&quot;</span> <span class="ot">=</span> <span class="fl">0.053</span>, <span class="st">&quot;RD_RRstar&quot;</span> <span class="ot">=</span> <span class="fl">0.053</span>, <span class="st">&quot;RD_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.053</span>, </span>
<span id="cb115-2"><a href="measures.html#cb115-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;RR_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.053</span>, <span class="st">&quot;RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.0</span>,</span>
<span id="cb115-3"><a href="measures.html#cb115-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb115-4"><a href="measures.html#cb115-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb115-5"><a href="measures.html#cb115-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb115-6"><a href="measures.html#cb115-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_RRstar&quot;</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">&quot;RD_RR_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.114</span>, </span>
<span id="cb115-7"><a href="measures.html#cb115-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.114</span>, <span class="st">&quot;RR_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb115-8"><a href="measures.html#cb115-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RD_RR_RRstar_OR&quot;</span> <span class="ot">=</span> <span class="fl">0.667</span>, <span class="st">&quot;NONE&quot;</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb115-9"><a href="measures.html#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bb_const)</span></code></pre></div>
<pre><code>## [1] 1.107</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="measures.html#cb117-1" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">bb =</span> <span class="fu">round</span>(bb_const, <span class="dv">4</span>), </span>
<span id="cb117-2"><a href="measures.html#cb117-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sim =</span> <span class="fu">round</span>(<span class="fu">unlist</span>(gridsim_const), <span class="dv">4</span>))</span>
<span id="cb117-3"><a href="measures.html#cb117-3" aria-hidden="true" tabindex="-1"></a>comp</span></code></pre></div>
<pre><code>##                       bb    sim
## RD_RR              0.053 0.0000
## RD_RRstar          0.053 0.0000
## RD_OR              0.053 0.0000
## RR_RRstar          0.000 0.0000
## RR_OR              0.053 0.0000
## RRstar_OR          0.000 0.0000
## RD_RR_vs_RRstar_OR 0.000 0.0486
## RD_RRstar_vs_RR_OR 0.000 0.0542
## RD_OR_vs_RR_RRstar 0.000 0.0000
## RD_RR_RRstar       0.000 0.0000
## RD_RR_OR           0.114 0.1178
## RD_RRstar_OR       0.114 0.1158
## RR_RRstar_OR       0.000 0.0000
## RD_RR_RRstar_OR    0.667 0.6636
## NONE               0.000 0.0000</code></pre>
<p>The results from the Monte Carlo simulation with the constrained data
agree the author’s result.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="measures.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;simulation&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(gridsim_const[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>])),</span>
<span id="cb119-2"><a href="measures.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;author&#39;s&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(bb_const[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]))</span></code></pre></div>
<pre><code>## simulation   author&#39;s 
##  0.6636364  0.6670000</code></pre>
<p>Again the <strong>Opposite pairwise events</strong> cannot be represented
in the 4-set Venn diagram.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="measures.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The events that pair of measures move together but in opposite</span></span>
<span id="cb121-2"><a href="measures.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># direction of another pair who also move together</span></span>
<span id="cb121-3"><a href="measures.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(gridsim_const[<span class="fu">c</span>(<span class="st">&quot;RD_RR_vs_RRstar_OR&quot;</span>, <span class="st">&quot;RD_RRstar_vs_RR_OR&quot;</span>, <span class="st">&quot;RD_OR_vs_RR_RRstar&quot;</span>)])</span></code></pre></div>
<pre><code>## RD_RR_vs_RRstar_OR RD_RRstar_vs_RR_OR RD_OR_vs_RR_RRstar 
##          0.0486166          0.0541502          0.0000000</code></pre>
<p>but if we do it as mentioned above then we can show a Venn diagram as follows</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="measures.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a custom function using the venn package</span></span>
<span id="cb123-2"><a href="measures.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">venn_sim</span>(gridsim_const,</span>
<span id="cb123-3"><a href="measures.html#cb123-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill_colr =</span> <span class="fu">c</span>(<span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;gold&quot;</span>, <span class="st">&quot;springgreen&quot;</span>, <span class="st">&quot;hotpink&quot;</span>),</span>
<span id="cb123-4"><a href="measures.html#cb123-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Venn diagram for constrained data&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
</div>
<div id="applications-1" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Applications</h3>
<div id="simulation-of-distribution-of-effect-measures" class="section level4" number="4.2.3.1">
<h4><span class="header-section-number">4.2.3.1</span> Simulation of distribution of effect measures</h4>
<p>We use a parametric Monte Carlo simulation using the beta distribution
to evaluate the effect of the distribution assumption on the effect-measure
modifications.</p>
<p>We run the Monte-Carlo simulation with 5000 repetitions, a grid of
<code>shape1</code> and <code>shape2</code> parameters for the Beta distribution and no
constraint. Namely <code>betasim_effect_measures(shape1 = c(0.5, 1, 3, 5, 7), shape2 = c(0.5, 1, 3, 5, 7), nrep = 5000)</code></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="measures.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;this takes 25 sec.: we load a saved file instead&quot;</span>)</span></code></pre></div>
<pre><code>## this takes 25 sec.: we load a saved file instead</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="measures.html#cb126-1" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb126-2"><a href="measures.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># priorsim &lt;- betasim_effect_measures(shape1 = c(0.5, 1, 3, 5, 7),</span></span>
<span id="cb126-3"><a href="measures.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   shape2 = c(0.5, 1, 3, 5, 7),</span></span>
<span id="cb126-4"><a href="measures.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   nrep = 5000)</span></span>
<span id="cb126-5"><a href="measures.html#cb126-5" aria-hidden="true" tabindex="-1"></a>a_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_data, <span class="st">&quot;chap04_priorsim.rds&quot;</span>)</span>
<span id="cb126-6"><a href="measures.html#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(priorsim, file = a_file)</span></span>
<span id="cb126-7"><a href="measures.html#cb126-7" aria-hidden="true" tabindex="-1"></a>priorsim <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> a_file)</span>
<span id="cb126-8"><a href="measures.html#cb126-8" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb126-9"><a href="measures.html#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(endTime - startTime)</span></span></code></pre></div>
<p>and we look at the matrix for the event <code>RD_RR_RRstar_OR</code> which represents the
event that all effect measures move in the same direction.</p>
<p>The matrix elements correspond to the percentage frequency of the event given
the beta distribution with shape parameters <code>shape1 = s1</code> with <code>s1</code> indicated
as column names, and <code>shape2 = s1</code> parameter with <code>s2</code> indicated in the row names.</p>
<p>The beta distribution with <code>shape1 = 1</code> and <code>shape2 = 1</code> is similar to the uniform
distribution on <span class="math inline">\([0, 1]\)</span>. Therefore this element is the one simulated by Shannon
and Brumback, see <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span> and, in fact, with 5000 repetitions
<code>nrep = 5000</code>the measure is almost always very close to what is mentioned
in <span class="citation"><a href="#ref-shanninbrumback2021" role="doc-biblioref">Jake Shannin</a> (<a href="#ref-shanninbrumback2021" role="doc-biblioref">2021</a>)</span>.</p>
<p>Also note that for large <span class="math inline">\(shape1 = shape2 = \text{large number}\)</span> the beta distribution
is similar to the normal distribution with a mean of <span class="math inline">\(shape1 / (shape1 + shape2)\)</span>.
The simulation shows that in that case the percentage of measures moving in the
same directions is nearing 100%. See for example when <span class="math inline">\(shape1 = shape2 = 7\)</span> in
the matrix of results from the sim.</p>
<p>here is the matrix of percentage of times that all measures move in the same
direction, i.e. the event <code>RD_RR_RRstar_OR</code></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="measures.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(priorsim[[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]], <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##        s1=0.5 s1=1 s1=3 s1=5 s1=7
## s2=0.5   0.77 0.81 0.83 0.82 0.83
## s2=1     0.81 0.83 0.86 0.87 0.86
## s2=3     0.82 0.86 0.90 0.91 0.91
## s2=5     0.82 0.86 0.90 0.92 0.93
## s2=7     0.84 0.86 0.91 0.93 0.93</code></pre>
<p>and to show as a heatmap</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="measures.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_betasim</span>(priorsim, <span class="at">var =</span> <span class="st">&quot;RD_RR_RRstar_OR&quot;</span>, </span>
<span id="cb129-2"><a href="measures.html#cb129-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">colr =</span> <span class="fu">list</span>(<span class="st">&quot;low&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue1&quot;</span>, <span class="st">&quot;high&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue4&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>and comparing with the author</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="measures.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="st">&quot;simulation&quot;</span> <span class="ot">=</span> priorsim[[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]][<span class="st">&quot;s2=1&quot;</span>, <span class="st">&quot;s1=1&quot;</span>], </span>
<span id="cb130-2"><a href="measures.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;author&#39;s&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(bb[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>])), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## simulation   author&#39;s 
##      0.833      0.833</code></pre>
<p>We can see that the range is wide and should be considered.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="measures.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(priorsim[[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 0.7732 0.9344</code></pre>
<p>Now we do it with constrained data</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="measures.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;this takes 30 sec.: we load a saved file instead&quot;</span>)</span></code></pre></div>
<pre><code>## this takes 30 sec.: we load a saved file instead</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="measures.html#cb136-1" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb136-2"><a href="measures.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># priorsim_const &lt;- betasim_effect_measures(shape1 = c(0.5, 1, 3, 5, 7),</span></span>
<span id="cb136-3"><a href="measures.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         shape2 = c(0.5, 1, 3, 5, 7),</span></span>
<span id="cb136-4"><a href="measures.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         nrep = 5000, constrained = TRUE)</span></span>
<span id="cb136-5"><a href="measures.html#cb136-5" aria-hidden="true" tabindex="-1"></a>a_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_data, <span class="st">&quot;chap04_priorsim_const.rds&quot;</span>)</span>
<span id="cb136-6"><a href="measures.html#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(priorsim_const, file = a_file)</span></span>
<span id="cb136-7"><a href="measures.html#cb136-7" aria-hidden="true" tabindex="-1"></a>priorsim_const <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> a_file)</span>
<span id="cb136-8"><a href="measures.html#cb136-8" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb136-9"><a href="measures.html#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(endTime - startTime)</span></span></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="measures.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_betasim</span>(priorsim_const, <span class="at">var =</span> <span class="st">&quot;RD_RR_RRstar_OR&quot;</span>,</span>
<span id="cb137-2"><a href="measures.html#cb137-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">colr =</span> <span class="fu">list</span>(<span class="st">&quot;low&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightsalmon1&quot;</span>, <span class="st">&quot;high&quot;</span> <span class="ot">=</span> <span class="st">&quot;lightsalmon4&quot;</span>),</span>
<span id="cb137-3"><a href="measures.html#cb137-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">title =</span> <span class="st">&quot;Monte Carlo simulation. Constrained data.&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>and comparing with the author</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="measures.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="st">&quot;simulation&quot;</span> <span class="ot">=</span> priorsim_const[[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]][<span class="st">&quot;s2=1&quot;</span>, <span class="st">&quot;s1=1&quot;</span>], </span>
<span id="cb138-2"><a href="measures.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;author&#39;s&quot;</span> <span class="ot">=</span> <span class="fu">unname</span>(bb_const[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>])), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## simulation   author&#39;s 
##      0.662      0.667</code></pre>
<p>and the range is even larger and therefore more significant.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="measures.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(priorsim_const[[<span class="st">&quot;RD_RR_RRstar_OR&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 0.5710824 0.8565217</code></pre>
</div>
<div id="application-data-pre-processing-data-cleaning" class="section level4" number="4.2.3.2">
<h4><span class="header-section-number">4.2.3.2</span> Application: Data pre-processing (data cleaning)</h4>
<p>Unless the <span class="math inline">\(p_0, p_1\)</span> obtained are uniformly distributed
(not the most common scenario for sure) it seems from the
results above that the likelihood of <em>not</em> having all effect measures moving
in the same direction is low. Thus, it could be a good hint to uncover hidden
processes in a data pre-processing routine.</p>
<p>We note the important rule mentioned at the beginning of section 4.2</p>
<blockquote>
<p>when relative risk <span class="math inline">\(RR\)</span> and other relative risk <span class="math inline">\(RR^*\)</span> both change in the
same direction […] then so must the difference the risk difference and
odds ratio.</p>
</blockquote>
<p>Another rule from section 4.2 can help in data cleaning</p>
<blockquote>
<p>When <span class="math inline">\(RR_0\)</span> and <span class="math inline">\(RR_1\)</span> are on opposite side of 1, that is, when in one stratum
the treatment is helpful and in the other it is harmful, then all measures
will automatically change together.</p>
</blockquote>
<p>Thus a quick, easy way to clean up potential data problems and obtain relevant
details on outliers and <strong>hidden processes</strong> might be</p>
<ol style="list-style-type: decimal">
<li>Exclude cases when <span class="math inline">\(RR\)</span> and <span class="math inline">\(RR^*\)</span> change in the same direction to reduce
the data load.</li>
<li>Exclude cases when <span class="math inline">\(RR_0\)</span> and <span class="math inline">\(RR_1\)</span> are on opposite side of 1</li>
<li>Investigate the remining cases asthey are good candidates for <em>hidden processes</em></li>
</ol>
</div>
<div id="application-bayesian-prior-in-beta-binomial-model" class="section level4" number="4.2.3.3">
<h4><span class="header-section-number">4.2.3.3</span> Application: Bayesian prior in Beta-binomial model</h4>
<p>If we use information from the population, or from expert knowledge,
that effect measures should move in the same direction then a beta distribution with <span class="math inline">\(shape1 &gt; 1, shape2 &gt; 1\)</span>
would make sense and provide a better prior for the Beta-binomial model.</p>
<p>On the contrary, if we wish that the model look into the unlikely events
that effect measure do not move in the same directions, then
a beta distribution with <span class="math inline">\(shape1 \leq 1, shape2 \leq 1\)</span> could be supported
by the results from above.</p>
</div>
</div>
</div>
<div id="causal-interaction" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Causal Interaction</h2>
</div>
<div id="exercises-4" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Exercises</h2>
<p>Please note that the solutions to exercises of <span class="citation"><a href="#ref-brumback2022" role="doc-biblioref">Brumback</a> (<a href="#ref-brumback2022" role="doc-biblioref">2022</a>)</span> below are my own
and have not been verified or approved in any way by the author.</p>
<div id="exercise-1-4" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Exercise 1</h3>
<p>Comment: Using the causal power, the conclusion is different than the official
answer. It is not obvious why the official solution does not make use of
the <em>causal power</em>.</p>
<p>Let <span class="math inline">\(Y \in \{0,1\}\)</span> mean that there is a cost barrier <span class="math inline">\(Y=1\)</span> or not <span class="math inline">\(Y=0\)</span>.</p>
<p>Let <span class="math inline">\(T \in \{0,1\}\)</span> mean that the individual is a person with disability <span class="math inline">\(T=1\)</span>
or not <span class="math inline">\(T=0\)</span></p>
<p>Let <span class="math inline">\(M \in \{0,1\}\)</span> mean that the individual is 65-year or older <span class="math inline">\(M = 1\)</span> or
is younger than 65 year-old <span class="math inline">\(M=0\)</span>.</p>
<p>and so we are given that</p>
<p><span class="math display">\[
p_0 = \hat{E}(Y \mid T = 0, M = 0) = 0.225 \\
p_1 = \hat{E}(Y \mid T = 1, M = 0) = 0.383 \\
p_2 = \hat{E}(Y \mid T = 0, M = 1) = 0.04 \\
p_3 = \hat{E}(Y \mid T = 1, M = 1) = 0.072 
\]</span></p>
<p>and so we compute the effect measures by age group</p>
<p><span class="math display">\[
\begin{align*}
RD_0 &amp;= p_1 - p_0 = 0.383-0.225  \\
RD_1 &amp;= p_3 - p_2 = 0.072-0.04 \\
RR_0 &amp;= \frac{p_1}{p_0} = \frac{0.383}{0.225} \\
RR_1 &amp;= \frac{p_3}{p_2} = \frac{0.072}{0.04} \\
RR^*_0 &amp;= \frac{1-p_0}{1-p_1}=\frac{1-0.225}{1-0.383} \\
RR^*_1 &amp;= \frac{1-p_2}{1-p_3}=\frac{1-0.04}{1-0.072} \\
RO_0 &amp;= \frac{\frac{p_1}{1-p_1}}{\frac{p_0}{1-p_0}} \\
RO_1 &amp;= \frac{\frac{p_3}{1-p_3}}{\frac{p_2}{1-p_2}}
\end{align*}
\]</span></p>
<p>which gives</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="measures.html#cb142-1" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.225</span></span>
<span id="cb142-2"><a href="measures.html#cb142-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fl">0.383</span></span>
<span id="cb142-3"><a href="measures.html#cb142-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fl">0.04</span></span>
<span id="cb142-4"><a href="measures.html#cb142-4" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fl">0.072</span></span>
<span id="cb142-5"><a href="measures.html#cb142-5" aria-hidden="true" tabindex="-1"></a>RD0 <span class="ot">&lt;-</span> p1 <span class="sc">-</span> p0</span>
<span id="cb142-6"><a href="measures.html#cb142-6" aria-hidden="true" tabindex="-1"></a>RD1 <span class="ot">&lt;-</span> p3 <span class="sc">-</span> p2</span>
<span id="cb142-7"><a href="measures.html#cb142-7" aria-hidden="true" tabindex="-1"></a>RR0 <span class="ot">&lt;-</span> p1 <span class="sc">/</span> p0</span>
<span id="cb142-8"><a href="measures.html#cb142-8" aria-hidden="true" tabindex="-1"></a>RR1 <span class="ot">&lt;-</span> p3 <span class="sc">/</span> p2</span>
<span id="cb142-9"><a href="measures.html#cb142-9" aria-hidden="true" tabindex="-1"></a>RR0star <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p0) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p1)</span>
<span id="cb142-10"><a href="measures.html#cb142-10" aria-hidden="true" tabindex="-1"></a>RR1star <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>p2) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p3)</span>
<span id="cb142-11"><a href="measures.html#cb142-11" aria-hidden="true" tabindex="-1"></a>RO0 <span class="ot">&lt;-</span> (p1 <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p1)) <span class="sc">/</span> (p0 <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p0))</span>
<span id="cb142-12"><a href="measures.html#cb142-12" aria-hidden="true" tabindex="-1"></a>RO1 <span class="ot">&lt;-</span> (p3 <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p3)) <span class="sc">/</span> (p2 <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p2))</span>
<span id="cb142-13"><a href="measures.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;RD0&quot;</span> <span class="ot">=</span> RD0, <span class="st">&quot;RD1&quot;</span> <span class="ot">=</span> RD1, <span class="st">&quot;RR0&quot;</span> <span class="ot">=</span> RR0, <span class="st">&quot;RR1&quot;</span> <span class="ot">=</span> RR1,</span>
<span id="cb142-14"><a href="measures.html#cb142-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;RR0star&quot;</span> <span class="ot">=</span> RR0star, <span class="st">&quot;RR1star&quot;</span> <span class="ot">=</span> RR1star, <span class="st">&quot;RO0&quot;</span> <span class="ot">=</span> RO0, <span class="st">&quot;RO1&quot;</span> <span class="ot">=</span> RO1)</span></code></pre></div>
<pre><code>##      RD0      RD1      RR0      RR1  RR0star  RR1star      RO0      RO1 
## 0.158000 0.032000 1.702222 1.800000 1.256078 1.034483 2.138124 1.862069</code></pre>
<p>and if we define</p>
<p><span class="math display">\[
\begin{align*}
RD &amp;= RD_1 - RD_0 \\
RR &amp;= RR_1 - RR_0 \\
RRstar &amp;= RR1star_1 - RRstar_0 \\
RO &amp;= RO_1 - RO_0
\end{align*}
\]</span></p>
<p>then</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="measures.html#cb144-1" aria-hidden="true" tabindex="-1"></a>RD <span class="ot">=</span> RD1 <span class="sc">-</span> RD0</span>
<span id="cb144-2"><a href="measures.html#cb144-2" aria-hidden="true" tabindex="-1"></a>RR <span class="ot">=</span> RR1 <span class="sc">-</span> RR0</span>
<span id="cb144-3"><a href="measures.html#cb144-3" aria-hidden="true" tabindex="-1"></a>RRstar <span class="ot">=</span> RR1star <span class="sc">-</span> RR0star</span>
<span id="cb144-4"><a href="measures.html#cb144-4" aria-hidden="true" tabindex="-1"></a>RO <span class="ot">=</span> RO1 <span class="sc">-</span> RO0</span>
<span id="cb144-5"><a href="measures.html#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;RD&quot;</span> <span class="ot">=</span> RD, <span class="st">&quot;RR&quot;</span> <span class="ot">=</span> RR, <span class="st">&quot;RRstar&quot;</span> <span class="ot">=</span> RRstar, <span class="st">&quot;RO&quot;</span> <span class="ot">=</span> RO)</span></code></pre></div>
<pre><code>##          RD          RR      RRstar          RO 
## -0.12600000  0.09777778 -0.22159504 -0.27605457</code></pre>
<p><em>Is there a clear answer to determining which age group has a stronger effect
of disability having a cost barrier to health care?</em></p>
<p>The difference in <span class="math inline">\(RD\)</span> from people 65-year older and younger ones is -0.126
but the difference in Risk ratio <span class="math inline">\(RR\)</span> is 0.098 and therefore not in the same
direction which normally is a minority case and needs to investigated before
reaching a conclusion. Thereofre, no, there is no clear answer to the question.</p>
<p><em>Which age group would benefit the most from an intervention?</em></p>
<p>The causal power (see p. 45) <span class="math inline">\(CP_0\)</span> represents the fraction of people who are
younger than 65 year-old who have a disability would not have met a cost barrier
to health if they had received helped to compensate for their disabilities.</p>
<p><span class="math display">\[
CP_0 = \frac{p_1 - p_0}{1-p_0}= \frac{0.383-0.225}{1-0.225} = 0.2
\]</span></p>
<p>The causal power (see p. 45) <span class="math inline">\(CP_1\)</span> represents the fraction of people who are
older than 65 year-old who have a disability would not have met a cost barrier
to health if they had received helped to compensate for their disabilities.</p>
<p><span class="math display">\[
CP_1 = \frac{p_3 - p_2}{1-p_2}= \frac{0.072-0.04}{1-0.04} = 0.3
\]</span></p>
<p>Therefore it seems that the help would benefit people older than 65 about 50%
more than younger people. However we have to be careful since, as mentioned
above, not ll measures move in the same direction and further investigation is
necessary.</p>
</div>
<div id="exercise-2-3" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Exercise 2</h3>
<p>We process the data with function <code>boot.r</code> from above.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="measures.html#cb146-1" aria-hidden="true" tabindex="-1"></a>sepsis.out <span class="ot">&lt;-</span> <span class="fu">boot.r</span>(sepsis, <span class="at">formula =</span> zubrod45 <span class="sc">~</span> shock <span class="sc">+</span> gt65, </span>
<span id="cb146-2"><a href="measures.html#cb146-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">R =</span> <span class="dv">1000</span>, <span class="at">conf =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<p>then create the table of results</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="measures.html#cb147-1" aria-hidden="true" tabindex="-1"></a>sepsi.tbl <span class="ot">&lt;-</span> <span class="fu">tbl_boot.r</span>(sepsis.out, <span class="at">title =</span> <span class="st">&quot;**Sepsis Study**&quot;</span>)</span>
<span id="cb147-2"><a href="measures.html#cb147-2" aria-hidden="true" tabindex="-1"></a>sepsi.tbl</span></code></pre></div>
<div id="yoqkdtejir" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yoqkdtejir .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yoqkdtejir .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yoqkdtejir .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yoqkdtejir .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: bold;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yoqkdtejir .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yoqkdtejir .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yoqkdtejir .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yoqkdtejir .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yoqkdtejir .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yoqkdtejir .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yoqkdtejir .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yoqkdtejir .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yoqkdtejir .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yoqkdtejir .gt_from_md > :first-child {
  margin-top: 0;
}

#yoqkdtejir .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yoqkdtejir .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yoqkdtejir .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yoqkdtejir .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yoqkdtejir .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yoqkdtejir .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yoqkdtejir .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yoqkdtejir .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yoqkdtejir .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yoqkdtejir .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yoqkdtejir .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yoqkdtejir .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yoqkdtejir .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yoqkdtejir .gt_left {
  text-align: left;
}

#yoqkdtejir .gt_center {
  text-align: center;
}

#yoqkdtejir .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yoqkdtejir .gt_font_normal {
  font-weight: normal;
}

#yoqkdtejir .gt_font_bold {
  font-weight: bold;
}

#yoqkdtejir .gt_font_italic {
  font-style: italic;
}

#yoqkdtejir .gt_super {
  font-size: 65%;
}

#yoqkdtejir .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="10" class="gt_heading gt_title gt_font_normal" style><strong><strong>Sepsis Study</strong></strong></th>
    </tr>
    <tr>
      <th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Effect-measure Modification</strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1"></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M0</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M1</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">diff</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left gt_stub">EYT0</td>
<td class="gt_row gt_center">0.15</td>
<td class="gt_row gt_center">0.09</td>
<td class="gt_row gt_center">0.20</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.38</td>
<td class="gt_row gt_center">0.27</td>
<td class="gt_row gt_center">0.48</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.23</td>
<td class="gt_row gt_center">0.11</td>
<td class="gt_row gt_center">0.35</td></tr>
    <tr><td class="gt_row gt_left gt_stub">EYT1</td>
<td class="gt_row gt_center gt_striped">0.37</td>
<td class="gt_row gt_center gt_striped">0.21</td>
<td class="gt_row gt_center gt_striped">0.54</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.57</td>
<td class="gt_row gt_center gt_striped">0.43</td>
<td class="gt_row gt_center gt_striped">0.72</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.20</td>
<td class="gt_row gt_center gt_striped">&minus;0.02</td>
<td class="gt_row gt_center gt_striped">0.42</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RD</td>
<td class="gt_row gt_center">0.22</td>
<td class="gt_row gt_center">0.05</td>
<td class="gt_row gt_center">0.40</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.20</td>
<td class="gt_row gt_center">0.02</td>
<td class="gt_row gt_center">0.38</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.03</td>
<td class="gt_row gt_center">&minus;0.27</td>
<td class="gt_row gt_center">0.22</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RR</td>
<td class="gt_row gt_center gt_striped">2.48</td>
<td class="gt_row gt_center gt_striped">1.38</td>
<td class="gt_row gt_center gt_striped">4.74</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.52</td>
<td class="gt_row gt_center gt_striped">1.04</td>
<td class="gt_row gt_center gt_striped">2.27</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.61</td>
<td class="gt_row gt_center gt_striped">0.29</td>
<td class="gt_row gt_center gt_striped">1.23</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RRstar</td>
<td class="gt_row gt_center">1.35</td>
<td class="gt_row gt_center">1.02</td>
<td class="gt_row gt_center">1.79</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.46</td>
<td class="gt_row gt_center">0.99</td>
<td class="gt_row gt_center">2.15</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.08</td>
<td class="gt_row gt_center">0.68</td>
<td class="gt_row gt_center">1.73</td></tr>
    <tr><td class="gt_row gt_left gt_stub">OR</td>
<td class="gt_row gt_center gt_striped">3.36</td>
<td class="gt_row gt_center gt_striped">1.44</td>
<td class="gt_row gt_center gt_striped">8.27</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">2.22</td>
<td class="gt_row gt_center gt_striped">1.05</td>
<td class="gt_row gt_center gt_striped">4.81</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.66</td>
<td class="gt_row gt_center gt_striped">0.21</td>
<td class="gt_row gt_center gt_striped">2.02</td></tr>
  </tbody>
  
  
</table>
</div>
<p>and plotting the results</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="measures.html#cb148-1" aria-hidden="true" tabindex="-1"></a>sepsis.plot <span class="ot">&lt;-</span> <span class="fu">plot_boot.r</span>(sepsis.out, <span class="at">title =</span> <span class="st">&quot;Sepsis Study&quot;</span>)</span>
<span id="cb148-2"><a href="measures.html#cb148-2" aria-hidden="true" tabindex="-1"></a>sepsis.plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
<p>Both <span class="math inline">\(RR\)</span> and <span class="math inline">\(OR\)</span> are show a reduction in relative terms when comparing 65-yars
olds to younger people. That is, in relative terms, the event of a shock does
reduces more the zubrod score for older people.</p>
<p>However the effect is not entirely clear as not all effect measures change
in the same direction as should be the case. More investigaitons is required.</p>
</div>
<div id="exercise-3-3" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Exercise 3</h3>
<p>We process the data with function <code>boot.r</code> from above. See exercise #3 of
chapter 3 for details on the <code>brfss</code> data set. We are required to filter
respondents aged less than 65.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="measures.html#cb149-1" aria-hidden="true" tabindex="-1"></a>dataBRFSS <span class="ot">&lt;-</span> brfss[brfss<span class="sc">$</span>gt65 <span class="sc">==</span> <span class="dv">0</span>, ]</span></code></pre></div>
<p>we process with 500 boot iterations</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="measures.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;This takes 2 min.: We used a saved file.&quot;</span>)</span></code></pre></div>
<pre><code>## This takes 2 min.: We used a saved file.</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="measures.html#cb152-1" aria-hidden="true" tabindex="-1"></a>startTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb152-2"><a href="measures.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co"># brfss.out &lt;- boot.r(dataBRFSS, formula = insured ~ gthsedu + whitenh, </span></span>
<span id="cb152-3"><a href="measures.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                     R = 500, conf = 0.95)</span></span>
<span id="cb152-4"><a href="measures.html#cb152-4" aria-hidden="true" tabindex="-1"></a>endTime <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb152-5"><a href="measures.html#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(endTime - startTime)</span></span>
<span id="cb152-6"><a href="measures.html#cb152-6" aria-hidden="true" tabindex="-1"></a>a_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_data, <span class="st">&quot;chap04_ex3.rds&quot;</span>)</span>
<span id="cb152-7"><a href="measures.html#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(brfss.out, file = a_file)</span></span>
<span id="cb152-8"><a href="measures.html#cb152-8" aria-hidden="true" tabindex="-1"></a>brfss.out <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> a_file)</span></code></pre></div>
<p>then create the table of results</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="measures.html#cb153-1" aria-hidden="true" tabindex="-1"></a>brfss.tbl <span class="ot">&lt;-</span> <span class="fu">tbl_boot.r</span>(brfss.out, <span class="at">title =</span> <span class="st">&quot;**BRFSS Survey**&quot;</span>)</span>
<span id="cb153-2"><a href="measures.html#cb153-2" aria-hidden="true" tabindex="-1"></a>brfss.tbl</span></code></pre></div>
<div id="veiaeqdmhn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#veiaeqdmhn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#veiaeqdmhn .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#veiaeqdmhn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: bold;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#veiaeqdmhn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: bold;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#veiaeqdmhn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#veiaeqdmhn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#veiaeqdmhn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#veiaeqdmhn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#veiaeqdmhn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#veiaeqdmhn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#veiaeqdmhn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#veiaeqdmhn .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#veiaeqdmhn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#veiaeqdmhn .gt_from_md > :first-child {
  margin-top: 0;
}

#veiaeqdmhn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#veiaeqdmhn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#veiaeqdmhn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#veiaeqdmhn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#veiaeqdmhn .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#veiaeqdmhn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#veiaeqdmhn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#veiaeqdmhn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#veiaeqdmhn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#veiaeqdmhn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#veiaeqdmhn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#veiaeqdmhn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#veiaeqdmhn .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#veiaeqdmhn .gt_left {
  text-align: left;
}

#veiaeqdmhn .gt_center {
  text-align: center;
}

#veiaeqdmhn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#veiaeqdmhn .gt_font_normal {
  font-weight: normal;
}

#veiaeqdmhn .gt_font_bold {
  font-weight: bold;
}

#veiaeqdmhn .gt_font_italic {
  font-style: italic;
}

#veiaeqdmhn .gt_super {
  font-size: 65%;
}

#veiaeqdmhn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="10" class="gt_heading gt_title gt_font_normal" style><strong><strong>BRFSS Survey</strong></strong></th>
    </tr>
    <tr>
      <th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Effect-measure Modification</strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1"></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M0</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">M1</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3">
        <span class="gt_column_spanner">diff</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">est</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lci</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">uci</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left gt_stub">EYT0</td>
<td class="gt_row gt_center">0.70</td>
<td class="gt_row gt_center">0.69</td>
<td class="gt_row gt_center">0.70</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.84</td>
<td class="gt_row gt_center">0.84</td>
<td class="gt_row gt_center">0.85</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.15</td>
<td class="gt_row gt_center">0.14</td>
<td class="gt_row gt_center">0.15</td></tr>
    <tr><td class="gt_row gt_left gt_stub">EYT1</td>
<td class="gt_row gt_center gt_striped">0.88</td>
<td class="gt_row gt_center gt_striped">0.88</td>
<td class="gt_row gt_center gt_striped">0.88</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.93</td>
<td class="gt_row gt_center gt_striped">0.93</td>
<td class="gt_row gt_center gt_striped">0.93</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.05</td>
<td class="gt_row gt_center gt_striped">0.05</td>
<td class="gt_row gt_center gt_striped">0.06</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RD</td>
<td class="gt_row gt_center">0.18</td>
<td class="gt_row gt_center">0.18</td>
<td class="gt_row gt_center">0.19</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.09</td>
<td class="gt_row gt_center">0.08</td>
<td class="gt_row gt_center">0.09</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">&minus;0.10</td>
<td class="gt_row gt_center">&minus;0.10</td>
<td class="gt_row gt_center">&minus;0.09</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RR</td>
<td class="gt_row gt_center gt_striped">1.26</td>
<td class="gt_row gt_center gt_striped">1.25</td>
<td class="gt_row gt_center gt_striped">1.28</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">1.10</td>
<td class="gt_row gt_center gt_striped">1.10</td>
<td class="gt_row gt_center gt_striped">1.11</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.87</td>
<td class="gt_row gt_center gt_striped">0.86</td>
<td class="gt_row gt_center gt_striped">0.88</td></tr>
    <tr><td class="gt_row gt_left gt_stub">RRstar</td>
<td class="gt_row gt_center">2.55</td>
<td class="gt_row gt_center">2.46</td>
<td class="gt_row gt_center">2.64</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">2.32</td>
<td class="gt_row gt_center">2.25</td>
<td class="gt_row gt_center">2.39</td>
<td class="gt_row gt_center" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.91</td>
<td class="gt_row gt_center">0.87</td>
<td class="gt_row gt_center">0.95</td></tr>
    <tr><td class="gt_row gt_left gt_stub">OR</td>
<td class="gt_row gt_center gt_striped">3.23</td>
<td class="gt_row gt_center gt_striped">3.09</td>
<td class="gt_row gt_center gt_striped">3.36</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">2.56</td>
<td class="gt_row gt_center gt_striped">2.47</td>
<td class="gt_row gt_center gt_striped">2.65</td>
<td class="gt_row gt_center gt_striped" style="border-left-width: 1.5px; border-left-style: solid; border-left-color: grey60;">0.79</td>
<td class="gt_row gt_center gt_striped">0.75</td>
<td class="gt_row gt_center gt_striped">0.84</td></tr>
  </tbody>
  
  
</table>
</div>
<p>and plotting the results</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="measures.html#cb154-1" aria-hidden="true" tabindex="-1"></a>brfss.plot <span class="ot">&lt;-</span> <span class="fu">plot_boot.r</span>(brfss.out, <span class="at">title =</span> <span class="st">&quot;BRFSS Survey&quot;</span>)</span>
<span id="cb154-2"><a href="measures.html#cb154-2" aria-hidden="true" tabindex="-1"></a>brfss.plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>For causal interpretaion we would need to assume that <code>whitenh</code> and <code>gthsedu</code>
are not correlated together by another latent variable which could possibly
be the case here.</p>
<p>if a causal interpretation were possible since all effect measures show
a reduction of the effect of having higher education when the respondent
is not white non-hispanic. In other words being white and nonhispanic
interacts with higher education to have an increased chance of being insured.</p>
</div>
<div id="exercise-4-3" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Exercise 4</h3>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="measures.html#cb155-1" aria-hidden="true" tabindex="-1"></a>dataWAVE <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb155-2"><a href="measures.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">T1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb155-3"><a href="measures.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">T2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb155-4"><a href="measures.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">c</span>(<span class="fl">0.019</span>, <span class="fl">0.057</span>, <span class="fl">0.039</span>, <span class="fl">0.094</span>),</span>
<span id="cb155-5"><a href="measures.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">108</span>, <span class="dv">105</span>, <span class="dv">103</span>, <span class="dv">107</span>))</span></code></pre></div>
<div id="using-glm" class="section level4" number="4.4.4.1">
<h4><span class="header-section-number">4.4.4.1</span> Using <code>glm</code></h4>
<p>To evaluate statistical significance we use the <code>glm()</code> function. Because our
outcome is numeric, we choose to fit the gaussian parametric model.
Also we use the <code>weights</code> parameter with the variable <span class="math inline">\(n\)</span> since the data is
aggregated.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="measures.html#cb156-1" aria-hidden="true" tabindex="-1"></a>wave.glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> Y <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T1<span class="sc">:</span>T2, </span>
<span id="cb156-2"><a href="measures.html#cb156-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> gaussian, <span class="at">weights =</span> n, <span class="at">data =</span> dataWAVE)</span>
<span id="cb156-3"><a href="measures.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wave.glm)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Y ~ T1 + T2 + T1:T2, family = gaussian, data = dataWAVE, 
##     weights = n)
## 
## Deviance Residuals: 
## [1]  0  0  0  0
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept)    0.019        NaN     NaN      NaN
## T1             0.020        NaN     NaN      NaN
## T2             0.038        NaN     NaN      NaN
## T1:T2          0.017        NaN     NaN      NaN
## 
## (Dispersion parameter for gaussian family taken to be NaN)
## 
##     Null deviance: 3.2636e-01  on 3  degrees of freedom
## Residual deviance: 6.2593e-33  on 0  degrees of freedom
## AIC: -299.44
## 
## Number of Fisher Scoring iterations: 1</code></pre>
<p>And the <code>glm</code> function cannot compute because of the dispersion measure for
the <code>gaussian</code> family.</p>
<p>Therefore we use <code>gee</code> which uses robust statistics and saves the day.</p>
</div>
<div id="using-gee" class="section level4" number="4.4.4.2">
<h4><span class="header-section-number">4.4.4.2</span> Using <code>gee</code></h4>
<p><code>gee</code> does not have a <code>weights</code> parameter like <code>glm</code> so we expand the data
before using <code>gee</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="measures.html#cb158-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="at">length =</span> <span class="dv">4</span>)</span>
<span id="cb158-2"><a href="measures.html#cb158-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb158-3"><a href="measures.html#cb158-3" aria-hidden="true" tabindex="-1"></a>dfs[[pos]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, </span>
<span id="cb158-4"><a href="measures.html#cb158-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">replicate</span>(dataWAVE<span class="sc">$</span>n[pos], </span>
<span id="cb158-5"><a href="measures.html#cb158-5" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">data.frame</span>(<span class="at">T1 =</span> <span class="dv">0</span>, <span class="at">T2 =</span> <span class="dv">0</span>, <span class="at">Y =</span> <span class="fl">0.019</span>), </span>
<span id="cb158-6"><a href="measures.html#cb158-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb158-7"><a href="measures.html#cb158-7" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb158-8"><a href="measures.html#cb158-8" aria-hidden="true" tabindex="-1"></a>dfs[[pos]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, </span>
<span id="cb158-9"><a href="measures.html#cb158-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">replicate</span>(dataWAVE<span class="sc">$</span>n[pos], </span>
<span id="cb158-10"><a href="measures.html#cb158-10" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">data.frame</span>(<span class="at">T1 =</span> <span class="dv">0</span>, <span class="at">T2 =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="fl">0.057</span>), </span>
<span id="cb158-11"><a href="measures.html#cb158-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb158-12"><a href="measures.html#cb158-12" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb158-13"><a href="measures.html#cb158-13" aria-hidden="true" tabindex="-1"></a>dfs[[pos]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, </span>
<span id="cb158-14"><a href="measures.html#cb158-14" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">replicate</span>(dataWAVE<span class="sc">$</span>n[pos], </span>
<span id="cb158-15"><a href="measures.html#cb158-15" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">data.frame</span>(<span class="at">T1 =</span> <span class="dv">1</span>, <span class="at">T2 =</span> <span class="dv">0</span>, <span class="at">Y =</span> <span class="fl">0.039</span>), </span>
<span id="cb158-16"><a href="measures.html#cb158-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb158-17"><a href="measures.html#cb158-17" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb158-18"><a href="measures.html#cb158-18" aria-hidden="true" tabindex="-1"></a>dfs[[pos]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, </span>
<span id="cb158-19"><a href="measures.html#cb158-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">replicate</span>(dataWAVE<span class="sc">$</span>n[pos], </span>
<span id="cb158-20"><a href="measures.html#cb158-20" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">data.frame</span>(<span class="at">T1 =</span> <span class="dv">1</span>, <span class="at">T2 =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="fl">0.094</span>), </span>
<span id="cb158-21"><a href="measures.html#cb158-21" aria-hidden="true" tabindex="-1"></a>                                <span class="at">simplify =</span> <span class="cn">FALSE</span>))</span>
<span id="cb158-22"><a href="measures.html#cb158-22" aria-hidden="true" tabindex="-1"></a>dataWAVErep <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dfs)</span>
<span id="cb158-23"><a href="measures.html#cb158-23" aria-hidden="true" tabindex="-1"></a>dataWAVErep<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dataWAVErep))</span></code></pre></div>
<p>then we use <code>gee</code></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="measures.html#cb159-1" aria-hidden="true" tabindex="-1"></a>wave.gee <span class="ot">&lt;-</span> gee<span class="sc">::</span><span class="fu">gee</span>(<span class="at">formula =</span> Y <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T1 <span class="sc">*</span> T2,</span>
<span id="cb159-2"><a href="measures.html#cb159-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> id, <span class="at">family =</span> gaussian, <span class="at">data =</span> dataWAVErep)</span></code></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>## (Intercept)          T1          T2       T1:T2 
##       0.019       0.020       0.038       0.017</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="measures.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wave.gee)</span></code></pre></div>
<pre><code>## 
##  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA
##  gee S-function, version 4.13 modified 98/01/27 (1998) 
## 
## Model:
##  Link:                      Identity 
##  Variance to Mean Relation: Gaussian 
##  Correlation Structure:     Independent 
## 
## Call:
## gee::gee(formula = Y ~ T1 + T2 + T1 * T2, id = id, data = dataWAVErep, 
##     family = gaussian)
## 
## Summary of Residuals:
##           Min            1Q        Median            3Q           Max 
## -9.055257e-16 -9.055257e-16  2.775558e-17  1.595946e-16  2.567391e-16 
## 
## 
## Coefficients:
##             Estimate   Naive S.E.      Naive z  Robust S.E.     Robust z
## (Intercept)    0.019 4.658032e-17 4.078976e+14 8.713425e-17 2.180543e+14
## T1             0.020 6.666917e-17 2.999887e+14 8.854187e-17 2.258818e+14
## T2             0.038 6.634338e-17 5.727776e+14 9.066498e-17 4.191254e+14
## T1:T2          0.017 9.416210e-17 1.805397e+14 9.205772e-17 1.846668e+14
## 
## Estimated Scale Parameter:  0
## Number of Iterations:  1
## 
## Working Correlation
##      [,1]
## [1,]    1</code></pre>
<p>Just by looking at the <code>Robust z</code> indicating that <span class="math inline">\(T1:T2\)</span> is 1.85e14 from
zero it is obvious that the interaction is statistically significant.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="measures.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(wave.gee))</span></code></pre></div>
<pre><code>##             Estimate   Naive S.E.      Naive z  Robust S.E.     Robust z
## (Intercept)    0.019 4.658032e-17 4.078976e+14 8.713425e-17 2.180543e+14
## T1             0.020 6.666917e-17 2.999887e+14 8.854187e-17 2.258818e+14
## T2             0.038 6.634338e-17 5.727776e+14 9.066498e-17 4.191254e+14
## T1:T2          0.017 9.416210e-17 1.805397e+14 9.205772e-17 1.846668e+14</code></pre>
<p>The actual p-value calculation (see p. 67 on how to do this) is</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="measures.html#cb167-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(wave.gee))[<span class="st">&quot;T1:T2&quot;</span>, <span class="st">&quot;Robust z&quot;</span>]</span>
<span id="cb167-2"><a href="measures.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>and since the p-value is 0 then it is statistically significant.</p>
</div>
</div>
<div id="exercise-5-3" class="section level3" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Exercise 5</h3>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="measures.html#cb169-1" aria-hidden="true" tabindex="-1"></a>dataGSS <span class="ot">&lt;-</span> gss[, <span class="fu">c</span>(<span class="st">&quot;attend&quot;</span>, <span class="st">&quot;gthsedu&quot;</span>, <span class="st">&quot;female&quot;</span>)]</span>
<span id="cb169-2"><a href="measures.html#cb169-2" aria-hidden="true" tabindex="-1"></a>dataGSS <span class="ot">&lt;-</span> dataGSS[<span class="fu">complete.cases</span>(dataGSS), ]</span>
<span id="cb169-3"><a href="measures.html#cb169-3" aria-hidden="true" tabindex="-1"></a>dataGSS<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(dataGSS))</span></code></pre></div>
<p>To determine a synergetic effect we are looking for the pattern where
<span class="math inline">\(Y(t_1 = 0, t_2 = 0) = 0\)</span>, <span class="math inline">\(Y(t_1 = 1, t_2 = 0) = 0\)</span>, <span class="math inline">\(Y(t_1 = 0, t_2 = 1) = 0\)</span>
and <span class="math inline">\(Y(t_1 = 1, t_2 = 1) = 1\)</span>. That is, as explained in p. 76 of section 4.3,
both <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span> for <span class="math inline">\(Y=1\)</span>, otherwise <span class="math inline">\(Y=0\)</span>, It is the causal type 2 shown
in table 4.4 on p. 75.</p>
<p>Assuming monotocity we can use the result from VanderWeele and Robins (2007)
discussed in p.76 of section 4.3 stating that a sufficient condition for the
synergistic effect is</p>
<p><span class="math display">\[
E(Y(1, 1)) - E(Y(0, 1)) - E(Y(1, 0)) + E(Y(0, 0)) &gt; 0
\]</span>
and if we estimate with the regression model</p>
<p><span class="math display">\[
Y = \beta_0 + \beta_1 T_1 + \beta_2 T_2 +  + \beta_3 T_1T_2
\]</span>
then we hcan determine our result with the estimates</p>
<p><span class="math display">\[
\begin{align*}
\hat{E}(Y(0, 0)) &amp;= \beta_0 \\
\hat{E}(Y(1, 0)) &amp;= \beta_1 \\ 
\hat{E}(Y(0, 1)) &amp;= \beta_2 \\
\hat{E}(Y(1, 1)) &amp;=\beta_3
\end{align*}
\]</span></p>
<p>doing he fit with <code>gee</code>, with the binomial family because our outcome is binary,
we obtain</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="measures.html#cb170-1" aria-hidden="true" tabindex="-1"></a>gss.gee <span class="ot">&lt;-</span> gee<span class="sc">::</span><span class="fu">gee</span>(<span class="at">formula =</span> attend <span class="sc">~</span> gthsedu <span class="sc">+</span> female <span class="sc">+</span> gthsedu <span class="sc">*</span> female,</span>
<span id="cb170-2"><a href="measures.html#cb170-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> id, <span class="at">family =</span> binomial, <span class="at">data =</span> dataGSS)</span></code></pre></div>
<pre><code>## Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
<pre><code>## running glm to get initial regression estimate</code></pre>
<pre><code>##    (Intercept)        gthsedu         female gthsedu:female 
##     -1.0509842      0.4313711      0.5352755     -0.3694460</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="measures.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gss.gee)</span></code></pre></div>
<pre><code>## 
##  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA
##  gee S-function, version 4.13 modified 98/01/27 (1998) 
## 
## Model:
##  Link:                      Logit 
##  Variance to Mean Relation: Binomial 
##  Correlation Structure:     Independent 
## 
## Call:
## gee::gee(formula = attend ~ gthsedu + female + gthsedu * female, 
##     id = id, data = dataGSS, family = binomial)
## 
## Summary of Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.3884615 -0.3738562 -0.2590361  0.6261438  0.7409639 
## 
## 
## Coefficients:
##                  Estimate Naive S.E.    Naive z Robust S.E.   Robust z
## (Intercept)    -1.0509842 0.08865639 -11.854580  0.08858032 -11.864759
## gthsedu         0.4313711 0.13913457   3.100388  0.13901520   3.103050
## female          0.5352755 0.11599024   4.614832  0.11589072   4.618795
## gthsedu:female -0.3694460 0.18182758  -2.031848  0.18167157  -2.033593
## 
## Estimated Scale Parameter:  1.001718
## Number of Iterations:  1
## 
## Working Correlation
##      [,1]
## [1,]    1</code></pre>
<p>so now lets compute the sufficient condition from VanderWeele and Robins (2007)
using the estimates from the regression</p>
<p><span class="math display">\[
\begin{align*}
\hat{E}(Y(1, 1)) - \hat{E}(Y(0, 1)) - \hat{E}(Y(1, 0)) + \hat{E}(Y(0, 0))
\end{align*}
\]</span></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="measures.html#cb176-1" aria-hidden="true" tabindex="-1"></a>Y11 <span class="ot">&lt;-</span> <span class="fu">coef</span>(gss.gee)[<span class="st">&quot;gthsedu:female&quot;</span>]</span>
<span id="cb176-2"><a href="measures.html#cb176-2" aria-hidden="true" tabindex="-1"></a>Y01 <span class="ot">&lt;-</span> <span class="fu">coef</span>(gss.gee)[<span class="st">&quot;female&quot;</span>]</span>
<span id="cb176-3"><a href="measures.html#cb176-3" aria-hidden="true" tabindex="-1"></a>Y10 <span class="ot">&lt;-</span> <span class="fu">coef</span>(gss.gee)[<span class="st">&quot;gthsedu&quot;</span>]</span>
<span id="cb176-4"><a href="measures.html#cb176-4" aria-hidden="true" tabindex="-1"></a>Y00 <span class="ot">&lt;-</span> <span class="fu">coef</span>(gss.gee)[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb176-5"><a href="measures.html#cb176-5" aria-hidden="true" tabindex="-1"></a>Y11 <span class="sc">-</span> Y01 <span class="sc">-</span> Y10 <span class="sc">-</span> Y00</span></code></pre></div>
<pre><code>## gthsedu:female 
##     -0.2851084</code></pre>
<p>Therefore the sufficient condition is not met. We cannot positively
confirm a causal effect without more information.</p>
</div>
<div id="exercise-6-1" class="section level3" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> Exercise 6</h3>
<p>Since we condition on H then we would filter the data based on H and apply
the sufficient condition for synergy to each data set filtered for each value
of H.</p>

<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="measures.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb178-2"><a href="measures.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb178-3"><a href="measures.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb178-4"><a href="measures.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb178-5"><a href="measures.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb178-6"><a href="measures.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb178-7"><a href="measures.html#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(simstudy)</span></code></pre></div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-brumback2022" class="csl-entry">
Brumback, Babette A. 2022. <em>Fundamentals of Causal Inference with r</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://www.crcpress.com">https://www.crcpress.com</a>.
</div>
<div id="ref-grimmett" class="csl-entry">
Geoffrey R. Grimmet, David R. Stirzacker. 2001. <em>Probability and Random Processes</em>. 3rd ed. Great Clarendon Street, oxford OX2 6DP: Oxford University Press.
</div>
<div id="ref-shanninbrumback2021" class="csl-entry">
Jake Shannin, Babette A. Brumback. 2021. <em>Disagreement Concerning Effect-Measures Modification</em>. <a href="https://arxiv.org/abs/2105.07285v1">https://arxiv.org/abs/2105.07285v1</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="outcomes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dag.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-measures.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
