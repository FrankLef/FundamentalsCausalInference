<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>D Doubly Robust Simulation | Study project: Fundamentals of Causal Inferences With R</title>
  <meta name="description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="D Doubly Robust Simulation | Study project: Fundamentals of Causal Inferences With R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="D Doubly Robust Simulation | Study project: Fundamentals of Causal Inferences With R" />
  
  <meta name="twitter:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  

<meta name="author" content="FranÃ§ois Lefebvre" />


<meta name="date" content="2022-02-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Study Project</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>I Part I</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-brief-history"><i class="fa fa-check"></i><b>1.1</b> A Brief History</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.2</b> Data Examples</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#mortality-rates-by-country"><i class="fa fa-check"></i><b>1.2.1</b> Mortality Rates by Country</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#national-center-for-education-statistics"><i class="fa fa-check"></i><b>1.2.2</b> National Center for Education Statistics</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#reducing-alcohol-consumption"><i class="fa fa-check"></i><b>1.2.3</b> Reducing Alcohol Consumption</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#general-social-survey"><i class="fa fa-check"></i><b>1.2.4</b> General Social Survey</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#a-cancer-clinical-trial"><i class="fa fa-check"></i><b>1.2.5</b> A Cancer Clinical Trial</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#exercise-1"><i class="fa fa-check"></i><b>1.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#exercise-2"><i class="fa fa-check"></i><b>1.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#exercise-3"><i class="fa fa-check"></i><b>1.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#exercise-4"><i class="fa fa-check"></i><b>1.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#exercise-5"><i class="fa fa-check"></i><b>1.3.5</b> Exercise 5</a></li>
<li class="chapter" data-level="1.3.6" data-path="intro.html"><a href="intro.html#exercise-6"><i class="fa fa-check"></i><b>1.3.6</b> Exercise 6</a></li>
<li class="chapter" data-level="1.3.7" data-path="intro.html"><a href="intro.html#exercise-7"><i class="fa fa-check"></i><b>1.3.7</b> Exercise 7</a></li>
<li class="chapter" data-level="1.3.8" data-path="intro.html"><a href="intro.html#exercise-8"><i class="fa fa-check"></i><b>1.3.8</b> Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>2</b> Conditional Probability and Expectation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>2.1</b> Conditional Probability</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="probability.html"><a href="probability.html#law-of-total-probability"><i class="fa fa-check"></i><b>2.1.1</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability.html"><a href="probability.html#conditional-expectation-and-he-law-of-total-expectation"><i class="fa fa-check"></i><b>2.2</b> Conditional Expectation and he Law of Total expectation</a></li>
<li class="chapter" data-level="2.3" data-path="probability.html"><a href="probability.html#estimation"><i class="fa fa-check"></i><b>2.3</b> Estimation</a></li>
<li class="chapter" data-level="2.4" data-path="probability.html"><a href="probability.html#sampling-distributions-and-the-bootstrap"><i class="fa fa-check"></i><b>2.4</b> Sampling Distributions and the Bootstrap</a></li>
<li class="chapter" data-level="2.5" data-path="probability.html"><a href="probability.html#exercises-1"><i class="fa fa-check"></i><b>2.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="probability.html"><a href="probability.html#exercise-1-1"><i class="fa fa-check"></i><b>2.5.1</b> Exercise 1</a></li>
<li class="chapter" data-level="2.5.2" data-path="probability.html"><a href="probability.html#exercise-2-1"><i class="fa fa-check"></i><b>2.5.2</b> Exercise 2</a></li>
<li class="chapter" data-level="2.5.3" data-path="probability.html"><a href="probability.html#exercise-3-1"><i class="fa fa-check"></i><b>2.5.3</b> Exercise 3</a></li>
<li class="chapter" data-level="2.5.4" data-path="probability.html"><a href="probability.html#exercise-4-1"><i class="fa fa-check"></i><b>2.5.4</b> Exercise 4</a></li>
<li class="chapter" data-level="2.5.5" data-path="probability.html"><a href="probability.html#exercise-5-1"><i class="fa fa-check"></i><b>2.5.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="outcomes.html"><a href="outcomes.html"><i class="fa fa-check"></i><b>3</b> Potential Outcomes and the Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="outcomes.html"><a href="outcomes.html#potential-outcomes-and-the-consistency-assumption"><i class="fa fa-check"></i><b>3.1</b> Potential Outcomes and the Consistency Assumption</a></li>
<li class="chapter" data-level="3.2" data-path="outcomes.html"><a href="outcomes.html#circumventing-the-fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>3.2</b> Circumventing the Fundamental Problem of Causal Inference</a></li>
<li class="chapter" data-level="3.3" data-path="outcomes.html"><a href="outcomes.html#effect-measures"><i class="fa fa-check"></i><b>3.3</b> Effect Measures</a></li>
<li class="chapter" data-level="3.4" data-path="outcomes.html"><a href="outcomes.html#exercises-2"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="outcomes.html"><a href="outcomes.html#exercise-1-2"><i class="fa fa-check"></i><b>3.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="3.4.2" data-path="outcomes.html"><a href="outcomes.html#exercise-2-2"><i class="fa fa-check"></i><b>3.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4.3" data-path="outcomes.html"><a href="outcomes.html#exercise-3-2"><i class="fa fa-check"></i><b>3.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="3.4.4" data-path="outcomes.html"><a href="outcomes.html#exercise-4-2"><i class="fa fa-check"></i><b>3.4.4</b> Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>4</b> Effect-Measure Modification and Causal Interaction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="measures.html"><a href="measures.html#effect-measure-modification-and-statistical-interaction"><i class="fa fa-check"></i><b>4.1</b> Effect-Measure Modification and Statistical Interaction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="measures.html"><a href="measures.html#recovery-trial"><i class="fa fa-check"></i><b>4.1.1</b> RECOVERY trial</a></li>
<li class="chapter" data-level="4.1.2" data-path="measures.html"><a href="measures.html#nces"><i class="fa fa-check"></i><b>4.1.2</b> NCES</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="measures.html"><a href="measures.html#qualitative-agreement-of-effect-measures-in-modification"><i class="fa fa-check"></i><b>4.2</b> Qualitative Agreement of Effect Measures in Modification</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="measures.html"><a href="measures.html#simulate-the-effect-measures"><i class="fa fa-check"></i><b>4.2.1</b> Simulate the effect measures</a></li>
<li class="chapter" data-level="4.2.2" data-path="measures.html"><a href="measures.html#applications"><i class="fa fa-check"></i><b>4.2.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="measures.html"><a href="measures.html#causal-interaction"><i class="fa fa-check"></i><b>4.3</b> Causal Interaction</a></li>
<li class="chapter" data-level="4.4" data-path="measures.html"><a href="measures.html#exercises-3"><i class="fa fa-check"></i><b>4.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="measures.html"><a href="measures.html#exercise-1-3"><i class="fa fa-check"></i><b>4.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="measures.html"><a href="measures.html#exercise-2-3"><i class="fa fa-check"></i><b>4.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="measures.html"><a href="measures.html#exercise-3-3"><i class="fa fa-check"></i><b>4.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="measures.html"><a href="measures.html#exercise-4-3"><i class="fa fa-check"></i><b>4.4.4</b> Exercise 4</a></li>
<li class="chapter" data-level="4.4.5" data-path="measures.html"><a href="measures.html#exercise-5-2"><i class="fa fa-check"></i><b>4.4.5</b> Exercise 5</a></li>
<li class="chapter" data-level="4.4.6" data-path="measures.html"><a href="measures.html#exercise-6-1"><i class="fa fa-check"></i><b>4.4.6</b> Exercise 6</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II</b></span></li>
<li class="chapter" data-level="5" data-path="dag.html"><a href="dag.html"><i class="fa fa-check"></i><b>5</b> Causal Directed Acyclic Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dag.html"><a href="dag.html#theory"><i class="fa fa-check"></i><b>5.1</b> Theory</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dag.html"><a href="dag.html#conditional-indepence-and-dag"><i class="fa fa-check"></i><b>5.1.1</b> Conditional Indepence and DAG</a></li>
<li class="chapter" data-level="5.1.2" data-path="dag.html"><a href="dag.html#d-separation"><i class="fa fa-check"></i><b>5.1.2</b> D-Separation</a></li>
<li class="chapter" data-level="5.1.3" data-path="dag.html"><a href="dag.html#causal-dag-with-collider"><i class="fa fa-check"></i><b>5.1.3</b> Causal DAG with collider</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dag.html"><a href="dag.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="dag.html"><a href="dag.html#causal-dag-with-intermediate-value"><i class="fa fa-check"></i><b>5.2.1</b> Causal DAG With Intermediate Value</a></li>
<li class="chapter" data-level="5.2.2" data-path="dag.html"><a href="dag.html#a-counfounder-may-occur-after-the-exposure"><i class="fa fa-check"></i><b>5.2.2</b> A counfounder may occur after the exposure</a></li>
<li class="chapter" data-level="5.2.3" data-path="dag.html"><a href="dag.html#potential-outcomes-are-the-ultimate-counfounder"><i class="fa fa-check"></i><b>5.2.3</b> Potential Outcomes are the Ultimate Counfounder</a></li>
<li class="chapter" data-level="5.2.4" data-path="dag.html"><a href="dag.html#structural-causal-model-5.7"><i class="fa fa-check"></i><b>5.2.4</b> Structural Causal Model 5.7</a></li>
<li class="chapter" data-level="5.2.5" data-path="dag.html"><a href="dag.html#potential-outcomes-behind-the-scenes"><i class="fa fa-check"></i><b>5.2.5</b> Potential Outcomes Behind the Scenes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dag.html"><a href="dag.html#exercises-4"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="dag.html"><a href="dag.html#exercise-1-4"><i class="fa fa-check"></i><b>5.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="5.3.2" data-path="dag.html"><a href="dag.html#exercise-2-4"><i class="fa fa-check"></i><b>5.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="5.3.3" data-path="dag.html"><a href="dag.html#exercise-3-4"><i class="fa fa-check"></i><b>5.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="5.3.4" data-path="dag.html"><a href="dag.html#exercise-4-4"><i class="fa fa-check"></i><b>5.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="5.3.5" data-path="dag.html"><a href="dag.html#exercise-5-3"><i class="fa fa-check"></i><b>5.3.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="backdoor.html"><a href="backdoor.html"><i class="fa fa-check"></i><b>6</b> Backdoor Method via Standardization</a>
<ul>
<li class="chapter" data-level="6.1" data-path="backdoor.html"><a href="backdoor.html#standardization-via-outome-modeling"><i class="fa fa-check"></i><b>6.1</b> Standardization via Outome Modeling</a>
<ul>
<li class="chapter" data-level="" data-path="backdoor.html"><a href="backdoor.html#examples-1"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="6.1.1" data-path="backdoor.html"><a href="backdoor.html#average-effect-of-treatment-on-the-treated"><i class="fa fa-check"></i><b>6.1.1</b> Average Effect of Treatment on the Treated</a></li>
<li class="chapter" data-level="6.1.2" data-path="backdoor.html"><a href="backdoor.html#standardization-with-a-parametric-outcome-model"><i class="fa fa-check"></i><b>6.1.2</b> Standardization with a Parametric Outcome Model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="backdoor.html"><a href="backdoor.html#standardization-via-exposure-modeling"><i class="fa fa-check"></i><b>6.2</b> Standardization via Exposure Modeling</a>
<ul>
<li class="chapter" data-level="" data-path="backdoor.html"><a href="backdoor.html#examples-2"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="6.2.1" data-path="backdoor.html"><a href="backdoor.html#average-effect-of-treatment-on-the-treated-1"><i class="fa fa-check"></i><b>6.2.1</b> Average Effect of Treatment on the Treated</a></li>
<li class="chapter" data-level="6.2.2" data-path="backdoor.html"><a href="backdoor.html#standardization-with-a-parametric-exposure-model"><i class="fa fa-check"></i><b>6.2.2</b> Standardization with a Parametric Exposure Model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="backdoor.html"><a href="backdoor.html#doubly-robust-standardization"><i class="fa fa-check"></i><b>6.3</b> Doubly Robust Standardization</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="backdoor.html"><a href="backdoor.html#doubly-robust-standardization-simulation"><i class="fa fa-check"></i><b>6.3.1</b> Doubly Robust Standardization Simulation</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="errata.html"><a href="errata.html"><i class="fa fa-check"></i><b>A</b> Errata</a>
<ul>
<li class="chapter" data-level="A.1" data-path="errata.html"><a href="errata.html#preface"><i class="fa fa-check"></i><b>A.1</b> Preface</a></li>
<li class="chapter" data-level="A.2" data-path="errata.html"><a href="errata.html#chapter-1"><i class="fa fa-check"></i><b>A.2</b> Chapter 1</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="errata.html"><a href="errata.html#section-1.2.3.2-p.-11"><i class="fa fa-check"></i><b>A.2.1</b> Section 1.2.3.2, p.Â 11</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="errata.html"><a href="errata.html#chapter-2"><i class="fa fa-check"></i><b>A.3</b> Chapter 2</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="errata.html"><a href="errata.html#figure-2.1-p.-30"><i class="fa fa-check"></i><b>A.3.1</b> Figure 2.1, p.Â 30</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="errata.html"><a href="errata.html#chapter-3"><i class="fa fa-check"></i><b>A.4</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="errata.html"><a href="errata.html#typography-section-3.2-p.-40-equation-3.1"><i class="fa fa-check"></i><b>A.4.1</b> Typography: section 3.2 p.Â 40, equation 3.1</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="errata.html"><a href="errata.html#chapter-4"><i class="fa fa-check"></i><b>A.5</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="errata.html"><a href="errata.html#section-4.1-p.-67-on-top"><i class="fa fa-check"></i><b>A.5.1</b> Section 4.1 p.Â 67 (on top)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="errata.html"><a href="errata.html#chapter-5"><i class="fa fa-check"></i><b>A.6</b> Chapter 5</a></li>
<li class="chapter" data-level="A.7" data-path="errata.html"><a href="errata.html#chapter-6"><i class="fa fa-check"></i><b>A.7</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="errata.html"><a href="errata.html#section-6.1-p.-100-first-paragraph"><i class="fa fa-check"></i><b>A.7.1</b> Section 6.1 p.Â 100, first paragraph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>B</b> Notes</a>
<ul>
<li class="chapter" data-level="B.1" data-path="notes.html"><a href="notes.html#chapter-2-1"><i class="fa fa-check"></i><b>B.1</b> Chapter 2</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="notes.html"><a href="notes.html#section-2.4-p.-31"><i class="fa fa-check"></i><b>B.1.1</b> section 2.4 p.Â 31</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="notes.html"><a href="notes.html#chapter-4-1"><i class="fa fa-check"></i><b>B.2</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="notes.html"><a href="notes.html#section-4.1"><i class="fa fa-check"></i><b>B.2.1</b> Section 4.1</a></li>
<li class="chapter" data-level="B.2.2" data-path="notes.html"><a href="notes.html#section-4.2"><i class="fa fa-check"></i><b>B.2.2</b> Section 4.2</a></li>
<li class="chapter" data-level="B.2.3" data-path="notes.html"><a href="notes.html#exercises-5"><i class="fa fa-check"></i><b>B.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="notes.html"><a href="notes.html#chapter-6-1"><i class="fa fa-check"></i><b>B.3</b> Chapter 6</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="notes.html"><a href="notes.html#section-6.1.1-att"><i class="fa fa-check"></i><b>B.3.1</b> Section 6.1.1 ATT</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>C</b> Functions</a>
<ul>
<li class="chapter" data-level="C.1" data-path="functions.html"><a href="functions.html#chapter-2-2"><i class="fa fa-check"></i><b>C.1</b> Chapter 2</a></li>
<li class="chapter" data-level="C.2" data-path="functions.html"><a href="functions.html#chapter-3-1"><i class="fa fa-check"></i><b>C.2</b> Chapter 3</a>
<ul>
<li class="chapter" data-level="C.2.1" data-path="functions.html"><a href="functions.html#gt_measures.r"><i class="fa fa-check"></i><b>C.2.1</b> <code>gt_measures.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="functions.html"><a href="functions.html#chapter-4-2"><i class="fa fa-check"></i><b>C.3</b> Chapter 4</a>
<ul>
<li class="chapter" data-level="C.3.1" data-path="functions.html"><a href="functions.html#gt_measures_modif.r"><i class="fa fa-check"></i><b>C.3.1</b> <code>gt_measures_modif.R</code></a></li>
<li class="chapter" data-level="C.3.2" data-path="functions.html"><a href="functions.html#ggp_measures_modif.r"><i class="fa fa-check"></i><b>C.3.2</b> <code>ggp_measures_modif.R</code></a></li>
<li class="chapter" data-level="C.3.3" data-path="functions.html"><a href="functions.html#mc_beta_effect_measures.r"><i class="fa fa-check"></i><b>C.3.3</b> <code>mc_beta_effect_measures.R</code></a></li>
<li class="chapter" data-level="C.3.4" data-path="functions.html"><a href="functions.html#ggp_venn_sim.r"><i class="fa fa-check"></i><b>C.3.4</b> <code>ggp_venn_sim.R</code></a></li>
<li class="chapter" data-level="C.3.5" data-path="functions.html"><a href="functions.html#ggp_betasim.r"><i class="fa fa-check"></i><b>C.3.5</b> <code>ggp_betasim.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="functions.html"><a href="functions.html#chapter-5-1"><i class="fa fa-check"></i><b>C.4</b> Chapter 5</a>
<ul>
<li class="chapter" data-level="C.4.1" data-path="functions.html"><a href="functions.html#ggp_dag.r"><i class="fa fa-check"></i><b>C.4.1</b> <code>ggp_dag.R</code></a></li>
<li class="chapter" data-level="C.4.2" data-path="functions.html"><a href="functions.html#gt_probs.r"><i class="fa fa-check"></i><b>C.4.2</b> <code>gt_probs.R</code></a></li>
</ul></li>
<li class="chapter" data-level="C.5" data-path="functions.html"><a href="functions.html#chapter-6-2"><i class="fa fa-check"></i><b>C.5</b> Chapter 6</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="mc_standdr.html"><a href="mc_standdr.html"><i class="fa fa-check"></i><b>D</b> Doubly Robust Simulation</a>
<ul>
<li class="chapter" data-level="D.1" data-path="mc_standdr.html"><a href="mc_standdr.html#functions-used"><i class="fa fa-check"></i><b>D.1</b> Functions used</a></li>
<li class="chapter" data-level="D.2" data-path="mc_standdr.html"><a href="mc_standdr.html#analysis"><i class="fa fa-check"></i><b>D.2</b> Analysis</a></li>
<li class="chapter" data-level="D.3" data-path="mc_standdr.html"><a href="mc_standdr.html#simulation"><i class="fa fa-check"></i><b>D.3</b> Simulation</a></li>
<li class="chapter" data-level="D.4" data-path="mc_standdr.html"><a href="mc_standdr.html#scripts"><i class="fa fa-check"></i><b>D.4</b> Scripts</a>
<ul>
<li class="chapter" data-level="D.4.1" data-path="mc_standdr.html"><a href="mc_standdr.html#simdr"><i class="fa fa-check"></i><b>D.4.1</b> <code>simdr</code></a></li>
<li class="chapter" data-level="D.4.2" data-path="mc_standdr.html"><a href="mc_standdr.html#mc_standdr-1"><i class="fa fa-check"></i><b>D.4.2</b> <code>mc_standdr</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study project: Fundamentals of Causal Inferences With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mc_standdr" class="section level1" number="10">
<h1><span class="header-section-number">D</span> Doubly Robust Simulation</h1>
<div id="functions-used" class="section level2" number="10.1">
<h2><span class="header-section-number">D.1</span> Functions used</h2>
<p>The function <code>simdr</code> is found on p.Â 127-128. See the script in the last section
of this appendix. We just added some arguments and and output to facilitate the
analysis. See the next section <em>Analysis</em>.</p>
<p>The Monte Carlo simulation is done with a non-parametric Monte Carlo function
<code>mc_standdr</code> with the following script. See the section <em>Simulation</em> blow.</p>
<p>Note that <code>simdr</code> was rewritten as function <code>mc_standdr</code> to</p>
<ul>
<li>facilitate the analysis of the algorithm</li>
<li>perform a Monte Carlo simulation with the <code>MonteCarlo</code> package</li>
<li>separate the data simulation from the measurement of estimates in 2 sub functions
<ul>
<li><code>standdr_sim</code>: Simulate the data</li>
<li><code>standdr_est</code>: Calculate the estimates using the simulated data from <code>standdr_sim</code></li>
</ul></li>
</ul>
<p><code>mc_standdr</code> has been validated against <code>simdr</code> and gives exactly the same
results.</p>
</div>
<div id="analysis" class="section level2" number="10.2">
<h2><span class="header-section-number">D.2</span> Analysis</h2>
<p>Section 6.3 claims that <span class="math inline">\(T=600\)</span> and <span class="math inline">\(P(T=1 \mid H) \in [0.041, 0.0468]\)</span>
but the results obtained from running <code>simdr</code> as shown in the book are different.
Not a lot but enough to puzzle the avid reader (like me for example).</p>
<p>So lets go through <code>simdr</code> to explain the differences.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="mc_standdr.html#cb282-1" aria-hidden="true" tabindex="-1"></a>simdr.out <span class="ot">&lt;-</span> <span class="fu">simdr</span>(<span class="at">seed =</span> <span class="dv">1009</span>, <span class="at">out_choice =</span> <span class="st">&quot;sim&quot;</span>)</span>
<span id="cb282-2"><a href="mc_standdr.html#cb282-2" aria-hidden="true" tabindex="-1"></a>new_simdr.out <span class="ot">&lt;-</span> <span class="fu">standdr_sim</span>(<span class="at">seed =</span> <span class="dv">1009</span>)</span>
<span id="cb282-3"><a href="mc_standdr.html#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="co"># test the new function new_simdr.out vs simdr</span></span>
<span id="cb282-4"><a href="mc_standdr.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(simdr.out, new_simdr.out))</span></code></pre></div>
<blockquote>
<p>One might think that standardization with the exposure model would be
preferable when the outcome indicates a rare condition. To see this,
first suppose the condition is not rare. We might have 3000 individuals and 50%,
or 1500, with the condition. Using the rule of thumb for logistic regression
of Peduzzi et al.Â presented in chapter 2, we should be able to include 150
covariates in the outcome model.</p>
</blockquote>
<p>The Peduzzi rule can be found at the end of section 2.3, on top of p.Â 29. where
it states that</p>
<blockquote>
<p>both the numbers of individuals with <span class="math inline">\(Y=0\)</span> and <span class="math inline">\(Y=1\)</span> need to be larger than
ten times the number of parameters.</p>
</blockquote>
<p>and therefore</p>
<blockquote>
<p>Now suppose the exposure, <span class="math inline">\(T\)</span>, is divided more evenly: that is, we have 600
with <span class="math inline">\(T=1\)</span>. This would suggest we can include 60 covariates in the exposure model.</p>
</blockquote>
<p>Brumback uses a linear function of <span class="math inline">\(H\)</span> to create a distribution of <span class="math inline">\(T_i\)</span> that makes
it dependent on <span class="math inline">\(H\)</span> and claims to give <span class="math inline">\(\sum T_i \approx 600\)</span>.
However, <em>the simulation with <code>simdr</code> returns <span class="math inline">\(\sum T_i \approx 540\)</span></em>.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="mc_standdr.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sum of T</span></span>
<span id="cb283-2"><a href="mc_standdr.html#cb283-2" aria-hidden="true" tabindex="-1"></a>simdr.out<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span><span class="sc">$</span>sum</span></code></pre></div>
<pre><code>## [1] 541</code></pre>
<p>This is the part that needs explaining. The difference seems too large to be
explained by the usual culprit, random process</p>
<p>To be able to do that lets use some notations and go through the mechanics of <code>simdr</code>.</p>
<p>Let <span class="math inline">\(H_{j}\)</span> be the covariate <span class="math inline">\(j\)</span></p>
<p><span class="math display">\[
\begin{align*}
H_j \sim i.i.d \ \mathcal{Bernoulli}(p), \, j = 1, \ldots, J
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(J\)</span> is the same variable as <span class="math inline">\(ss\)</span> from Brumback, i.e.Â <span class="math inline">\(J = ss = 100\)</span>. Also
<span class="math inline">\(H_{i, j}\)</span> is the value of covariate <span class="math inline">\(H_j\)</span> for individual <span class="math inline">\(i\)</span>.</p>
<p>and let <span class="math inline">\(T_i\)</span> be the treatment of individual <span class="math inline">\(i\)</span></p>
<p><span class="math display">\[
\begin{align*}
T_i \sim \mathcal{Bernoulli}(p_{i}), \, i = 1, \ldots, I
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(I\)</span> is set at <span class="math inline">\(I=3000\)</span> by Brumback.</p>
<p>In addition, we let</p>
<p><span class="math display">\[
S_i = \sum_{j=1}^{J}H_{i, j} \\
\text{where } J = ss \text{ as mentioned above}
\]</span></p>
<p>and <code>simdr</code> defines <span class="math inline">\(p_i\)</span> as</p>
<p><span class="math display">\[
\begin{align*}
&amp;p_i = \beta \frac{\gamma}{J} S_i + p \times X_i \\
\
&amp;\text{where we are given} \\
&amp;\beta = 0.13 \\
&amp;\gamma = 20 \\ 
&amp;p = 0.05 \\
&amp;X_i \sim \mathcal{Normal}(mean = 1, sd = 0.1)
\end{align*}
\]</span></p>
<p>now, since</p>
<p><span class="math display">\[
\begin{align*}
H_i \text{ i.i.d. } \mathcal{Bernoulli}(p) &amp;\implies E(H_i)=p \\
T_i \sim \mathcal{Bernoulli}(p_{i}) &amp;\implies E(T_i) = p_i \\
X_i \sim \mathcal{Normal}(mean = 1, sd = 0.1) &amp;\implies E(X_i) = 1
\end{align*}
\]</span></p>
<p>and since <span class="math inline">\(E()\)</span> is a linear function then</p>
<p><span class="math display">\[
\begin{align*}
E(T_i) &amp;= p_i \\
&amp;= E(\beta \cdot \frac{\gamma}{J} S_i + p \cdot X_i) \\
&amp;= \beta \cdot \frac{\gamma}{J} \sum_{j=1}^{J}E(H_{i, j}) + p \cdot E(X_i) \\
&amp;= \beta \cdot \frac{\gamma}{J} \sum_{j=1}^{J}p + p \cdot 1 \\
&amp;= \beta \cdot \frac{\gamma}{J} \cdot J \cdot p + p \\
&amp;= \beta \cdot \gamma \cdot p + p
\end{align*}
\]</span></p>
<p>and the sum of the number of people treated is <span class="math inline">\(T = \sum_i^IT_i\)</span></p>
<p><span class="math display">\[
\begin{align*}
E(T)  &amp;= \sum_{i=1}^I{E(T_i)} \\
&amp;= \sum_{i=1}^I{(\beta \cdot \gamma \cdot p + p)} \\
&amp;= I (\beta \cdot \gamma \cdot p + p) \\
\\
&amp;\text{and since} \\ 
&amp;I = 3000, \, \beta = 0.13, \, \gamma = 20, \, p = 0.05 \\
\\
&amp;\text{then} \\
E(T) &amp;= 3000 \cdot (0.13 \cdot 20 \cdot 0.05 + 0.05) \\
&amp;= 540
\end{align*}
\]</span></p>
<p>which proves that the expected number of <span class="math inline">\(T\)</span> is not really close to 600 but rather
540 which is also the result of the simulation. Therefore we could use 54
covariates rather than 60 by the Peduzzi rule.</p>
<p>We observe that this <em>does not change the conclusions drawn from the simulation
significantly</em>.</p>
<p>Finally, we note thet the formula <span class="math inline">\(\beta \cdot \gamma \cdot p + p\)</span> could be
modified to get <span class="math inline">\(T=600\)</span> by varying the coefficient <span class="math inline">\(\beta=0.13\)</span> and/or <span class="math inline">\(\gamma=20\)</span>.
If we change only <span class="math inline">\(\beta\)</span> we could use the result from above and with simple
algebra</p>
<p><span class="math display">\[
\begin{align*}
E(T)&amp;= I (\beta \cdot \gamma \cdot p + p) \\
\\
&amp;\text{and since we want } E(T) = 600 \\
&amp;\text{and that} \\
&amp;\gamma = 20, \, I = 3000, \, p = 0.05 \\
\\
\text{then} \\
600 &amp;= 3000 \cdot (\beta \cdot 20 \cdot 0.05 + 0.05) \\
\beta &amp;= \frac{600 - 0.05 \cdot 3000}{3000 \cdot 20 \cdot0.05} = \frac{450}{3000} = 0.15
\end{align*}
\]</span></p>
<p>and we simulate using <span class="math inline">\(\beta = 0.15\)</span> to validate.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="mc_standdr.html#cb285-1" aria-hidden="true" tabindex="-1"></a>simdr600.out <span class="ot">&lt;-</span> <span class="fu">simdr</span>(<span class="at">beta =</span> <span class="fl">0.15</span>, <span class="at">seed =</span> <span class="dv">1009</span>, <span class="at">out_choice =</span> <span class="st">&quot;sim&quot;</span>)</span>
<span id="cb285-2"><a href="mc_standdr.html#cb285-2" aria-hidden="true" tabindex="-1"></a>simdr600.out<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span><span class="sc">$</span>sum</span></code></pre></div>
<pre><code>## [1] 593</code></pre>
<p>Lets continue our reading</p>
<blockquote>
<p>We simulated <span class="math inline">\(Y_i\)</span> as a function of <span class="math inline">\(T_i\)</span> and <span class="math inline">\(\sum_{k=1}^{ss}H_{i,k}\)</span>,
such that approximately 35 individuals had <span class="math inline">\(Y=1\)</span>.</p>
</blockquote>
<p>the result we get from both <code>simdr</code> is 38, close enough.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="mc_standdr.html#cb287-1" aria-hidden="true" tabindex="-1"></a>simdr.out<span class="sc">$</span>Y<span class="sc">$</span>sum</span></code></pre></div>
<pre><code>## [1] 38</code></pre>
<blockquote>
<p>The mean of <span class="math inline">\(\sum_{k=1}^{ss}{H_{ik}}\)</span> was fixed at one, but when <span class="math inline">\(ss\)</span> was set to
100, it ranged from 0.00 to 2.80.</p>
</blockquote>
<p>That is exactly waht we get.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="mc_standdr.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;min&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>sumH<span class="sc">$</span>min, <span class="st">&quot;max&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>sumH<span class="sc">$</span>max)</span></code></pre></div>
<pre><code>## min max 
## 0.0 2.8</code></pre>
<blockquote>
<p><span class="math inline">\(P(T = 1 \mid H)\)</span> ranged from 0.041 to 0.468.</p>
</blockquote>
<p><em>The results are different.</em></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="mc_standdr.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;min&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>probT<span class="sc">$</span>min, <span class="st">&quot;max&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>probT<span class="sc">$</span>max)</span></code></pre></div>
<pre><code>##        min        max 
## 0.03873516 0.41876534</code></pre>
<p>Probably because the original simulation came up with <span class="math inline">\(T = 600\)</span> rather than
<span class="math inline">\(T = 540\)</span> as discussed above. Indeed if we verify with the simulation with
<span class="math inline">\(T=600\)</span> the results are closer.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="mc_standdr.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;min&quot;</span> <span class="ot">=</span> simdr600.out<span class="sc">$</span>probT<span class="sc">$</span>min, <span class="st">&quot;max&quot;</span> <span class="ot">=</span> simdr600.out<span class="sc">$</span>probT<span class="sc">$</span>max)</span></code></pre></div>
<pre><code>##        min        max 
## 0.03873516 0.47476534</code></pre>
<blockquote>
<p><span class="math inline">\(E(Y \mid T, H)\)</span> ranged from 0.000 to 0.036.</p>
</blockquote>
<p>and the results are almost identical</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="mc_standdr.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;min&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>probY<span class="sc">$</span>min, <span class="st">&quot;max&quot;</span> <span class="ot">=</span> simdr.out<span class="sc">$</span>probY<span class="sc">$</span>max)</span></code></pre></div>
<pre><code>##   min   max 
## 0.000 0.038</code></pre>
<p>And with this we are ready to proceed with the simulation with varying <span class="math inline">\(ss\)</span>.</p>
</div>
<div id="simulation" class="section level2" number="10.3">
<h2><span class="header-section-number">D.3</span> Simulation</h2>
</div>
<div id="scripts" class="section level2" number="10.4">
<h2><span class="header-section-number">D.4</span> Scripts</h2>
<div id="simdr" class="section level3" number="10.4.1">
<h3><span class="header-section-number">D.4.1</span> <code>simdr</code></h3>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="mc_standdr.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Doubly Robust Standardization Simulation</span></span>
<span id="cb297-2"><a href="mc_standdr.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb297-3"><a href="mc_standdr.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Doubly robust standardization simulation.</span></span>
<span id="cb297-4"><a href="mc_standdr.html#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb297-5"><a href="mc_standdr.html#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is the function used in \emph{Fundamentals of Causal Inference} by</span></span>
<span id="cb297-6"><a href="mc_standdr.html#cb297-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; B. Brumback in section 6.3 of chapter 6, p.127-128. This is the same except</span></span>
<span id="cb297-7"><a href="mc_standdr.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for the addition of \code{out_choice} which is only to select what output</span></span>
<span id="cb297-8"><a href="mc_standdr.html#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the function returns. It replaces the numerous \code(return) such as</span></span>
<span id="cb297-9"><a href="mc_standdr.html#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \code{return(range(sumH))} found in the original script. \code{out_choice} is</span></span>
<span id="cb297-10"><a href="mc_standdr.html#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; useful to prove the algorithm to the reader. Also, \code{standdr_stats} is</span></span>
<span id="cb297-11"><a href="mc_standdr.html#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; used in the output to give more statistics. Also the arguments </span></span>
<span id="cb297-12"><a href="mc_standdr.html#cb297-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \code{beta = 0.13} and \code{gamma = 20} were necessary to analyse the</span></span>
<span id="cb297-13"><a href="mc_standdr.html#cb297-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; algorithm, they don&#39;e change anything.</span></span>
<span id="cb297-14"><a href="mc_standdr.html#cb297-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-15"><a href="mc_standdr.html#cb297-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ss Number of covariates i.i.d with \code{rbinom(n, size=1, prob=probH)}</span></span>
<span id="cb297-16"><a href="mc_standdr.html#cb297-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta coefficient used to compute the distribution of \code{`T`}.</span></span>
<span id="cb297-17"><a href="mc_standdr.html#cb297-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param gamma coefficient used to compute the distribution of \code{`T`}.</span></span>
<span id="cb297-18"><a href="mc_standdr.html#cb297-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param probH Probability of success on each trial.</span></span>
<span id="cb297-19"><a href="mc_standdr.html#cb297-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param seed Seed used for random number generation, default is \code{NULL}.</span></span>
<span id="cb297-20"><a href="mc_standdr.html#cb297-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param out_choice With &quot;sim&quot;, output the simulation; with &quot;est&quot;, output the</span></span>
<span id="cb297-21"><a href="mc_standdr.html#cb297-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; estimates; with &quot;both&quot; (default), output everything.</span></span>
<span id="cb297-22"><a href="mc_standdr.html#cb297-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-23"><a href="mc_standdr.html#cb297-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return List of values depending on \code{out_choice}.</span></span>
<span id="cb297-24"><a href="mc_standdr.html#cb297-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-25"><a href="mc_standdr.html#cb297-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb297-26"><a href="mc_standdr.html#cb297-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \dontrun{</span></span>
<span id="cb297-27"><a href="mc_standdr.html#cb297-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; simdr()</span></span>
<span id="cb297-28"><a href="mc_standdr.html#cb297-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb297-29"><a href="mc_standdr.html#cb297-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb297-30"><a href="mc_standdr.html#cb297-30" aria-hidden="true" tabindex="-1"></a>simdr <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">ss =</span> <span class="dv">100</span>, <span class="at">beta =</span> <span class="fl">0.13</span>, <span class="at">gamma =</span> <span class="dv">20</span>, <span class="at">seed =</span> <span class="cn">NULL</span>,</span>
<span id="cb297-31"><a href="mc_standdr.html#cb297-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">out_choice =</span> <span class="fu">c</span>(<span class="st">&quot;all&quot;</span>, <span class="st">&quot;sim&quot;</span>, <span class="st">&quot;est&quot;</span>)) {</span>
<span id="cb297-32"><a href="mc_standdr.html#cb297-32" aria-hidden="true" tabindex="-1"></a>  out_choice <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(out_choice)</span>
<span id="cb297-33"><a href="mc_standdr.html#cb297-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb297-34"><a href="mc_standdr.html#cb297-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-35"><a href="mc_standdr.html#cb297-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ss is the number of confounders</span></span>
<span id="cb297-36"><a href="mc_standdr.html#cb297-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i.e. the number of columns of H</span></span>
<span id="cb297-37"><a href="mc_standdr.html#cb297-37" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">3000</span>, ss)</span>
<span id="cb297-38"><a href="mc_standdr.html#cb297-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let all components of H be independent Bernoulli variables with p=0.05</span></span>
<span id="cb297-39"><a href="mc_standdr.html#cb297-39" aria-hidden="true" tabindex="-1"></a>  probH <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.05</span>, <span class="dv">3000</span>)</span>
<span id="cb297-40"><a href="mc_standdr.html#cb297-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ss) {</span>
<span id="cb297-41"><a href="mc_standdr.html#cb297-41" aria-hidden="true" tabindex="-1"></a>    H[, i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probH)</span>
<span id="cb297-42"><a href="mc_standdr.html#cb297-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-43"><a href="mc_standdr.html#cb297-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let the treatment depend on a function of H</span></span>
<span id="cb297-44"><a href="mc_standdr.html#cb297-44" aria-hidden="true" tabindex="-1"></a>  sumH <span class="ot">&lt;-</span> <span class="fu">apply</span>(H, <span class="dv">1</span>, sum) <span class="sc">*</span> gamma <span class="sc">/</span> ss</span>
<span id="cb297-45"><a href="mc_standdr.html#cb297-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(T=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb297-46"><a href="mc_standdr.html#cb297-46" aria-hidden="true" tabindex="-1"></a>  probT <span class="ot">&lt;-</span> beta <span class="sc">*</span> sumH <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb297-47"><a href="mc_standdr.html#cb297-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-48"><a href="mc_standdr.html#cb297-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probT)</span>
<span id="cb297-49"><a href="mc_standdr.html#cb297-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-50"><a href="mc_standdr.html#cb297-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the outcome depend on T and H</span></span>
<span id="cb297-51"><a href="mc_standdr.html#cb297-51" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> sumH</span>
<span id="cb297-52"><a href="mc_standdr.html#cb297-52" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb297-53"><a href="mc_standdr.html#cb297-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-54"><a href="mc_standdr.html#cb297-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put the simulated resuts in a list</span></span>
<span id="cb297-55"><a href="mc_standdr.html#cb297-55" aria-hidden="true" tabindex="-1"></a>  sim <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;sumH&quot;</span> <span class="ot">=</span> <span class="fu">simdr_stats</span>(sumH),</span>
<span id="cb297-56"><a href="mc_standdr.html#cb297-56" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;probT&quot;</span> <span class="ot">=</span> <span class="fu">simdr_stats</span>(probT),</span>
<span id="cb297-57"><a href="mc_standdr.html#cb297-57" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="fu">simdr_stats</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>),</span>
<span id="cb297-58"><a href="mc_standdr.html#cb297-58" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;probY&quot;</span> <span class="ot">=</span> <span class="fu">simdr_stats</span>(probY),</span>
<span id="cb297-59"><a href="mc_standdr.html#cb297-59" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="fu">simdr_stats</span>(Y))</span>
<span id="cb297-60"><a href="mc_standdr.html#cb297-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-61"><a href="mc_standdr.html#cb297-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit the exposure model</span></span>
<span id="cb297-62"><a href="mc_standdr.html#cb297-62" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="fu">lm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H))</span>
<span id="cb297-63"><a href="mc_standdr.html#cb297-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-64"><a href="mc_standdr.html#cb297-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the exposure model using an incorrect logistic model</span></span>
<span id="cb297-65"><a href="mc_standdr.html#cb297-65" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">glm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb297-66"><a href="mc_standdr.html#cb297-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-67"><a href="mc_standdr.html#cb297-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the weights</span></span>
<span id="cb297-68"><a href="mc_standdr.html#cb297-68" aria-hidden="true" tabindex="-1"></a>  w0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e)</span>
<span id="cb297-69"><a href="mc_standdr.html#cb297-69" aria-hidden="true" tabindex="-1"></a>  w1 <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">/</span> e</span>
<span id="cb297-70"><a href="mc_standdr.html#cb297-70" aria-hidden="true" tabindex="-1"></a>  w02 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e2)</span>
<span id="cb297-71"><a href="mc_standdr.html#cb297-71" aria-hidden="true" tabindex="-1"></a>  w12 <span class="ot">&lt;-</span> T <span class="sc">/</span> e2</span>
<span id="cb297-72"><a href="mc_standdr.html#cb297-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-73"><a href="mc_standdr.html#cb297-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit an overspecified (saturated) outcome model</span></span>
<span id="cb297-74"><a href="mc_standdr.html#cb297-74" aria-hidden="true" tabindex="-1"></a>  mod.out <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">*</span> H)</span>
<span id="cb297-75"><a href="mc_standdr.html#cb297-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-76"><a href="mc_standdr.html#cb297-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate the expected potential outcomes using the various methods</span></span>
<span id="cb297-77"><a href="mc_standdr.html#cb297-77" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Y&quot;</span> <span class="ot">=</span> Y, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb297-78"><a href="mc_standdr.html#cb297-78" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> dat</span>
<span id="cb297-79"><a href="mc_standdr.html#cb297-79" aria-hidden="true" tabindex="-1"></a>  dat0<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb297-80"><a href="mc_standdr.html#cb297-80" aria-hidden="true" tabindex="-1"></a>  dat1 <span class="ot">&lt;-</span> dat</span>
<span id="cb297-81"><a href="mc_standdr.html#cb297-81" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb297-82"><a href="mc_standdr.html#cb297-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-83"><a href="mc_standdr.html#cb297-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the predicted data</span></span>
<span id="cb297-84"><a href="mc_standdr.html#cb297-84" aria-hidden="true" tabindex="-1"></a>  preds0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat0)</span>
<span id="cb297-85"><a href="mc_standdr.html#cb297-85" aria-hidden="true" tabindex="-1"></a>  preds1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat1)</span>
<span id="cb297-86"><a href="mc_standdr.html#cb297-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-87"><a href="mc_standdr.html#cb297-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the estimates</span></span>
<span id="cb297-88"><a href="mc_standdr.html#cb297-88" aria-hidden="true" tabindex="-1"></a>  EY0out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds0)</span>
<span id="cb297-89"><a href="mc_standdr.html#cb297-89" aria-hidden="true" tabindex="-1"></a>  EY1out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds1)</span>
<span id="cb297-90"><a href="mc_standdr.html#cb297-90" aria-hidden="true" tabindex="-1"></a>  EY0exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w0)</span>
<span id="cb297-91"><a href="mc_standdr.html#cb297-91" aria-hidden="true" tabindex="-1"></a>  EY1exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w1)</span>
<span id="cb297-92"><a href="mc_standdr.html#cb297-92" aria-hidden="true" tabindex="-1"></a>  EY0exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w02)</span>
<span id="cb297-93"><a href="mc_standdr.html#cb297-93" aria-hidden="true" tabindex="-1"></a>  EY1exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w12)</span>
<span id="cb297-94"><a href="mc_standdr.html#cb297-94" aria-hidden="true" tabindex="-1"></a>  EY0dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w0 <span class="sc">*</span> Y <span class="sc">+</span> preds0 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e))</span>
<span id="cb297-95"><a href="mc_standdr.html#cb297-95" aria-hidden="true" tabindex="-1"></a>  EY1dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w1 <span class="sc">*</span> Y <span class="sc">-</span> preds1 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> e)</span>
<span id="cb297-96"><a href="mc_standdr.html#cb297-96" aria-hidden="true" tabindex="-1"></a>  EYT0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb297-97"><a href="mc_standdr.html#cb297-97" aria-hidden="true" tabindex="-1"></a>  EYT1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb297-98"><a href="mc_standdr.html#cb297-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-99"><a href="mc_standdr.html#cb297-99" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb297-100"><a href="mc_standdr.html#cb297-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0out&quot;</span> <span class="ot">=</span> EY0out,</span>
<span id="cb297-101"><a href="mc_standdr.html#cb297-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1out&quot;</span> <span class="ot">=</span> EY1out,</span>
<span id="cb297-102"><a href="mc_standdr.html#cb297-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0exp&quot;</span> <span class="ot">=</span> EY0exp,</span>
<span id="cb297-103"><a href="mc_standdr.html#cb297-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1exp&quot;</span> <span class="ot">=</span> EY1exp,</span>
<span id="cb297-104"><a href="mc_standdr.html#cb297-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0exp2&quot;</span> <span class="ot">=</span> EY0exp2,</span>
<span id="cb297-105"><a href="mc_standdr.html#cb297-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1exp2&quot;</span> <span class="ot">=</span> EY1exp2,</span>
<span id="cb297-106"><a href="mc_standdr.html#cb297-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY0dr&quot;</span> <span class="ot">=</span> EY0dr,</span>
<span id="cb297-107"><a href="mc_standdr.html#cb297-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EY1dr&quot;</span> <span class="ot">=</span> EY1dr,</span>
<span id="cb297-108"><a href="mc_standdr.html#cb297-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> EYT0,</span>
<span id="cb297-109"><a href="mc_standdr.html#cb297-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> EYT1)</span>
<span id="cb297-110"><a href="mc_standdr.html#cb297-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb297-111"><a href="mc_standdr.html#cb297-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (out_choice <span class="sc">==</span> <span class="st">&quot;all&quot;</span>) {</span>
<span id="cb297-112"><a href="mc_standdr.html#cb297-112" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">append</span>(sim, est)</span>
<span id="cb297-113"><a href="mc_standdr.html#cb297-113" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;sim&quot;</span>) {</span>
<span id="cb297-114"><a href="mc_standdr.html#cb297-114" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> sim</span>
<span id="cb297-115"><a href="mc_standdr.html#cb297-115" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(out_choice <span class="sc">==</span> <span class="st">&quot;est&quot;</span>) {</span>
<span id="cb297-116"><a href="mc_standdr.html#cb297-116" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> est</span>
<span id="cb297-117"><a href="mc_standdr.html#cb297-117" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb297-118"><a href="mc_standdr.html#cb297-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s is an invalid out_choice&quot;</span>, out_choice))</span>
<span id="cb297-119"><a href="mc_standdr.html#cb297-119" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb297-120"><a href="mc_standdr.html#cb297-120" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb297-121"><a href="mc_standdr.html#cb297-121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb297-122"><a href="mc_standdr.html#cb297-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-123"><a href="mc_standdr.html#cb297-123" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Compute statistics from \code{simdr}. Sames as \code{standdr_est}</span></span>
<span id="cb297-124"><a href="mc_standdr.html#cb297-124" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-125"><a href="mc_standdr.html#cb297-125" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Vector of numeric values.</span></span>
<span id="cb297-126"><a href="mc_standdr.html#cb297-126" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-127"><a href="mc_standdr.html#cb297-127" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of statistics: \code{sun(x), mean(x), min(x), max(x)}.</span></span>
<span id="cb297-128"><a href="mc_standdr.html#cb297-128" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb297-129"><a href="mc_standdr.html#cb297-129" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @seealso standdr_stats</span></span>
<span id="cb297-130"><a href="mc_standdr.html#cb297-130" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb297-131"><a href="mc_standdr.html#cb297-131" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb297-132"><a href="mc_standdr.html#cb297-132" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; simdr_stats(runif(20))</span></span>
<span id="cb297-133"><a href="mc_standdr.html#cb297-133" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb297-134"><a href="mc_standdr.html#cb297-134" aria-hidden="true" tabindex="-1"></a>simdr_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb297-135"><a href="mc_standdr.html#cb297-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;sum&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(x), <span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(x), <span class="st">&quot;min&quot;</span> <span class="ot">=</span> <span class="fu">min</span>(x), <span class="st">&quot;max&quot;</span> <span class="ot">=</span> <span class="fu">max</span>(x))</span>
<span id="cb297-136"><a href="mc_standdr.html#cb297-136" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mc_standdr-1" class="section level3" number="10.4.2">
<h3><span class="header-section-number">D.4.2</span> <code>mc_standdr</code></h3>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="mc_standdr.html#cb298-1" aria-hidden="true" tabindex="-1"></a>mc_standdr <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb298-2"><a href="mc_standdr.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-3"><a href="mc_standdr.html#cb298-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-4"><a href="mc_standdr.html#cb298-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-5"><a href="mc_standdr.html#cb298-5" aria-hidden="true" tabindex="-1"></a>standdr_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">3000</span>, <span class="at">ss =</span> <span class="dv">100</span>, <span class="at">beta =</span> <span class="fl">0.13</span>, <span class="at">gamma =</span> <span class="dv">20</span>, </span>
<span id="cb298-6"><a href="mc_standdr.html#cb298-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probH =</span> <span class="fl">0.05</span>, <span class="at">seed =</span> <span class="cn">NULL</span>) {</span>
<span id="cb298-7"><a href="mc_standdr.html#cb298-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb298-8"><a href="mc_standdr.html#cb298-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-9"><a href="mc_standdr.html#cb298-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># matrix of independent Bernoulli vector with prob = 0.05</span></span>
<span id="cb298-10"><a href="mc_standdr.html#cb298-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;The columns of H were independent indicator variables each</span></span>
<span id="cb298-11"><a href="mc_standdr.html#cb298-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  with probability 0.05&quot;</span></span>
<span id="cb298-12"><a href="mc_standdr.html#cb298-12" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">replicate</span>(<span class="at">n =</span> ss, <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probH)))</span>
<span id="cb298-13"><a href="mc_standdr.html#cb298-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-14"><a href="mc_standdr.html#cb298-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the treatment depend on a function of H</span></span>
<span id="cb298-15"><a href="mc_standdr.html#cb298-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;We simulated T  as indicator variables with probabilities that varied as</span></span>
<span id="cb298-16"><a href="mc_standdr.html#cb298-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a linear function  of H such that approximately 600 individuals had T=1&quot;</span></span>
<span id="cb298-17"><a href="mc_standdr.html#cb298-17" aria-hidden="true" tabindex="-1"></a>  sumH <span class="ot">&lt;-</span> <span class="fu">apply</span>(H, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> sum) <span class="sc">*</span> gamma <span class="sc">/</span> ss</span>
<span id="cb298-18"><a href="mc_standdr.html#cb298-18" aria-hidden="true" tabindex="-1"></a>  probT <span class="ot">&lt;-</span> beta <span class="sc">*</span> sumH <span class="sc">+</span> probH <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb298-19"><a href="mc_standdr.html#cb298-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(T=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb298-20"><a href="mc_standdr.html#cb298-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(probT <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="fu">all</span>(probT <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb298-21"><a href="mc_standdr.html#cb298-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probT)</span>
<span id="cb298-22"><a href="mc_standdr.html#cb298-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-23"><a href="mc_standdr.html#cb298-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-24"><a href="mc_standdr.html#cb298-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the outcome depend on T and H</span></span>
<span id="cb298-25"><a href="mc_standdr.html#cb298-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &quot;We simulated Y as a function T ans sumH such hat approximatey 35 </span></span>
<span id="cb298-26"><a href="mc_standdr.html#cb298-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># individuals had Y = 1&quot;</span></span>
<span id="cb298-27"><a href="mc_standdr.html#cb298-27" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> sumH</span>
<span id="cb298-28"><a href="mc_standdr.html#cb298-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure P(Y=1) is between 0 and 1, i.e. positivity assumption</span></span>
<span id="cb298-29"><a href="mc_standdr.html#cb298-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">NOTE</span><span class="co"> ON ASSUMPTION:</span></span>
<span id="cb298-30"><a href="mc_standdr.html#cb298-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># positivity assumtion not met because we need probY &gt;= 0</span></span>
<span id="cb298-31"><a href="mc_standdr.html#cb298-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(probY <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="fu">all</span>(probY <span class="sc">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb298-32"><a href="mc_standdr.html#cb298-32" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n =</span> n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb298-33"><a href="mc_standdr.html#cb298-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-34"><a href="mc_standdr.html#cb298-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output results in a list</span></span>
<span id="cb298-35"><a href="mc_standdr.html#cb298-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;sumH&quot;</span> <span class="ot">=</span> <span class="fu">standdr_stats</span>(sumH),</span>
<span id="cb298-36"><a href="mc_standdr.html#cb298-36" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;probT&quot;</span> <span class="ot">=</span> <span class="fu">standdr_stats</span>(probT),</span>
<span id="cb298-37"><a href="mc_standdr.html#cb298-37" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="fu">standdr_stats</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>),</span>
<span id="cb298-38"><a href="mc_standdr.html#cb298-38" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;probY&quot;</span> <span class="ot">=</span> <span class="fu">standdr_stats</span>(probY),</span>
<span id="cb298-39"><a href="mc_standdr.html#cb298-39" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="fu">standdr_stats</span>(Y))</span>
<span id="cb298-40"><a href="mc_standdr.html#cb298-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-41"><a href="mc_standdr.html#cb298-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-42"><a href="mc_standdr.html#cb298-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-43"><a href="mc_standdr.html#cb298-43" aria-hidden="true" tabindex="-1"></a>standdr_est <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, <span class="st">`</span><span class="at">T</span><span class="st">`</span>, H) {</span>
<span id="cb298-44"><a href="mc_standdr.html#cb298-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-45"><a href="mc_standdr.html#cb298-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit the exposure model</span></span>
<span id="cb298-46"><a href="mc_standdr.html#cb298-46" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="fu">lm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H))</span>
<span id="cb298-47"><a href="mc_standdr.html#cb298-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-48"><a href="mc_standdr.html#cb298-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the exposure model using an incorrect logistic model</span></span>
<span id="cb298-49"><a href="mc_standdr.html#cb298-49" aria-hidden="true" tabindex="-1"></a>  e2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">glm</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">~</span> H, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>), <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb298-50"><a href="mc_standdr.html#cb298-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-51"><a href="mc_standdr.html#cb298-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the weights</span></span>
<span id="cb298-52"><a href="mc_standdr.html#cb298-52" aria-hidden="true" tabindex="-1"></a>  w0 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e)</span>
<span id="cb298-53"><a href="mc_standdr.html#cb298-53" aria-hidden="true" tabindex="-1"></a>  w1 <span class="ot">&lt;-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">/</span> e</span>
<span id="cb298-54"><a href="mc_standdr.html#cb298-54" aria-hidden="true" tabindex="-1"></a>  w02 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e2)</span>
<span id="cb298-55"><a href="mc_standdr.html#cb298-55" aria-hidden="true" tabindex="-1"></a>  w12 <span class="ot">&lt;-</span> T <span class="sc">/</span> e2</span>
<span id="cb298-56"><a href="mc_standdr.html#cb298-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-57"><a href="mc_standdr.html#cb298-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit an overspecified (saturated) outcome model</span></span>
<span id="cb298-58"><a href="mc_standdr.html#cb298-58" aria-hidden="true" tabindex="-1"></a>  mod.out <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">*</span> H)</span>
<span id="cb298-59"><a href="mc_standdr.html#cb298-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-60"><a href="mc_standdr.html#cb298-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate the expected potential outcomes using the various methods</span></span>
<span id="cb298-61"><a href="mc_standdr.html#cb298-61" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;Y&quot;</span> <span class="ot">=</span> Y, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb298-62"><a href="mc_standdr.html#cb298-62" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> dat</span>
<span id="cb298-63"><a href="mc_standdr.html#cb298-63" aria-hidden="true" tabindex="-1"></a>  dat0<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb298-64"><a href="mc_standdr.html#cb298-64" aria-hidden="true" tabindex="-1"></a>  dat1 <span class="ot">&lt;-</span> dat</span>
<span id="cb298-65"><a href="mc_standdr.html#cb298-65" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span><span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb298-66"><a href="mc_standdr.html#cb298-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-67"><a href="mc_standdr.html#cb298-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the predicted data</span></span>
<span id="cb298-68"><a href="mc_standdr.html#cb298-68" aria-hidden="true" tabindex="-1"></a>  preds0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat0)</span>
<span id="cb298-69"><a href="mc_standdr.html#cb298-69" aria-hidden="true" tabindex="-1"></a>  preds1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod.out, <span class="at">newdata =</span> dat1)</span>
<span id="cb298-70"><a href="mc_standdr.html#cb298-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-71"><a href="mc_standdr.html#cb298-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the estimates</span></span>
<span id="cb298-72"><a href="mc_standdr.html#cb298-72" aria-hidden="true" tabindex="-1"></a>  EY0out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds0)</span>
<span id="cb298-73"><a href="mc_standdr.html#cb298-73" aria-hidden="true" tabindex="-1"></a>  EY1out <span class="ot">&lt;-</span> <span class="fu">mean</span>(preds1)</span>
<span id="cb298-74"><a href="mc_standdr.html#cb298-74" aria-hidden="true" tabindex="-1"></a>  EY0exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w0)</span>
<span id="cb298-75"><a href="mc_standdr.html#cb298-75" aria-hidden="true" tabindex="-1"></a>  EY1exp <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w1)</span>
<span id="cb298-76"><a href="mc_standdr.html#cb298-76" aria-hidden="true" tabindex="-1"></a>  EY0exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w02)</span>
<span id="cb298-77"><a href="mc_standdr.html#cb298-77" aria-hidden="true" tabindex="-1"></a>  EY1exp2 <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(Y, <span class="at">w =</span> w12)</span>
<span id="cb298-78"><a href="mc_standdr.html#cb298-78" aria-hidden="true" tabindex="-1"></a>  EY0dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w0 <span class="sc">*</span> Y <span class="sc">+</span> preds0 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> e))</span>
<span id="cb298-79"><a href="mc_standdr.html#cb298-79" aria-hidden="true" tabindex="-1"></a>  EY1dr <span class="ot">&lt;-</span> <span class="fu">mean</span>(w1 <span class="sc">*</span> Y <span class="sc">-</span> preds1 <span class="sc">*</span> (<span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">-</span> e) <span class="sc">/</span> e)</span>
<span id="cb298-80"><a href="mc_standdr.html#cb298-80" aria-hidden="true" tabindex="-1"></a>  EYT0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>))</span>
<span id="cb298-81"><a href="mc_standdr.html#cb298-81" aria-hidden="true" tabindex="-1"></a>  EYT1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y <span class="sc">*</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>)</span>
<span id="cb298-82"><a href="mc_standdr.html#cb298-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb298-83"><a href="mc_standdr.html#cb298-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;EY0out&quot;</span> <span class="ot">=</span> EY0out,</span>
<span id="cb298-84"><a href="mc_standdr.html#cb298-84" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1out&quot;</span> <span class="ot">=</span> EY1out,</span>
<span id="cb298-85"><a href="mc_standdr.html#cb298-85" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0exp&quot;</span> <span class="ot">=</span> EY0exp,</span>
<span id="cb298-86"><a href="mc_standdr.html#cb298-86" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1exp&quot;</span> <span class="ot">=</span> EY1exp,</span>
<span id="cb298-87"><a href="mc_standdr.html#cb298-87" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0exp2&quot;</span> <span class="ot">=</span> EY0exp2,</span>
<span id="cb298-88"><a href="mc_standdr.html#cb298-88" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1exp2&quot;</span> <span class="ot">=</span> EY1exp2,</span>
<span id="cb298-89"><a href="mc_standdr.html#cb298-89" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY0dr&quot;</span> <span class="ot">=</span> EY0dr,</span>
<span id="cb298-90"><a href="mc_standdr.html#cb298-90" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EY1dr&quot;</span> <span class="ot">=</span> EY1dr,</span>
<span id="cb298-91"><a href="mc_standdr.html#cb298-91" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EYT0&quot;</span> <span class="ot">=</span> EYT0,</span>
<span id="cb298-92"><a href="mc_standdr.html#cb298-92" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;EYT1&quot;</span> <span class="ot">=</span> EYT1)</span>
<span id="cb298-93"><a href="mc_standdr.html#cb298-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-94"><a href="mc_standdr.html#cb298-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-95"><a href="mc_standdr.html#cb298-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Compute statistics from \code{standdr_sim}.</span></span>
<span id="cb298-96"><a href="mc_standdr.html#cb298-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-97"><a href="mc_standdr.html#cb298-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x Vector of numeric values.</span></span>
<span id="cb298-98"><a href="mc_standdr.html#cb298-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-99"><a href="mc_standdr.html#cb298-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of statistics: \code{sun(x), mean(x), min(x), max(x)}.</span></span>
<span id="cb298-100"><a href="mc_standdr.html#cb298-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb298-101"><a href="mc_standdr.html#cb298-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb298-102"><a href="mc_standdr.html#cb298-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; standdr_est(runif(20))</span></span>
<span id="cb298-103"><a href="mc_standdr.html#cb298-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb298-104"><a href="mc_standdr.html#cb298-104" aria-hidden="true" tabindex="-1"></a>standdr_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb298-105"><a href="mc_standdr.html#cb298-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;sum&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(x), <span class="st">&quot;mean&quot;</span> <span class="ot">=</span> <span class="fu">mean</span>(x), <span class="st">&quot;min&quot;</span> <span class="ot">=</span> <span class="fu">min</span>(x), <span class="st">&quot;max&quot;</span> <span class="ot">=</span> <span class="fu">max</span>(x))</span>
<span id="cb298-106"><a href="mc_standdr.html#cb298-106" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/94-simdr.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 2
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
