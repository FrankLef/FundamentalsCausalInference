<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Causal Directed Acyclic Graphs | Study project: Fundamentals of Causal Inferences With R</title>
  <meta name="description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Causal Directed Acyclic Graphs | Study project: Fundamentals of Causal Inferences With R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Causal Directed Acyclic Graphs | Study project: Fundamentals of Causal Inferences With R" />
  
  <meta name="twitter:description" content="<p>This is a study project of Fundamentals of Causal Inferences by Babette A.
Brumback. It goes through a lot of the codes and through many mathematical
arguments for better learning. All exercises are attempted.</p>" />
  

<meta name="author" content="FranÃ§ois Lefebvre" />


<meta name="date" content="2022-02-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="measures.html"/>
<link rel="next" href="backdoor.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Study Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Study Project</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>I Part I</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-brief-history"><i class="fa fa-check"></i><b>1.1</b> A Brief History</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#data-examples"><i class="fa fa-check"></i><b>1.2</b> Data Examples</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#mortality-rates-by-country"><i class="fa fa-check"></i><b>1.2.1</b> Mortality Rates by Country</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#national-center-for-education-statistics"><i class="fa fa-check"></i><b>1.2.2</b> National Center for Education Statistics</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#reducing-alcohol-consumption"><i class="fa fa-check"></i><b>1.2.3</b> Reducing Alcohol Consumption</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#general-social-survey"><i class="fa fa-check"></i><b>1.2.4</b> General Social Survey</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#a-cancer-clinical-trial"><i class="fa fa-check"></i><b>1.2.5</b> A Cancer Clinical Trial</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#exercise-1"><i class="fa fa-check"></i><b>1.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#exercise-2"><i class="fa fa-check"></i><b>1.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#exercise-3"><i class="fa fa-check"></i><b>1.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#exercise-4"><i class="fa fa-check"></i><b>1.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#exercise-5"><i class="fa fa-check"></i><b>1.3.5</b> Exercise 5</a></li>
<li class="chapter" data-level="1.3.6" data-path="intro.html"><a href="intro.html#exercise-6"><i class="fa fa-check"></i><b>1.3.6</b> Exercise 6</a></li>
<li class="chapter" data-level="1.3.7" data-path="intro.html"><a href="intro.html#exercise-7"><i class="fa fa-check"></i><b>1.3.7</b> Exercise 7</a></li>
<li class="chapter" data-level="1.3.8" data-path="intro.html"><a href="intro.html#exercise-8"><i class="fa fa-check"></i><b>1.3.8</b> Exercise 8</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>2</b> Conditional Probability and Expectation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>2.1</b> Conditional Probability</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="probability.html"><a href="probability.html#law-of-total-probability"><i class="fa fa-check"></i><b>2.1.1</b> Law of total probability</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability.html"><a href="probability.html#conditional-expectation-and-he-law-of-total-expectation"><i class="fa fa-check"></i><b>2.2</b> Conditional Expectation and he Law of Total expectation</a></li>
<li class="chapter" data-level="2.3" data-path="probability.html"><a href="probability.html#estimation"><i class="fa fa-check"></i><b>2.3</b> Estimation</a></li>
<li class="chapter" data-level="2.4" data-path="probability.html"><a href="probability.html#sampling-distributions-and-the-bootstrap"><i class="fa fa-check"></i><b>2.4</b> Sampling Distributions and the Bootstrap</a></li>
<li class="chapter" data-level="2.5" data-path="probability.html"><a href="probability.html#exercises-1"><i class="fa fa-check"></i><b>2.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="probability.html"><a href="probability.html#exercise-1-1"><i class="fa fa-check"></i><b>2.5.1</b> Exercise 1</a></li>
<li class="chapter" data-level="2.5.2" data-path="probability.html"><a href="probability.html#exercise-2-1"><i class="fa fa-check"></i><b>2.5.2</b> Exercise 2</a></li>
<li class="chapter" data-level="2.5.3" data-path="probability.html"><a href="probability.html#exercise-3-1"><i class="fa fa-check"></i><b>2.5.3</b> Exercise 3</a></li>
<li class="chapter" data-level="2.5.4" data-path="probability.html"><a href="probability.html#exercise-4-1"><i class="fa fa-check"></i><b>2.5.4</b> Exercise 4</a></li>
<li class="chapter" data-level="2.5.5" data-path="probability.html"><a href="probability.html#exercise-5-1"><i class="fa fa-check"></i><b>2.5.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="outcomes.html"><a href="outcomes.html"><i class="fa fa-check"></i><b>3</b> Potential Outcomes and the Fundamental Problem of Causal Inference</a>
<ul>
<li class="chapter" data-level="3.1" data-path="outcomes.html"><a href="outcomes.html#potential-outcomes-and-the-consistency-assumption"><i class="fa fa-check"></i><b>3.1</b> Potential Outcomes and the Consistency Assumption</a></li>
<li class="chapter" data-level="3.2" data-path="outcomes.html"><a href="outcomes.html#circumventing-the-fundamental-problem-of-causal-inference"><i class="fa fa-check"></i><b>3.2</b> Circumventing the Fundamental Problem of Causal Inference</a></li>
<li class="chapter" data-level="3.3" data-path="outcomes.html"><a href="outcomes.html#effect-measures"><i class="fa fa-check"></i><b>3.3</b> Effect Measures</a></li>
<li class="chapter" data-level="3.4" data-path="outcomes.html"><a href="outcomes.html#exercises-2"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="outcomes.html"><a href="outcomes.html#exercise-1-2"><i class="fa fa-check"></i><b>3.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="3.4.2" data-path="outcomes.html"><a href="outcomes.html#exercise-2-2"><i class="fa fa-check"></i><b>3.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="3.4.3" data-path="outcomes.html"><a href="outcomes.html#exercise-3-2"><i class="fa fa-check"></i><b>3.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="3.4.4" data-path="outcomes.html"><a href="outcomes.html#exercise-4-2"><i class="fa fa-check"></i><b>3.4.4</b> Exercise 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="measures.html"><a href="measures.html"><i class="fa fa-check"></i><b>4</b> Effect-Measure Modification and Causal Interaction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="measures.html"><a href="measures.html#effect-measure-modification-and-statistical-interaction"><i class="fa fa-check"></i><b>4.1</b> Effect-Measure Modification and Statistical Interaction</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="measures.html"><a href="measures.html#recovery-trial"><i class="fa fa-check"></i><b>4.1.1</b> RECOVERY trial</a></li>
<li class="chapter" data-level="4.1.2" data-path="measures.html"><a href="measures.html#nces"><i class="fa fa-check"></i><b>4.1.2</b> NCES</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="measures.html"><a href="measures.html#qualitative-agreement-of-effect-measures-in-modification"><i class="fa fa-check"></i><b>4.2</b> Qualitative Agreement of Effect Measures in Modification</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="measures.html"><a href="measures.html#algorithm"><i class="fa fa-check"></i><b>4.2.1</b> Algorithm</a></li>
<li class="chapter" data-level="4.2.2" data-path="measures.html"><a href="measures.html#simulate-the-effect-measures"><i class="fa fa-check"></i><b>4.2.2</b> Simulate the effect measures</a></li>
<li class="chapter" data-level="4.2.3" data-path="measures.html"><a href="measures.html#applications"><i class="fa fa-check"></i><b>4.2.3</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="measures.html"><a href="measures.html#causal-interaction"><i class="fa fa-check"></i><b>4.3</b> Causal Interaction</a></li>
<li class="chapter" data-level="4.4" data-path="measures.html"><a href="measures.html#exercises-3"><i class="fa fa-check"></i><b>4.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="measures.html"><a href="measures.html#exercise-1-3"><i class="fa fa-check"></i><b>4.4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="measures.html"><a href="measures.html#exercise-2-3"><i class="fa fa-check"></i><b>4.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="measures.html"><a href="measures.html#exercise-3-3"><i class="fa fa-check"></i><b>4.4.3</b> Exercise 3</a></li>
<li class="chapter" data-level="4.4.4" data-path="measures.html"><a href="measures.html#exercise-4-3"><i class="fa fa-check"></i><b>4.4.4</b> Exercise 4</a></li>
<li class="chapter" data-level="4.4.5" data-path="measures.html"><a href="measures.html#exercise-5-2"><i class="fa fa-check"></i><b>4.4.5</b> Exercise 5</a></li>
<li class="chapter" data-level="4.4.6" data-path="measures.html"><a href="measures.html#exercise-6-1"><i class="fa fa-check"></i><b>4.4.6</b> Exercise 6</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II</b></span></li>
<li class="chapter" data-level="5" data-path="dag.html"><a href="dag.html"><i class="fa fa-check"></i><b>5</b> Causal Directed Acyclic Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dag.html"><a href="dag.html#theory"><i class="fa fa-check"></i><b>5.1</b> Theory</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dag.html"><a href="dag.html#conditional-indepence-and-dag"><i class="fa fa-check"></i><b>5.1.1</b> Conditional Indepence and DAG</a></li>
<li class="chapter" data-level="5.1.2" data-path="dag.html"><a href="dag.html#d-separation"><i class="fa fa-check"></i><b>5.1.2</b> D-Separation</a></li>
<li class="chapter" data-level="5.1.3" data-path="dag.html"><a href="dag.html#causal-dag-with-collider"><i class="fa fa-check"></i><b>5.1.3</b> Causal DAG with collider</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dag.html"><a href="dag.html#examples"><i class="fa fa-check"></i><b>5.2</b> Examples</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="dag.html"><a href="dag.html#causal-dag-with-intermediate-value"><i class="fa fa-check"></i><b>5.2.1</b> Causal DAG With Intermediate Value</a></li>
<li class="chapter" data-level="5.2.2" data-path="dag.html"><a href="dag.html#a-counfounder-may-occur-after-the-exposure"><i class="fa fa-check"></i><b>5.2.2</b> A counfounder may occur after the exposure</a></li>
<li class="chapter" data-level="5.2.3" data-path="dag.html"><a href="dag.html#potential-outcomes-are-the-ultimate-counfounder"><i class="fa fa-check"></i><b>5.2.3</b> Potential Outcomes are the Ultimate Counfounder</a></li>
<li class="chapter" data-level="5.2.4" data-path="dag.html"><a href="dag.html#structural-causal-model-5.7"><i class="fa fa-check"></i><b>5.2.4</b> Structural Causal Model 5.7</a></li>
<li class="chapter" data-level="5.2.5" data-path="dag.html"><a href="dag.html#potential-outcomes-behind-the-scenes"><i class="fa fa-check"></i><b>5.2.5</b> Potential Outcomes Behind the Scenes</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dag.html"><a href="dag.html#exercises-4"><i class="fa fa-check"></i><b>5.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="dag.html"><a href="dag.html#exercise-1-4"><i class="fa fa-check"></i><b>5.3.1</b> Exercise 1</a></li>
<li class="chapter" data-level="5.3.2" data-path="dag.html"><a href="dag.html#exercise-2-4"><i class="fa fa-check"></i><b>5.3.2</b> Exercise 2</a></li>
<li class="chapter" data-level="5.3.3" data-path="dag.html"><a href="dag.html#exercise-3-4"><i class="fa fa-check"></i><b>5.3.3</b> Exercise 3</a></li>
<li class="chapter" data-level="5.3.4" data-path="dag.html"><a href="dag.html#exercise-4-4"><i class="fa fa-check"></i><b>5.3.4</b> Exercise 4</a></li>
<li class="chapter" data-level="5.3.5" data-path="dag.html"><a href="dag.html#exercise-5-3"><i class="fa fa-check"></i><b>5.3.5</b> Exercise 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="backdoor.html"><a href="backdoor.html"><i class="fa fa-check"></i><b>6</b> Backdoor Method via Standardization</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="Errata.html"><a href="Errata.html"><i class="fa fa-check"></i><b>A</b> Errata</a>
<ul>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-1"><i class="fa fa-check"></i>Chapter 1</a>
<ul>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#section-1.2.3.2-p.-11"><i class="fa fa-check"></i>Section 1.2.3.2, p.Â 11</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-2"><i class="fa fa-check"></i>Chapter 2</a>
<ul>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#figure-2.1-p.-30"><i class="fa fa-check"></i>Figure 2.1, p.Â 30</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-3"><i class="fa fa-check"></i>Chapter 3</a>
<ul>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#typography-section-3.2-p.-40-equation-3.1"><i class="fa fa-check"></i>Typography: section 3.2 p.Â 40, equation 3.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-4"><i class="fa fa-check"></i>Chapter 4</a>
<ul>
<li class="chapter" data-level="A.0.1" data-path="Errata.html"><a href="Errata.html#section-4.1-p.-67-on-top"><i class="fa fa-check"></i><b>A.0.1</b> Section 4.1 p.Â 67 (on top)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-5"><i class="fa fa-check"></i>Chapter 5</a></li>
<li class="chapter" data-level="" data-path="Errata.html"><a href="Errata.html#chapter-6"><i class="fa fa-check"></i>Chapter 6</a>
<ul>
<li class="chapter" data-level="A.0.2" data-path="Errata.html"><a href="Errata.html#section-6.1-p.-100-first-paragraph"><i class="fa fa-check"></i><b>A.0.2</b> Section 6.1 p.Â 100, first paragraph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="Comments.html"><a href="Comments.html"><i class="fa fa-check"></i><b>B</b> Comments</a>
<ul>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#chapter-2-1"><i class="fa fa-check"></i>Chapter 2</a>
<ul>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#section-2.4-p.-31"><i class="fa fa-check"></i>section 2.4 p.Â 31</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#chapter-4-1"><i class="fa fa-check"></i>Chapter 4</a>
<ul>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#section-4.1"><i class="fa fa-check"></i>Section 4.1</a></li>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#section-4.2"><i class="fa fa-check"></i>Section 4.2</a></li>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#exercises-5"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#chapter-5-1"><i class="fa fa-check"></i>Chapter 5</a>
<ul>
<li class="chapter" data-level="" data-path="Comments.html"><a href="Comments.html#exercises-6"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>C</b> Functions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Study project: Fundamentals of Causal Inferences With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dag" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Causal Directed Acyclic Graphs</h1>
<p>We use the <code>dagitty</code> and <code>ggdag</code> packages to analyse the DAG and plot them.
We also sue the <code>simstudy</code> package from now on to perform the simulations.</p>
<div id="theory" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Theory</h2>
<div id="conditional-indepence-and-dag" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Conditional Indepence and DAG</h3>
<blockquote>
<p>Causal directed acyclic graphs provide a convenient and efficient way to
represent statistical ans causal dependence.</p>
</blockquote>
<p>For example</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="dag.html#cb183-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb183-2"><a href="dag.html#cb183-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.1</span>, {</span>
<span id="cb183-3"><a href="dag.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X1&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb183-4"><a href="dag.html#cb183-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;X2&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb183-5"><a href="dag.html#cb183-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;X3&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb183-6"><a href="dag.html#cb183-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;X4&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb183-7"><a href="dag.html#cb183-7" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb183-8"><a href="dag.html#cb183-8" aria-hidden="true" tabindex="-1"></a>    X2 <span class="sc">~</span> X1,</span>
<span id="cb183-9"><a href="dag.html#cb183-9" aria-hidden="true" tabindex="-1"></a>    X3 <span class="sc">~</span> X2,</span>
<span id="cb183-10"><a href="dag.html#cb183-10" aria-hidden="true" tabindex="-1"></a>    X4 <span class="sc">~</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb183-11"><a href="dag.html#cb183-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb183-12"><a href="dag.html#cb183-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-13"><a href="dag.html#cb183-13" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(X[<span class="dv">1</span>]), <span class="fu">expression</span>(X[<span class="dv">2</span>]),</span>
<span id="cb183-14"><a href="dag.html#cb183-14" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(X[<span class="dv">3</span>]), <span class="fu">expression</span>(X[<span class="dv">4</span>]))</span>
<span id="cb183-15"><a href="dag.html#cb183-15" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_labels =</span> text_labels)</span>
<span id="cb183-16"><a href="dag.html#cb183-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="dag.html#cb184-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.1</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-113"></span>
<img src="_main_files/figure-html/unnamed-chunk-113-1.png" alt="Example of a Directed Acyclic Graph" width="60%" />
<p class="caption">
Figure 5.1: Example of a Directed Acyclic Graph
</p>
</div>
<p>can be expressed in terms of conditional probabilities as</p>
<p><span class="math display">\[
\begin{align*}
P(X_1, X_2, X_3, X_4) = P(X_4 \mid X_2, X_1)P(X_3 \mid X_2)P(X_2 \mid X_1)P(X_1)
\end{align*}
\]</span></p>
</div>
<div id="d-separation" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> D-Separation</h3>
<blockquote>
<p>A path is said to be d-separated, or blocked,, by a set of variables <span class="math inline">\(C\)</span> if
and only if the path i) containis a <em>chain</em> as in figure 5.2a such that the
midlle variable <span class="math inline">\(Z\)</span> is in <span class="math inline">\(C\)</span> or ii) contains a <em>fork</em> as in figure 5.2b such
that such that the middle variable <span class="math inline">\(Z\)</span> is not in <span class="math inline">\(C\)</span> or iii) contains an inverted
fork, or <em>collider</em>, as in figure 5.2c such that the midlle variable <span class="math inline">\(Z\)</span> is not
in <span class="math inline">\(C\)</span> and such that no descendant of a collider is in <span class="math inline">\(C\)</span>.</p>
</blockquote>
<p>and we illustrate the 3 basic graphical structures as follows</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="dag.html#cb185-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb185-2"><a href="dag.html#cb185-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.2</span>, {</span>
<span id="cb185-3"><a href="dag.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-4"><a href="dag.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CHAIN</span></span>
<span id="cb185-5"><a href="dag.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  dagChain <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb185-6"><a href="dag.html#cb185-6" aria-hidden="true" tabindex="-1"></a>    Z <span class="sc">~</span> X1,</span>
<span id="cb185-7"><a href="dag.html#cb185-7" aria-hidden="true" tabindex="-1"></a>    X2 <span class="sc">~</span> Z)</span>
<span id="cb185-8"><a href="dag.html#cb185-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-9"><a href="dag.html#cb185-9" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(X[<span class="dv">1</span>]), <span class="fu">expression</span>(X[<span class="dv">2</span>]), <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb185-10"><a href="dag.html#cb185-10" aria-hidden="true" tabindex="-1"></a>  plotChain <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dagChain, <span class="at">text_size =</span> <span class="dv">5</span>, <span class="at">text_labels =</span> text_labels) <span class="sc">+</span></span>
<span id="cb185-11"><a href="dag.html#cb185-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb185-12"><a href="dag.html#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Chain: Z is an intermediate variable&quot;</span>)</span>
<span id="cb185-13"><a href="dag.html#cb185-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-14"><a href="dag.html#cb185-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-15"><a href="dag.html#cb185-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FORK</span></span>
<span id="cb185-16"><a href="dag.html#cb185-16" aria-hidden="true" tabindex="-1"></a>  dagFork <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb185-17"><a href="dag.html#cb185-17" aria-hidden="true" tabindex="-1"></a>    X1 <span class="sc">~</span> Z,</span>
<span id="cb185-18"><a href="dag.html#cb185-18" aria-hidden="true" tabindex="-1"></a>    X2 <span class="sc">~</span> Z)</span>
<span id="cb185-19"><a href="dag.html#cb185-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-20"><a href="dag.html#cb185-20" aria-hidden="true" tabindex="-1"></a>  plotFork <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dagFork, <span class="at">text_size =</span> <span class="dv">5</span>, <span class="at">text_labels =</span> text_labels) <span class="sc">+</span></span>
<span id="cb185-21"><a href="dag.html#cb185-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb185-22"><a href="dag.html#cb185-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Fork: Z is a common cause&quot;</span>)</span>
<span id="cb185-23"><a href="dag.html#cb185-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-24"><a href="dag.html#cb185-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-25"><a href="dag.html#cb185-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># COLLIDER</span></span>
<span id="cb185-26"><a href="dag.html#cb185-26" aria-hidden="true" tabindex="-1"></a>  dagColl <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb185-27"><a href="dag.html#cb185-27" aria-hidden="true" tabindex="-1"></a>    Z <span class="sc">~</span> X1,</span>
<span id="cb185-28"><a href="dag.html#cb185-28" aria-hidden="true" tabindex="-1"></a>    Z <span class="sc">~</span> X2)</span>
<span id="cb185-29"><a href="dag.html#cb185-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-30"><a href="dag.html#cb185-30" aria-hidden="true" tabindex="-1"></a>  plotColl <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dagColl, <span class="at">text_size =</span> <span class="dv">5</span>, <span class="at">text_labels =</span> text_labels) <span class="sc">+</span></span>
<span id="cb185-31"><a href="dag.html#cb185-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb185-32"><a href="dag.html#cb185-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Collider: Z is a common effect&quot;</span>)</span>
<span id="cb185-33"><a href="dag.html#cb185-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-34"><a href="dag.html#cb185-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-35"><a href="dag.html#cb185-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DESCENDANT</span></span>
<span id="cb185-36"><a href="dag.html#cb185-36" aria-hidden="true" tabindex="-1"></a>  dagDesc <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb185-37"><a href="dag.html#cb185-37" aria-hidden="true" tabindex="-1"></a>    W <span class="sc">~</span> X1,</span>
<span id="cb185-38"><a href="dag.html#cb185-38" aria-hidden="true" tabindex="-1"></a>    W <span class="sc">~</span> X2,</span>
<span id="cb185-39"><a href="dag.html#cb185-39" aria-hidden="true" tabindex="-1"></a>    Z <span class="sc">~</span> W)</span>
<span id="cb185-40"><a href="dag.html#cb185-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-41"><a href="dag.html#cb185-41" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(X[<span class="dv">1</span>]), <span class="fu">expression</span>(X[<span class="dv">2</span>]), <span class="fu">expression</span>(X[<span class="dv">3</span>]), <span class="st">&quot;Z&quot;</span>)</span>
<span id="cb185-42"><a href="dag.html#cb185-42" aria-hidden="true" tabindex="-1"></a>  plotDesc <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dagDesc, <span class="at">text_size =</span> <span class="dv">5</span>, <span class="at">text_labels =</span> text_labels) <span class="sc">+</span></span>
<span id="cb185-43"><a href="dag.html#cb185-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb185-44"><a href="dag.html#cb185-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Descendant: Z is an effect of a common effect&quot;</span>)</span>
<span id="cb185-45"><a href="dag.html#cb185-45" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="dag.html#cb186-1" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(scm_5<span class="fl">.2</span><span class="sc">$</span>plotChain, scm_5<span class="fl">.2</span><span class="sc">$</span>plotFork, scm_5<span class="fl">.2</span><span class="sc">$</span>plotColl, </span>
<span id="cb186-2"><a href="dag.html#cb186-2" aria-hidden="true" tabindex="-1"></a>                        scm_5<span class="fl">.2</span><span class="sc">$</span>plotDesc, </span>
<span id="cb186-3"><a href="dag.html#cb186-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-115"></span>
<img src="_main_files/figure-html/unnamed-chunk-115-1.png" alt="Graphical structures" width="672" />
<p class="caption">
Figure 5.2: Graphical structures
</p>
</div>
</div>
<div id="causal-dag-with-collider" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Causal DAG with collider</h3>
<p>and for our first practice of d-separation we have a DAG with a collider</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="dag.html#cb187-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb187-2"><a href="dag.html#cb187-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.3</span>, {</span>
<span id="cb187-3"><a href="dag.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb187-4"><a href="dag.html#cb187-4" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> W1,</span>
<span id="cb187-5"><a href="dag.html#cb187-5" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> W3,</span>
<span id="cb187-6"><a href="dag.html#cb187-6" aria-hidden="true" tabindex="-1"></a>    W2 <span class="sc">~</span> W1 <span class="sc">+</span> W3,</span>
<span id="cb187-7"><a href="dag.html#cb187-7" aria-hidden="true" tabindex="-1"></a>    W4 <span class="sc">~</span> W2)</span>
<span id="cb187-8"><a href="dag.html#cb187-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-9"><a href="dag.html#cb187-9" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(W[<span class="dv">1</span>]), <span class="fu">expression</span>(W[<span class="dv">2</span>]),</span>
<span id="cb187-10"><a href="dag.html#cb187-10" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(W[<span class="dv">3</span>]), <span class="fu">expression</span>(W[<span class="dv">4</span>], <span class="st">&quot;Y&quot;</span>))</span>
<span id="cb187-11"><a href="dag.html#cb187-11" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_labels =</span> text_labels)</span>
<span id="cb187-12"><a href="dag.html#cb187-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="dag.html#cb188-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.3</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-117"></span>
<img src="_main_files/figure-html/unnamed-chunk-117-1.png" alt="Causal DAG With Collider" width="60%" />
<p class="caption">
Figure 5.3: Causal DAG With Collider
</p>
</div>
<p>The conditional independences can be obtained using <code>impliedConditionalIndependencies</code>
from the<code>dagitty</code> package. You must ensure that you use the parameter
<code>type = "all.pairs</code> explicitly. The default is <code>type = "missing.edge</code>.
We will not list all of them, just their number, 93.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="dag.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use type = &quot;all.pairs&quot; to get everything.</span></span>
<span id="cb189-2"><a href="dag.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="co"># impliedConditionalIndependencies uses type &quot;missing.edge&quot; by default.</span></span>
<span id="cb189-3"><a href="dag.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">impliedConditionalIndependencies</span>(scm_5<span class="fl">.3</span><span class="sc">$</span>dag, <span class="at">type =</span> <span class="st">&quot;all.pairs&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 93</code></pre>
<p>some of those independence are</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="dag.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">impliedConditionalIndependencies</span>(scm_5<span class="fl">.3</span><span class="sc">$</span>dag, <span class="at">type =</span> <span class="st">&quot;missing.edge&quot;</span>)</span></code></pre></div>
<pre><code>## A _||_ W2 | W1
## A _||_ W3
## A _||_ W4 | W2
## A _||_ W4 | W1
## A _||_ Y
## W1 _||_ W3
## W1 _||_ W4 | W2
## W1 _||_ Y
## W2 _||_ Y | W3
## W3 _||_ W4 | W2
## W4 _||_ Y | W3
## W4 _||_ Y | W2</code></pre>
</div>
</div>
<div id="examples" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Examples</h2>
<div id="causal-dag-with-intermediate-value" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Causal DAG With Intermediate Value</h3>
<p>Here we have <span class="math inline">\(A \not\!\perp\!\!\!\perp Y \mid M\)</span> because <span class="math inline">\(M\)</span> is a collider and
conditioning on <span class="math inline">\(M\)</span> would open up the path.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="dag.html#cb193-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb193-2"><a href="dag.html#cb193-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.4</span>, {</span>
<span id="cb193-3"><a href="dag.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb193-4"><a href="dag.html#cb193-4" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> A <span class="sc">+</span> H,</span>
<span id="cb193-5"><a href="dag.html#cb193-5" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> M <span class="sc">+</span> H)</span>
<span id="cb193-6"><a href="dag.html#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="dag.html#cb193-7" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag)</span>
<span id="cb193-8"><a href="dag.html#cb193-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="dag.html#cb194-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.4</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-121"></span>
<img src="_main_files/figure-html/unnamed-chunk-121-1.png" alt="Causal DAG With Intermediate Variable" width="60%" />
<p class="caption">
Figure 5.4: Causal DAG With Intermediate Variable
</p>
</div>
</div>
<div id="a-counfounder-may-occur-after-the-exposure" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> A counfounder may occur after the exposure</h3>
<blockquote>
<p>Figure 5.5 illustrates and unmeasured true confounder <span class="math inline">\(U\)</span> of the effect of
<span class="math inline">\(A\)</span> on <span class="math inline">\(Y\)</span> that can be handled by conditioning on the measured variable <span class="math inline">\(Z\)</span>,
even if <span class="math inline">\(Z\)</span> <em>occur after</em> <span class="math inline">\(A\)</span>.</p>
</blockquote>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="dag.html#cb195-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb195-2"><a href="dag.html#cb195-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.5</span>, {</span>
<span id="cb195-3"><a href="dag.html#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="dag.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb195-5"><a href="dag.html#cb195-5" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> U,</span>
<span id="cb195-6"><a href="dag.html#cb195-6" aria-hidden="true" tabindex="-1"></a>    Z <span class="sc">~</span> U,</span>
<span id="cb195-7"><a href="dag.html#cb195-7" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> Z,</span>
<span id="cb195-8"><a href="dag.html#cb195-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">latent =</span> <span class="st">&quot;U&quot;</span>,</span>
<span id="cb195-9"><a href="dag.html#cb195-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb195-10"><a href="dag.html#cb195-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb195-11"><a href="dag.html#cb195-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb195-12"><a href="dag.html#cb195-12" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag)</span>
<span id="cb195-13"><a href="dag.html#cb195-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="dag.html#cb196-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.5</span><span class="sc">$</span>plot</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-123-1.png" width="672" /></p>
</div>
<div id="potential-outcomes-are-the-ultimate-counfounder" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Potential Outcomes are the Ultimate Counfounder</h3>
<blockquote>
<p>The collection of potential outcomes <span class="math inline">\(\{Y(a)\}_{a \in A}\)</span> can be viewed as the
ultimate confounder, even if it is not a tue confounder. The unmeasured
counfounder <span class="math inline">\(U = \{Y(a)\}_{a \in A}\)</span> will always block all backdoor paths
from <span class="math inline">\(A\)</span> to <span class="math inline">\(Y\)</span>, because <span class="math inline">\(Y\)</span> is a deterministic function of <span class="math inline">\(A\)</span> and <span class="math inline">\(\{Y(a)\}_{a \in A}\)</span>;
that is <span class="math inline">\(Y = Y(A)\)</span>, or, for binary <span class="math inline">\(Y\)</span>, <span class="math inline">\(Y = AY(1) + (1-A)Y(0)\)</span></p>
</blockquote>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="dag.html#cb197-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb197-2"><a href="dag.html#cb197-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.6</span>, {</span>
<span id="cb197-3"><a href="dag.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb197-4"><a href="dag.html#cb197-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb197-5"><a href="dag.html#cb197-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;U&quot;</span> <span class="ot">=</span> <span class="st">&quot;(Y(0), y(1))&quot;</span>)</span>
<span id="cb197-6"><a href="dag.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb197-7"><a href="dag.html#cb197-7" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> U,</span>
<span id="cb197-8"><a href="dag.html#cb197-8" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> U,</span>
<span id="cb197-9"><a href="dag.html#cb197-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">latent =</span> <span class="st">&quot;U&quot;</span>,</span>
<span id="cb197-10"><a href="dag.html#cb197-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb197-11"><a href="dag.html#cb197-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb197-12"><a href="dag.html#cb197-12" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag)</span>
<span id="cb197-13"><a href="dag.html#cb197-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="dag.html#cb198-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.6</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-125"></span>
<img src="_main_files/figure-html/unnamed-chunk-125-1.png" alt="One way to generate confounding" width="60%" />
<p class="caption">
Figure 5.5: One way to generate confounding
</p>
</div>
<p>and lets do the simulation of figure 5.6 on p.Â 88 with <code>simstudy</code></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="dag.html#cb199-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.6</span>, {</span>
<span id="cb199-2"><a href="dag.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  probY0 <span class="ot">&lt;-</span> <span class="fl">0.42</span></span>
<span id="cb199-3"><a href="dag.html#cb199-3" aria-hidden="true" tabindex="-1"></a>  probY1 <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb199-4"><a href="dag.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  formulaA <span class="ot">&lt;-</span> <span class="st">&quot;(1-Y0) * (1- Y1) * 0.6307 + (1 - Y0) * Y1 * 0.4867 +</span></span>
<span id="cb199-5"><a href="dag.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="st">  Y0 * (1 - Y1) * 0.4699 + Y0 * Y1 * 0.4263&quot;</span></span>
<span id="cb199-6"><a href="dag.html#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb199-7"><a href="dag.html#cb199-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the potential outcomes</span></span>
<span id="cb199-8"><a href="dag.html#cb199-8" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">&quot;Y0&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb199-9"><a href="dag.html#cb199-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="st">&quot;..probY0&quot;</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb199-10"><a href="dag.html#cb199-10" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y1&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb199-11"><a href="dag.html#cb199-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="st">&quot;..probY1&quot;</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb199-12"><a href="dag.html#cb199-12" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;probA&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;nonrandom&quot;</span>, </span>
<span id="cb199-13"><a href="dag.html#cb199-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaA)</span>
<span id="cb199-14"><a href="dag.html#cb199-14" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;A&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb199-15"><a href="dag.html#cb199-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="st">&quot;probA&quot;</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb199-16"><a href="dag.html#cb199-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y must depend on A, Y1, Y0 in this way</span></span>
<span id="cb199-17"><a href="dag.html#cb199-17" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;nonrandom&quot;</span>, </span>
<span id="cb199-18"><a href="dag.html#cb199-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="st">&quot;A * Y1 + (1 - A) * Y0&quot;</span>)</span>
<span id="cb199-19"><a href="dag.html#cb199-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb199-20"><a href="dag.html#cb199-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the data</span></span>
<span id="cb199-21"><a href="dag.html#cb199-21" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">genData</span>(<span class="dv">1000</span>, defs)</span>
<span id="cb199-22"><a href="dag.html#cb199-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb199-23"><a href="dag.html#cb199-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the tabletbl &lt;- sim_5.6$data %&gt;%</span></span>
<span id="cb199-24"><a href="dag.html#cb199-24" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb199-25"><a href="dag.html#cb199-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(A, Y0, Y1, Y) <span class="sc">%&gt;%</span></span>
<span id="cb199-26"><a href="dag.html#cb199-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb199-27"><a href="dag.html#cb199-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb199-28"><a href="dag.html#cb199-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb199-29"><a href="dag.html#cb199-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb199-30"><a href="dag.html#cb199-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-31"><a href="dag.html#cb199-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format the tableau</span></span>
<span id="cb199-32"><a href="dag.html#cb199-32" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">gt_probs</span>(tbl, <span class="at">title =</span> <span class="st">&quot;Table 5.1&quot;</span>,</span>
<span id="cb199-33"><a href="dag.html#cb199-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subtitle =</span> <span class="st">&quot;Simulation Probabilities for `sim1.r`&quot;</span>)</span>
<span id="cb199-34"><a href="dag.html#cb199-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb199-35"><a href="dag.html#cb199-35" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb199-36"><a href="dag.html#cb199-36" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.6</span><span class="sc">$</span>summ</span></code></pre></div>
<div id="derlplfuuo" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#derlplfuuo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#derlplfuuo .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#derlplfuuo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#derlplfuuo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#derlplfuuo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#derlplfuuo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#derlplfuuo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#derlplfuuo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#derlplfuuo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#derlplfuuo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#derlplfuuo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#derlplfuuo .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#derlplfuuo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#derlplfuuo .gt_from_md > :first-child {
  margin-top: 0;
}

#derlplfuuo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#derlplfuuo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#derlplfuuo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#derlplfuuo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#derlplfuuo .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#derlplfuuo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#derlplfuuo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#derlplfuuo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#derlplfuuo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#derlplfuuo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#derlplfuuo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#derlplfuuo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#derlplfuuo .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#derlplfuuo .gt_left {
  text-align: left;
}

#derlplfuuo .gt_center {
  text-align: center;
}

#derlplfuuo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#derlplfuuo .gt_font_normal {
  font-weight: normal;
}

#derlplfuuo .gt_font_bold {
  font-weight: bold;
}

#derlplfuuo .gt_font_italic {
  font-style: italic;
}

#derlplfuuo .gt_super {
  font-size: 65%;
}

#derlplfuuo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style><strong>Table 5.1</strong></th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Simulation Probabilities for <code>sim1.r</code></strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y0</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">prob</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.077</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0.212</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0.083</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.144</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.127</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.173</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.079</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.105</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="5">Fundamentals of Causal Inference, Babette A. Brumback, 2022</td>
    </tr>
  </tfoot>
  
</table>
</div>
<p>we also do it in base <code>R</code> with the script on p.88</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="dag.html#cb200-1" aria-hidden="true" tabindex="-1"></a>sim1.r <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>) {</span>
<span id="cb200-2"><a href="dag.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb200-3"><a href="dag.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  probY0 <span class="ot">&lt;-</span> <span class="fl">0.42</span></span>
<span id="cb200-4"><a href="dag.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  probY1 <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb200-5"><a href="dag.html#cb200-5" aria-hidden="true" tabindex="-1"></a>  Y0 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY0)</span>
<span id="cb200-6"><a href="dag.html#cb200-6" aria-hidden="true" tabindex="-1"></a>  Y1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY1)</span>
<span id="cb200-7"><a href="dag.html#cb200-7" aria-hidden="true" tabindex="-1"></a>  probA <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> Y0) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> Y1) <span class="sc">*</span> <span class="fl">0.6307</span> <span class="sc">+</span> </span>
<span id="cb200-8"><a href="dag.html#cb200-8" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">-</span> Y0) <span class="sc">*</span> Y1 <span class="sc">*</span> <span class="fl">0.4867</span> <span class="sc">+</span></span>
<span id="cb200-9"><a href="dag.html#cb200-9" aria-hidden="true" tabindex="-1"></a>    Y0 <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span> Y1) <span class="sc">*</span> <span class="fl">0.4699</span> <span class="sc">+</span></span>
<span id="cb200-10"><a href="dag.html#cb200-10" aria-hidden="true" tabindex="-1"></a>    Y0 <span class="sc">*</span> Y1 <span class="sc">*</span> <span class="fl">0.4263</span></span>
<span id="cb200-11"><a href="dag.html#cb200-11" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probA)</span>
<span id="cb200-12"><a href="dag.html#cb200-12" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> A <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> A) <span class="sc">*</span> Y0</span>
<span id="cb200-13"><a href="dag.html#cb200-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(A, Y0, Y1, Y))</span>
<span id="cb200-14"><a href="dag.html#cb200-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>and we obtain the same results as with <code>simstudy</code></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="dag.html#cb201-1" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">sim1.r</span>() <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="dag.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(A, Y0, Y1, Y) <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="dag.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb201-4"><a href="dag.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb201-5"><a href="dag.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb201-6"><a href="dag.html#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb201-7"><a href="dag.html#cb201-7" aria-hidden="true" tabindex="-1"></a>tbl</span></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##       A    Y0    Y1     Y  prob
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0     0     0     0 0.077
## 2     0     0     1     0 0.212
## 3     0     1     0     1 0.083
## 4     0     1     1     1 0.144
## 5     1     0     0     0 0.127
## 6     1     0     1     1 0.173
## 7     1     1     0     0 0.079
## 8     1     1     1     1 0.105</code></pre>
<p>but when compare with the authorâs</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="dag.html#cb203-1" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb203-2"><a href="dag.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb203-3"><a href="dag.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y0 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb203-4"><a href="dag.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb203-5"><a href="dag.html#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb203-6"><a href="dag.html#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.0814</span>, <span class="fl">0.1846</span>, <span class="fl">0.0846</span>, <span class="fl">0.1494</span>, <span class="fl">0.139</span>, <span class="fl">0.175</span>, <span class="fl">0.075</span>, <span class="fl">0.111</span>)</span>
<span id="cb203-7"><a href="dag.html#cb203-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb203-8"><a href="dag.html#cb203-8" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.6</span></span></code></pre></div>
<pre><code>##   A Y0 Y1 Y   prob
## 1 0  0  0 0 0.0814
## 2 0  0  1 0 0.1846
## 3 0  1  0 1 0.0846
## 4 0  1  1 1 0.1494
## 5 1  0  0 0 0.1390
## 6 1  0  1 1 0.1750
## 7 1  1  0 0 0.0750
## 8 1  1  1 1 0.1110</code></pre>
<p>it is different. Table 5.1 is entitled <em>Simulation probabilities for <code>sim1.r</code></em>
because they are simulated probabilities. If the simulation size is increased
10000 the results are more in line with the authorâs.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="dag.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">&quot;author&quot;</span> <span class="ot">=</span> bb_5<span class="fl">.6</span><span class="sc">$</span>prob, <span class="st">&quot;sim&quot;</span> <span class="ot">=</span> scm_5<span class="fl">.6</span><span class="sc">$</span>tbl<span class="sc">$</span>prob) <span class="sc">%&gt;%</span></span>
<span id="cb205-2"><a href="dag.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> sim <span class="sc">-</span> author)</span></code></pre></div>
<pre><code>##   author   sim    diff
## 1 0.0814 0.077 -0.0044
## 2 0.1846 0.212  0.0274
## 3 0.0846 0.083 -0.0016
## 4 0.1494 0.144 -0.0054
## 5 0.1390 0.127 -0.0120
## 6 0.1750 0.173 -0.0020
## 7 0.0750 0.079  0.0040
## 8 0.1110 0.105 -0.0060</code></pre>
<p>and we also confirm the theoretical probabilities of the first line in the table
as follows</p>
<p><span class="math display">\[
\begin{align*}
\text{using (5.1), p.81, we can write the joint distribution as} \\
P(Y = 0, A = 0, Y1 = 0, Y0 = 0) = \\
P(Y = 0 \mid A = 0, Y1 = 0, Y0 = 0) P(A = 0 \mid Y1 = 0, Y0 = 0)P(Y1 = 0 \mid Y0 = 0)\ P(Y0 =0)
\end{align*}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
P(Y = 0 \mid A = 0, Y1 = 0, Y0 = 0)=1
\]</span></p>
<p>and from the simulation we have</p>
<p><span class="math display">\[
\begin{align*}
P(A = 1 \mid Y0 = 0, Y1 = 0) &amp;= 0.6307 \\
P(A = 0 \mid Y0 = 0, Y1 = 0) &amp;=  - 0.6307 =  0.3693\\
P(A = 1 \mid Y0 = 1, Y1 = 0) &amp;= 0.4699 \\
P(A = 0 \mid Y0 = 1, Y1 = 0) &amp;= 1 - 0.4699 = 0.5301 \\
P(A = 1 \mid Y0 = 0, Y1 = 1) &amp;= 0.4867 \\
P(A = 0 \mid Y0 = 0, Y1 = 1) &amp;= 1 - 0.4867 = 0.5133 \\
P(A = 1 \mid Y0 = 1, Y1 = 1) &amp;= 0.4263 \\
P(A = 0 \mid Y0 = 1, Y1 = 1) &amp;= 1 - 0.4263 = 0.5737
\end{align*}
\]</span></p>
<p>and we note that <span class="math inline">\(Y0\)</span> and <span class="math inline">\(Y1\)</span> are independent, i.e.Â <span class="math inline">\(P(Y1 \mid Y0) = P(Y1)\)</span>
so that</p>
<p><span class="math display">\[
\begin{align*}
P(Y0 = 1) &amp;= 0.42\\
P(Y0 = 0) &amp;= 1 - 0.42 = 0.58\\
P(Y1 = 1) &amp;= 0.62\\
P(Y1 = 0) &amp;= 1 - 0.62 = 0.38
\end{align*}
\]</span></p>
<p>and since <span class="math inline">\(Y0\)</span> and <span class="math inline">\(Y1\)</span> are independent, i.e.Â <span class="math inline">\(P(Y1 \mid Y0) = P(Y1)\)</span> then</p>
<p><span class="math display">\[
\begin{align*}
P(Y = 0, A = 0, Y1 = 0, Y0 = 0) &amp;= \\
P(Y = 0 \mid A = 0, Y1 = 0, Y0 = 0) P(A = 0 \mid Y1 = 0, Y0 = 0) \cdot P(Y1 = 0 \mid Y0 = 0)P(Y0 = 0) &amp;= \\
1 \cdot P(A = 0 \mid Y1 = 0, Y0 = 0) \cdot P(Y1 = 0)P(Y0 = 0) &amp;= \\
1\times 0.3693 \times 0.58 \times 0.38 &amp;= 0.0814 
\end{align*}
\]</span></p>
</div>
<div id="structural-causal-model-5.7" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Structural Causal Model 5.7</h3>
<p>The causal DAG is</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="dag.html#cb207-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb207-2"><a href="dag.html#cb207-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.7</span>, {</span>
<span id="cb207-3"><a href="dag.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb207-4"><a href="dag.html#cb207-4" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> H,</span>
<span id="cb207-5"><a href="dag.html#cb207-5" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> H)</span>
<span id="cb207-6"><a href="dag.html#cb207-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-7"><a href="dag.html#cb207-7" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag)</span>
<span id="cb207-8"><a href="dag.html#cb207-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="dag.html#cb208-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.7</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-132"></span>
<img src="_main_files/figure-html/unnamed-chunk-132-1.png" alt="Another way to generate confounding" width="60%" />
<p class="caption">
Figure 5.6: Another way to generate confounding
</p>
</div>
<p>and we simulate the model with <code>simstudy</code> (and with the authorâs script after)</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="dag.html#cb209-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.7</span>, {</span>
<span id="cb209-2"><a href="dag.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb209-3"><a href="dag.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the confounder H first</span></span>
<span id="cb209-4"><a href="dag.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">&quot;H&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb209-5"><a href="dag.html#cb209-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="fl">0.4</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb209-6"><a href="dag.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the treatment depend on the confounder</span></span>
<span id="cb209-7"><a href="dag.html#cb209-7" aria-hidden="true" tabindex="-1"></a>  formulaA <span class="ot">&lt;-</span> <span class="st">&quot;H * 0.8 + (1 - H) * 0.3&quot;</span></span>
<span id="cb209-8"><a href="dag.html#cb209-8" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;A&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb209-9"><a href="dag.html#cb209-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaA, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb209-10"><a href="dag.html#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the outcome depend on the treatment and the confounder</span></span>
<span id="cb209-11"><a href="dag.html#cb209-11" aria-hidden="true" tabindex="-1"></a>  formulaY <span class="ot">&lt;-</span> <span class="st">&quot;A * (H * 0.5 + (1 - H) * 0.7) +</span></span>
<span id="cb209-12"><a href="dag.html#cb209-12" aria-hidden="true" tabindex="-1"></a><span class="st">  (1 - A) * (H * 0.3 + (1 - H) * 0.5)&quot;</span></span>
<span id="cb209-13"><a href="dag.html#cb209-13" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb209-14"><a href="dag.html#cb209-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb209-15"><a href="dag.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-16"><a href="dag.html#cb209-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the data</span></span>
<span id="cb209-17"><a href="dag.html#cb209-17" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">genData</span>(<span class="dv">1000</span>, defs)</span>
<span id="cb209-18"><a href="dag.html#cb209-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb209-19"><a href="dag.html#cb209-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the tabletbl &lt;- sim_5.6$data %&gt;%</span></span>
<span id="cb209-20"><a href="dag.html#cb209-20" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb209-21"><a href="dag.html#cb209-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(A, H, Y) <span class="sc">%&gt;%</span></span>
<span id="cb209-22"><a href="dag.html#cb209-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb209-23"><a href="dag.html#cb209-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb209-24"><a href="dag.html#cb209-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb209-25"><a href="dag.html#cb209-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb209-26"><a href="dag.html#cb209-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-27"><a href="dag.html#cb209-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format the tableau</span></span>
<span id="cb209-28"><a href="dag.html#cb209-28" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">gt_probs</span>(tbl, <span class="at">title =</span> <span class="st">&quot;Table 5.2&quot;</span>,</span>
<span id="cb209-29"><a href="dag.html#cb209-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subtitle =</span> <span class="st">&quot;Simulation Probabilities for `sim2.r`&quot;</span>)</span>
<span id="cb209-30"><a href="dag.html#cb209-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb209-31"><a href="dag.html#cb209-31" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.7</span><span class="sc">$</span>summ</span></code></pre></div>
<div id="fpzmgpvcjo" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fpzmgpvcjo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fpzmgpvcjo .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fpzmgpvcjo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fpzmgpvcjo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fpzmgpvcjo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fpzmgpvcjo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fpzmgpvcjo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fpzmgpvcjo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fpzmgpvcjo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fpzmgpvcjo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fpzmgpvcjo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fpzmgpvcjo .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fpzmgpvcjo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fpzmgpvcjo .gt_from_md > :first-child {
  margin-top: 0;
}

#fpzmgpvcjo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fpzmgpvcjo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fpzmgpvcjo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fpzmgpvcjo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fpzmgpvcjo .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fpzmgpvcjo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fpzmgpvcjo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fpzmgpvcjo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fpzmgpvcjo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fpzmgpvcjo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fpzmgpvcjo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fpzmgpvcjo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fpzmgpvcjo .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fpzmgpvcjo .gt_left {
  text-align: left;
}

#fpzmgpvcjo .gt_center {
  text-align: center;
}

#fpzmgpvcjo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fpzmgpvcjo .gt_font_normal {
  font-weight: normal;
}

#fpzmgpvcjo .gt_font_bold {
  font-weight: bold;
}

#fpzmgpvcjo .gt_font_italic {
  font-style: italic;
}

#fpzmgpvcjo .gt_super {
  font-size: 65%;
}

#fpzmgpvcjo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style><strong>Table 5.2</strong></th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Simulation Probabilities for <code>sim2.r</code></strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">H</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">prob</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.181</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.230</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.065</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.014</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.065</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.132</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.141</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.172</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">Fundamentals of Causal Inference, Babette A. Brumback, 2022</td>
    </tr>
  </tfoot>
  
</table>
</div>
<p>and with the script <code>sim2.r</code> in base R</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="dag.html#cb210-1" aria-hidden="true" tabindex="-1"></a>sim2.r <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>) {</span>
<span id="cb210-2"><a href="dag.html#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">222</span>)</span>
<span id="cb210-3"><a href="dag.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the confounder first</span></span>
<span id="cb210-4"><a href="dag.html#cb210-4" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>)</span>
<span id="cb210-5"><a href="dag.html#cb210-5" aria-hidden="true" tabindex="-1"></a>  probA <span class="ot">&lt;-</span> H <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.3</span></span>
<span id="cb210-6"><a href="dag.html#cb210-6" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probA)</span>
<span id="cb210-7"><a href="dag.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> A <span class="sc">*</span> (H <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.7</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> A) <span class="sc">*</span> (H <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.5</span>)</span>
<span id="cb210-8"><a href="dag.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb210-9"><a href="dag.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(H, A, Y))</span>
<span id="cb210-10"><a href="dag.html#cb210-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>with the same probabilities as <code>simstudy</code></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="dag.html#cb211-1" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">sim2.r</span>() <span class="sc">%&gt;%</span></span>
<span id="cb211-2"><a href="dag.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(A, H, Y) <span class="sc">%&gt;%</span></span>
<span id="cb211-3"><a href="dag.html#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb211-4"><a href="dag.html#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb211-5"><a href="dag.html#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb211-6"><a href="dag.html#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb211-7"><a href="dag.html#cb211-7" aria-hidden="true" tabindex="-1"></a>tbl</span></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##       A     H     Y  prob
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     0     0     0 0.181
## 2     0     0     1 0.23 
## 3     0     1     0 0.065
## 4     0     1     1 0.014
## 5     1     0     0 0.065
## 6     1     0     1 0.132
## 7     1     1     0 0.141
## 8     1     1     1 0.172</code></pre>
<p>and the author provides the theoretical probability table</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="dag.html#cb213-1" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb213-2"><a href="dag.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb213-3"><a href="dag.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">H =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb213-4"><a href="dag.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb213-5"><a href="dag.html#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.21</span>, <span class="fl">0.21</span>, <span class="fl">0.056</span>, <span class="fl">0.024</span>, <span class="fl">0.024</span>, <span class="fl">0.126</span>, <span class="fl">0.16</span>, <span class="fl">0.16</span>)</span>
<span id="cb213-6"><a href="dag.html#cb213-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb213-7"><a href="dag.html#cb213-7" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.7</span></span></code></pre></div>
<pre><code>##   A H Y  prob
## 1 0 0 0 0.210
## 2 0 0 1 0.210
## 3 0 1 0 0.056
## 4 0 1 1 0.024
## 5 1 0 0 0.024
## 6 1 0 1 0.126
## 7 1 1 0 0.160
## 8 1 1 1 0.160</code></pre>
<p>and computating the theoretical prob. as was donw above</p>
<p><span class="math display">\[
\begin{align*}
P(Y, A, H) = P(Y \mid A, H)P(A \mid H)P(H) \\
\end{align*}
\]</span></p>
<p>and from the simulation we have</p>
<p><span class="math display">\[
\begin{align*}
P(H = 1) = 0.4 \\
P(H = 0) = 0.6 \\
P(A = 1 \mid H = 0) = 0.3 \\
P(A = 0 \mid H = 0) = 1 - 0.3 = 0.7 \\
P(A = 1 \mid H = 1) = 0.8 \\
P(A = 0 \mid H = 1) = 1 - 0.8 = 0.2 \\
P(Y = 1 \mid A = 1, H = 1) = 0.5\\
P(Y = 0 \mid A = 1, H = 1) = 1 - 0.5 = 0.5\\
P(Y = 1 \mid A = 1, H = 0) = 0.7\\
P(Y = 0 \mid A = 1, H = 0) = 1 - 0.7 = 0.3\\
P(Y = 1 \mid A = 0, H = 1) = 0.3\\
P(Y = 0 \mid A = 0, H = 1) = 1 - 0.3 = 0.7\\
P(Y = 1 \mid A = 0, H = 0) = 0.5\\
P(Y = 0 \mid A = 0, H = 0) = 1 - 0.5 = 0.5\\
\end{align*}
\]</span></p>
<p>Therefore for row 1 of table 5.2 we have</p>
<p><span class="math display">\[
\begin{align*}
P(Y = 0, A = 0, H = 0) &amp;= P(Y = 0 \mid A = 0, H = 0)P(A = 0 \mid H = 0)P(H = 0) \\
&amp;= 0.5 \times 0.7 \times 0.6 = 0.21
\end{align*}
\]</span></p>
<p>and for row 4 of table 5.2</p>
<p><span class="math display">\[
\begin{align*}
P(Y = 1, A = 0, H = 1) &amp;= P(Y = 1 \mid A = 0, H = 1)P(A = 0 \mid H = 1)P(H = 1) \\
&amp;= 0.3 \times 0.2 \times 0.4 = 0.024
\end{align*}
\]</span></p>
<p>Using either <code>sim1.r</code> or <code>sim2.r</code> we can get the joint probability of <span class="math inline">\(A\)</span> and
<span class="math inline">\(Y\)</span> using the law of total probabilities.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="dag.html#cb215-1" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.6</span> <span class="sc">%&gt;%</span></span>
<span id="cb215-2"><a href="dag.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(A, Y) <span class="sc">%&gt;%</span></span>
<span id="cb215-3"><a href="dag.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prob =</span> <span class="fu">sum</span>(prob))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;A&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   A [2]
##       A     Y  prob
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0     0 0.266
## 2     0     1 0.234
## 3     1     0 0.214
## 4     1     1 0.286</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="dag.html#cb218-1" aria-hidden="true" tabindex="-1"></a>bb_5<span class="fl">.7</span> <span class="sc">%&gt;%</span></span>
<span id="cb218-2"><a href="dag.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(A, Y) <span class="sc">%&gt;%</span></span>
<span id="cb218-3"><a href="dag.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prob =</span> <span class="fu">sum</span>(prob))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;A&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 4 x 3
## # Groups:   A [2]
##       A     Y  prob
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0     0 0.266
## 2     0     1 0.234
## 3     1     0 0.184
## 4     1     1 0.286</code></pre>
<p>Now</p>
<blockquote>
<p>One might wonder if knowledge of <span class="math inline">\((A, H, Y)\)</span> is equivalent to knowledge
of <span class="math inline">\((A, Y0, Y1, Y)\)</span> Given <span class="math inline">\((A, Y)\)</span> we cannot recover both <span class="math inline">\(Y0\)</span> and <span class="math inline">\(Y1\)</span>.</p>
</blockquote>
<p>For example we can recover <span class="math inline">\(Y1 = 1\)</span> since</p>
<p><span class="math display">\[
\begin{align*}
P(Y1 = 1 \mid A = 1, Y = 1) &amp;= \frac{P(Y1 = 1, A = 1, Y = 1)}{P(A = 1, Y = 1)} \\
&amp;= \frac{0.175 + 0.111}{0.175 + 0.111} = 1
\end{align*}
\]</span></p>
<p>but for <span class="math inline">\(P(Y0 = 1 \mid A = 1, Y = 1)\)</span> we have</p>
<p><span class="math display">\[
\begin{align*}
P(Y0 = 1 \mid A = 1, Y = 1) &amp;= \frac{P(Y0 = 1, A = 1, Y = 1)}{P(A = 1, Y = 1)} \\
&amp;= \frac{0.111}{0.175 + 0.111} = 0.39
\end{align*}
\]</span></p>
<p>and so the likelihood that <span class="math inline">\(Y0 = 1\)</span> is only 39% and it is therefore more likely
that <span class="math inline">\(Y0 = 0\)</span> . . . but not always.</p>
<blockquote>
<p>Does the additional knowledge of <span class="math inline">\(H\)</span> help to identify <span class="math inline">\(Y(0)\)</span>? We leave that
as a question for the reader.</p>
</blockquote>
<p>If we include <span class="math inline">\(H\)</span> in the DAG of figure 5.6 we obtain the DAG of figure
5.8 below. We observe that <span class="math inline">\((Y(0), Y(1)) \perp\!\!\!\perp A \mid H\)</span>. In addition,
since <span class="math inline">\(Y\)</span> is a collider <span class="math inline">\((Y(0), Y(1)) \not\!\perp\!\!\!\perp A \mid Y\)</span>, therefore
if we use the data from figure 5.8 below (<code>simall.r</code>) we have</p>
<p><span class="math display">\[
\begin{align*}
P(Y0 = 1 \mid H = 1) &amp;= \frac{P(Y0 = 1, H = 1)}{P(H = 1)} \\
&amp;= \frac{0.019 + 0.006 + 0.051 + 0.05}{0.031 + 0.02 + 0.019 + 0.006 + 0.109 + 0.117 + 0.051 + 0.05} \\
&amp;= \frac{0.126}{0.403} = 0.31
\end{align*}
\]</span>
Therefore <span class="math inline">\(H\)</span> is not entirely sufficient to determine <span class="math inline">\((Y(0), Y(1))\)</span> as it
will do it only 31% of the time for <span class="math inline">\(Y(0) = 1\)</span> and otherwise 69% of the time
for <span class="math inline">\(Y(0) = 0\)</span>.</p>
</div>
<div id="potential-outcomes-behind-the-scenes" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Potential Outcomes Behind the Scenes</h3>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="dag.html#cb221-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb221-2"><a href="dag.html#cb221-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.8</span>, {</span>
<span id="cb221-3"><a href="dag.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb221-4"><a href="dag.html#cb221-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb221-5"><a href="dag.html#cb221-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;U&quot;</span> <span class="ot">=</span> <span class="st">&quot;(Y(0), y(1))&quot;</span>)</span>
<span id="cb221-6"><a href="dag.html#cb221-6" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb221-7"><a href="dag.html#cb221-7" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> H,</span>
<span id="cb221-8"><a href="dag.html#cb221-8" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> U,</span>
<span id="cb221-9"><a href="dag.html#cb221-9" aria-hidden="true" tabindex="-1"></a>    U <span class="sc">~</span> H,</span>
<span id="cb221-10"><a href="dag.html#cb221-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">latent =</span> <span class="st">&quot;U&quot;</span>,</span>
<span id="cb221-11"><a href="dag.html#cb221-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb221-12"><a href="dag.html#cb221-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb221-13"><a href="dag.html#cb221-13" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag)</span>
<span id="cb221-14"><a href="dag.html#cb221-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="dag.html#cb222-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.8</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-140"></span>
<img src="_main_files/figure-html/unnamed-chunk-140-1.png" alt="Potential Outcomes Behind the Scenes" width="60%" />
<p class="caption">
Figure 5.7: Potential Outcomes Behind the Scenes
</p>
</div>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="dag.html#cb223-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.8</span>, {</span>
<span id="cb223-2"><a href="dag.html#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">888</span>)</span>
<span id="cb223-3"><a href="dag.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the observed confounder H</span></span>
<span id="cb223-4"><a href="dag.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">&quot;H&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb223-5"><a href="dag.html#cb223-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="fl">0.4</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb223-6"><a href="dag.html#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the treatment depend on the observed confounder</span></span>
<span id="cb223-7"><a href="dag.html#cb223-7" aria-hidden="true" tabindex="-1"></a>  formulaA <span class="ot">&lt;-</span> <span class="st">&quot;H * 0.8 + (1 - H) * 0.3&quot;</span></span>
<span id="cb223-8"><a href="dag.html#cb223-8" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;A&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb223-9"><a href="dag.html#cb223-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaA, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb223-10"><a href="dag.html#cb223-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the poential outcomes dependent on the observed confounder</span></span>
<span id="cb223-11"><a href="dag.html#cb223-11" aria-hidden="true" tabindex="-1"></a>  formulaY0 <span class="ot">&lt;-</span> <span class="st">&quot;H * 0.3 + (1 - H) * 0.5&quot;</span></span>
<span id="cb223-12"><a href="dag.html#cb223-12" aria-hidden="true" tabindex="-1"></a>  formulaY1 <span class="ot">&lt;-</span> <span class="st">&quot;H * 0.5 + (1 - H) * 0.7&quot;</span></span>
<span id="cb223-13"><a href="dag.html#cb223-13" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y0&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb223-14"><a href="dag.html#cb223-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY0, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb223-15"><a href="dag.html#cb223-15" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y1&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb223-16"><a href="dag.html#cb223-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY1, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb223-17"><a href="dag.html#cb223-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the outcome depend on the treatment and Y0, Y1</span></span>
<span id="cb223-18"><a href="dag.html#cb223-18" aria-hidden="true" tabindex="-1"></a>  formulaY <span class="ot">&lt;-</span> <span class="st">&quot;A * Y1 + (1 - A) * Y0&quot;</span></span>
<span id="cb223-19"><a href="dag.html#cb223-19" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb223-20"><a href="dag.html#cb223-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb223-21"><a href="dag.html#cb223-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb223-22"><a href="dag.html#cb223-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the data</span></span>
<span id="cb223-23"><a href="dag.html#cb223-23" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">genData</span>(<span class="dv">1000</span>, defs)</span>
<span id="cb223-24"><a href="dag.html#cb223-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb223-25"><a href="dag.html#cb223-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the tabletbl &lt;- sim_5.6$data %&gt;%</span></span>
<span id="cb223-26"><a href="dag.html#cb223-26" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb223-27"><a href="dag.html#cb223-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(H, A, Y0, Y1, Y) <span class="sc">%&gt;%</span></span>
<span id="cb223-28"><a href="dag.html#cb223-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb223-29"><a href="dag.html#cb223-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb223-30"><a href="dag.html#cb223-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb223-31"><a href="dag.html#cb223-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb223-32"><a href="dag.html#cb223-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-33"><a href="dag.html#cb223-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format the tableau</span></span>
<span id="cb223-34"><a href="dag.html#cb223-34" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> <span class="fu">gt_probs</span>(tbl, <span class="at">title =</span> <span class="st">&quot;Table for `simall.r`&quot;</span>,</span>
<span id="cb223-35"><a href="dag.html#cb223-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subtitle =</span> <span class="st">&quot;Simulation Probabilities for `simall.r`&quot;</span>)</span>
<span id="cb223-36"><a href="dag.html#cb223-36" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb223-37"><a href="dag.html#cb223-37" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.8</span><span class="sc">$</span>tbl</span></code></pre></div>
<div id="rjnfbzjtxw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rjnfbzjtxw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rjnfbzjtxw .gt_heading {
  background-color: #DCDCDC;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjnfbzjtxw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rjnfbzjtxw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rjnfbzjtxw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjnfbzjtxw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjnfbzjtxw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rjnfbzjtxw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rjnfbzjtxw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rjnfbzjtxw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rjnfbzjtxw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rjnfbzjtxw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rjnfbzjtxw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rjnfbzjtxw .gt_from_md > :first-child {
  margin-top: 0;
}

#rjnfbzjtxw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rjnfbzjtxw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rjnfbzjtxw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rjnfbzjtxw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjnfbzjtxw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rjnfbzjtxw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjnfbzjtxw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rjnfbzjtxw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rjnfbzjtxw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjnfbzjtxw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjnfbzjtxw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rjnfbzjtxw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjnfbzjtxw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rjnfbzjtxw .gt_left {
  text-align: left;
}

#rjnfbzjtxw .gt_center {
  text-align: center;
}

#rjnfbzjtxw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rjnfbzjtxw .gt_font_normal {
  font-weight: normal;
}

#rjnfbzjtxw .gt_font_bold {
  font-weight: bold;
}

#rjnfbzjtxw .gt_font_italic {
  font-style: italic;
}

#rjnfbzjtxw .gt_super {
  font-size: 65%;
}

#rjnfbzjtxw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="6" class="gt_heading gt_title gt_font_normal" style><strong>Table for <code>simall.r</code></strong></th>
    </tr>
    <tr>
      <th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style><strong>Simulation Probabilities for <code>simall.r</code></strong></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">H</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y0</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">prob</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.070</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0.159</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0.055</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.140</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.023</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.065</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.026</td></tr>
    <tr><td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.059</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.031</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">0.020</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0.019</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.006</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.109</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.117</td></tr>
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0</td>
<td class="gt_row gt_center">0.051</td></tr>
    <tr><td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">0.050</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="6">Fundamentals of Causal Inference, Babette A. Brumback, 2022</td>
    </tr>
  </tfoot>
  
</table>
</div>
<p>and with the script <code>simall.r</code> in base R</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="dag.html#cb224-1" aria-hidden="true" tabindex="-1"></a>simall.r <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>) {</span>
<span id="cb224-2"><a href="dag.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">888</span>)</span>
<span id="cb224-3"><a href="dag.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the observed confounder</span></span>
<span id="cb224-4"><a href="dag.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>)</span>
<span id="cb224-5"><a href="dag.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the treatment</span></span>
<span id="cb224-6"><a href="dag.html#cb224-6" aria-hidden="true" tabindex="-1"></a>  probA <span class="ot">&lt;-</span> H <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.3</span></span>
<span id="cb224-7"><a href="dag.html#cb224-7" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probA)</span>
<span id="cb224-8"><a href="dag.html#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the poential outcomes dependent on the observed confounder</span></span>
<span id="cb224-9"><a href="dag.html#cb224-9" aria-hidden="true" tabindex="-1"></a>  probY0 <span class="ot">&lt;-</span> H <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.5</span></span>
<span id="cb224-10"><a href="dag.html#cb224-10" aria-hidden="true" tabindex="-1"></a>  probY1 <span class="ot">&lt;-</span> H <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> H) <span class="sc">*</span> <span class="fl">0.7</span></span>
<span id="cb224-11"><a href="dag.html#cb224-11" aria-hidden="true" tabindex="-1"></a>  Y0 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY0)</span>
<span id="cb224-12"><a href="dag.html#cb224-12" aria-hidden="true" tabindex="-1"></a>  Y1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY1)</span>
<span id="cb224-13"><a href="dag.html#cb224-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let the outcome depend on the treatment and Y0, Y1</span></span>
<span id="cb224-14"><a href="dag.html#cb224-14" aria-hidden="true" tabindex="-1"></a>  probY <span class="ot">&lt;-</span> A <span class="sc">*</span> Y1 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> A) <span class="sc">*</span> Y0</span>
<span id="cb224-15"><a href="dag.html#cb224-15" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> probY)</span>
<span id="cb224-16"><a href="dag.html#cb224-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(H, A, Y0, Y1, Y))</span>
<span id="cb224-17"><a href="dag.html#cb224-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>and the causal DAG for the What-If? study is</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="dag.html#cb225-1" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb225-2"><a href="dag.html#cb225-2" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.9</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_5<span class="fl">.9</span>, {</span>
<span id="cb225-3"><a href="dag.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;U&quot;</span> <span class="ot">=</span> <span class="st">&quot;Unmeasured, healthy behavior (U=1)&quot;</span>, </span>
<span id="cb225-4"><a href="dag.html#cb225-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;AD0&quot;</span> <span class="ot">=</span> <span class="st">&quot;Adherence time 0&quot;</span>, </span>
<span id="cb225-5"><a href="dag.html#cb225-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;VL0&quot;</span> <span class="ot">=</span> <span class="st">&quot;Viral Load time 0&quot;</span>, </span>
<span id="cb225-6"><a href="dag.html#cb225-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">&quot;Naltrexone (T=1)&quot;</span>, </span>
<span id="cb225-7"><a href="dag.html#cb225-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;Reduced drinking (A=1)&quot;</span>, </span>
<span id="cb225-8"><a href="dag.html#cb225-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;AD1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Adherence time 1&quot;</span>, </span>
<span id="cb225-9"><a href="dag.html#cb225-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;VL1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Viral Load time 1&quot;</span>)</span>
<span id="cb225-10"><a href="dag.html#cb225-10" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb225-11"><a href="dag.html#cb225-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">names</span>(the_nodes),</span>
<span id="cb225-12"><a href="dag.html#cb225-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb225-13"><a href="dag.html#cb225-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb225-14"><a href="dag.html#cb225-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb225-15"><a href="dag.html#cb225-15" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb225-16"><a href="dag.html#cb225-16" aria-hidden="true" tabindex="-1"></a>    AD0 <span class="sc">~</span> U,</span>
<span id="cb225-17"><a href="dag.html#cb225-17" aria-hidden="true" tabindex="-1"></a>    VL0 <span class="sc">~</span> AD0,</span>
<span id="cb225-18"><a href="dag.html#cb225-18" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span> <span class="sc">+</span> U,</span>
<span id="cb225-19"><a href="dag.html#cb225-19" aria-hidden="true" tabindex="-1"></a>    AD1 <span class="sc">~</span> A,</span>
<span id="cb225-20"><a href="dag.html#cb225-20" aria-hidden="true" tabindex="-1"></a>    VL1 <span class="sc">~</span> AD0 <span class="sc">+</span> AD1 <span class="sc">+</span> U,</span>
<span id="cb225-21"><a href="dag.html#cb225-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;VL1&quot;</span>,</span>
<span id="cb225-22"><a href="dag.html#cb225-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;T&quot;</span>,</span>
<span id="cb225-23"><a href="dag.html#cb225-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">latent =</span> <span class="st">&quot;U&quot;</span>,</span>
<span id="cb225-24"><a href="dag.html#cb225-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> the_nodes)</span>
<span id="cb225-25"><a href="dag.html#cb225-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-26"><a href="dag.html#cb225-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-27"><a href="dag.html#cb225-27" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(AD[<span class="dv">0</span>]), <span class="fu">expression</span>(AD[<span class="dv">1</span>]),</span>
<span id="cb225-28"><a href="dag.html#cb225-28" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;T&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="fu">expression</span>(VL[<span class="dv">0</span>]), <span class="fu">expression</span>(VL[<span class="dv">1</span>]))</span>
<span id="cb225-29"><a href="dag.html#cb225-29" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_labels =</span> text_labels, <span class="at">text_size =</span> <span class="dv">5</span>)</span>
<span id="cb225-30"><a href="dag.html#cb225-30" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb225-31"><a href="dag.html#cb225-31" aria-hidden="true" tabindex="-1"></a>scm_5<span class="fl">.9</span><span class="sc">$</span>plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-143"></span>
<img src="_main_files/figure-html/unnamed-chunk-143-1.png" alt="The Double What-If? Study" width="80%" />
<p class="caption">
Figure 5.8: The Double What-If? Study
</p>
</div>
</div>
</div>
<div id="exercises-4" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Exercises</h2>
<div id="exercise-1-4" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Exercise 1</h3>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="dag.html#cb226-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb226-2"><a href="dag.html#cb226-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.1</span>, {</span>
<span id="cb226-3"><a href="dag.html#cb226-3" aria-hidden="true" tabindex="-1"></a>    the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;Nutrient&quot;</span>,</span>
<span id="cb226-4"><a href="dag.html#cb226-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;W1&quot;</span> <span class="ot">=</span> <span class="st">&quot;Diet&quot;</span>,</span>
<span id="cb226-5"><a href="dag.html#cb226-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;W2&quot;</span> <span class="ot">=</span> <span class="st">&quot;Weight&quot;</span>,</span>
<span id="cb226-6"><a href="dag.html#cb226-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;W3&quot;</span> <span class="ot">=</span> <span class="st">&quot;Exercise&quot;</span>,</span>
<span id="cb226-7"><a href="dag.html#cb226-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;Strength&quot;</span>)</span>
<span id="cb226-8"><a href="dag.html#cb226-8" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb226-9"><a href="dag.html#cb226-9" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> W1,</span>
<span id="cb226-10"><a href="dag.html#cb226-10" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> W3,</span>
<span id="cb226-11"><a href="dag.html#cb226-11" aria-hidden="true" tabindex="-1"></a>    W2 <span class="sc">~</span> W1 <span class="sc">+</span> W3,</span>
<span id="cb226-12"><a href="dag.html#cb226-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes,</span>
<span id="cb226-13"><a href="dag.html#cb226-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb226-14"><a href="dag.html#cb226-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb226-15"><a href="dag.html#cb226-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-16"><a href="dag.html#cb226-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-17"><a href="dag.html#cb226-17" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(W[<span class="dv">1</span>]), <span class="fu">expression</span>(W[<span class="dv">2</span>]),</span>
<span id="cb226-18"><a href="dag.html#cb226-18" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(W[<span class="dv">3</span>]), <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb226-19"><a href="dag.html#cb226-19" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_labels =</span> text_labels, <span class="at">box_padding =</span> <span class="dv">3</span>)</span>
<span id="cb226-20"><a href="dag.html#cb226-20" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<blockquote>
<p>Math the vairable to the causal DAG</p>
</blockquote>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-145"></span>
<img src="_main_files/figure-html/unnamed-chunk-145-1.png" alt="Causal DAG for Exercise 1" width="80%" />
<p class="caption">
Figure 5.9: Causal DAG for Exercise 1
</p>
</div>
<blockquote>
<p>How wwould you analyse the effect of nutrient intake on increased strength?</p>
</blockquote>
<p>Since we have a collider at <span class="math inline">\(W_3 = weight\)</span> then <span class="math inline">\(diet\)</span> and <span class="math inline">\(exercise\)</span> are not
independent and <span class="math inline">\(weight\)</span> is a confounder if we condition on it. That is</p>
<p><span class="math display">\[
Strength \not \! \perp\!\!\!\perp Nutrient \mid Weight
\]</span></p>
<p>So the effect of <span class="math inline">\(nutrient\)</span> on <span class="math inline">\(strength\)</span> would be measured without
conditioning on <span class="math inline">\(weight\)</span>. The regression</p>
<p><span class="math display">\[
strength = \beta_0 + \beta_1 nutrient
\]</span>
The analysis would be conducted by evaluating the effect measures as described
in chapter 3 and 4.</p>
<blockquote>
<p>How might a reviewer critique your results</p>
</blockquote>
<p>The reviewer could raise the following points</p>
<ul>
<li>Several regression models including different mixtures of predictor
variables should be run and evaluated toe stimate the impact of confounders</li>
<li>Excluding other predictors in the regression models could make the analysis
spurious as the effects of confounders might actually be determinant.</li>
</ul>
</div>
<div id="exercise-2-4" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Exercise 2</h3>
<p>The DAG is</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="dag.html#cb227-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb227-2"><a href="dag.html#cb227-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.2</span>, {</span>
<span id="cb227-3"><a href="dag.html#cb227-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H1&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H2&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb227-4"><a href="dag.html#cb227-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;H3&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H4&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb227-5"><a href="dag.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb227-6"><a href="dag.html#cb227-6" aria-hidden="true" tabindex="-1"></a>    H2 <span class="sc">~</span> H1,</span>
<span id="cb227-7"><a href="dag.html#cb227-7" aria-hidden="true" tabindex="-1"></a>    H3 <span class="sc">~</span> H1,</span>
<span id="cb227-8"><a href="dag.html#cb227-8" aria-hidden="true" tabindex="-1"></a>    H4 <span class="sc">~</span> H1 <span class="sc">+</span> H3,</span>
<span id="cb227-9"><a href="dag.html#cb227-9" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> H2 <span class="sc">+</span> H3,</span>
<span id="cb227-10"><a href="dag.html#cb227-10" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> H2 <span class="sc">+</span> H4,</span>
<span id="cb227-11"><a href="dag.html#cb227-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb227-12"><a href="dag.html#cb227-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb227-13"><a href="dag.html#cb227-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb227-14"><a href="dag.html#cb227-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-15"><a href="dag.html#cb227-15" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(H[<span class="dv">1</span>]), <span class="fu">expression</span>(H[<span class="dv">2</span>]),</span>
<span id="cb227-16"><a href="dag.html#cb227-16" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(H[<span class="dv">3</span>]), <span class="fu">expression</span>(H[<span class="dv">4</span>]), <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb227-17"><a href="dag.html#cb227-17" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_labels =</span> text_labels)</span>
<span id="cb227-18"><a href="dag.html#cb227-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-147"></span>
<img src="_main_files/figure-html/unnamed-chunk-147-1.png" alt="Causal DAG for Exercise 2" width="80%" />
<p class="caption">
Figure 5.10: Causal DAG for Exercise 2
</p>
</div>
<blockquote>
<p>Which varibales are true confounder?</p>
</blockquote>
<p>A true confounder is defined on p.Â 86 as</p>
<blockquote>
<p>a variable that influences the exposure and that also influences the outcome
via a directed path that does not include the exposure.</p>
</blockquote>
<p><span class="math inline">\(H1\)</span> is a true confounder since
* It influences the exposure <span class="math inline">\(A\)</span> through the path <span class="math inline">\(H_1 \rightarrow H_3 \rightarrow A\)</span>
and influences the outcome through the path <span class="math inline">\(H_1 \rightarrow H_4 \rightarrow Y\)</span>
that does not include <span class="math inline">\(A\)</span></p>
<p><span class="math inline">\(H2\)</span> is a true confounder since
* It influences the exposure <span class="math inline">\(A\)</span> through the path <span class="math inline">\(H_2 \rightarrow A\)</span>
and influences the outcome through the path <span class="math inline">\(H_2 \rightarrow Y\)</span>
that does not include <span class="math inline">\(A\)</span></p>
<p><span class="math inline">\(H3\)</span> is a true confounder since
* It influences the exposure <span class="math inline">\(A\)</span> through the path <span class="math inline">\(H_3 \rightarrow A\)</span>
and influences the outcome through the path <span class="math inline">\(H_3 \rightarrow H_4 \rightarrow Y\)</span>
that does not include <span class="math inline">\(A\)</span></p>
<blockquote>
<p>Is the set <span class="math inline">\(\{H_2, H_4\}\)</span> a sufficient set of true confounders?</p>
</blockquote>
<p>The minimal adjustment sets, also called smallest sufficient set of true
confounders, include the set <span class="math inline">\(\{H_2, H_4\}\)</span> so the answer is yes.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="dag.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(scm_ex5<span class="fl">.2</span><span class="sc">$</span>dag, <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>, <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<pre><code>## { H2, H4 }
## { H2, H3 }</code></pre>
<blockquote>
<p>Redraw the DAG to include potential outcomes behind the scene.</p>
</blockquote>
<p>We block <span class="math inline">\(\{H_2, H_4\}\)</span> with the potential outcomes.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-149"></span>
<img src="_main_files/figure-html/unnamed-chunk-149-1.png" alt="Causal DAG for Exercise 2 with Potential Outcomes" width="80%" />
<p class="caption">
Figure 5.11: Causal DAG for Exercise 2 with Potential Outcomes
</p>
</div>
<blockquote>
<p>Are the potenial outcomes true confounders?</p>
</blockquote>
<p>No as they do not influence the exposure. See also section 5.2 p.Â 87, after
figure 5.5, that says</p>
<blockquote>
<p>The collection of potential outcomes <span class="math inline">\(\{Y(a)\}_{a \in A}\)</span> van be viewed as the
ultimate confounder, even <em>when it is not a true confounder</em>.</p>
</blockquote>
<p>And since the potential outcome is a latent variable it is not included in
the minimal set. But the minimal set is clearly block by the potential outcomes node <span class="math inline">\(U\)</span>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="dag.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(scm_ex5<span class="fl">.2</span>po<span class="sc">$</span>dag)</span></code></pre></div>
<pre><code>## { H2, H4 }
## { H2, H3 }</code></pre>
</div>
<div id="exercise-3-4" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Exercise 3</h3>
<p>The simulation is done with <code>simstudy</code></p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="dag.html#cb232-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb232-2"><a href="dag.html#cb232-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.3</span>, {</span>
<span id="cb232-3"><a href="dag.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb232-4"><a href="dag.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">&quot;H1&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-5"><a href="dag.html#cb232-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="fl">0.1</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-6"><a href="dag.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  formulaH2 <span class="ot">&lt;-</span> <span class="st">&quot;0.1 + 0.1 * H1&quot;</span></span>
<span id="cb232-7"><a href="dag.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;H2&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-8"><a href="dag.html#cb232-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaH2, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-9"><a href="dag.html#cb232-9" aria-hidden="true" tabindex="-1"></a>  formulaH3<span class="ot">&lt;-</span> <span class="st">&quot;0.2 + 0.2 * H2&quot;</span></span>
<span id="cb232-10"><a href="dag.html#cb232-10" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;H3&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-11"><a href="dag.html#cb232-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaH3, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-12"><a href="dag.html#cb232-12" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;H4&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-13"><a href="dag.html#cb232-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="fl">0.5</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-14"><a href="dag.html#cb232-14" aria-hidden="true" tabindex="-1"></a>  formulaA <span class="ot">&lt;-</span> <span class="st">&quot;0.1 + 0.1 * H2 + 0.1 * H3 + 0.1 * H4&quot;</span></span>
<span id="cb232-15"><a href="dag.html#cb232-15" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;A&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-16"><a href="dag.html#cb232-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaA, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-17"><a href="dag.html#cb232-17" aria-hidden="true" tabindex="-1"></a>  formulaY <span class="ot">&lt;-</span> <span class="st">&quot;0.1 + 0.2 * H1 + 0.2 * H2 + + 0.3 * A&quot;</span></span>
<span id="cb232-18"><a href="dag.html#cb232-18" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb232-19"><a href="dag.html#cb232-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb232-20"><a href="dag.html#cb232-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb232-21"><a href="dag.html#cb232-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the data</span></span>
<span id="cb232-22"><a href="dag.html#cb232-22" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">genData</span>(<span class="dv">1000</span>, defs)</span>
<span id="cb232-23"><a href="dag.html#cb232-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb232-24"><a href="dag.html#cb232-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create table of joint probabilities</span></span>
<span id="cb232-25"><a href="dag.html#cb232-25" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb232-26"><a href="dag.html#cb232-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(H1, H2, H3, H4, A, Y) <span class="sc">%&gt;%</span></span>
<span id="cb232-27"><a href="dag.html#cb232-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-28"><a href="dag.html#cb232-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb232-29"><a href="dag.html#cb232-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb232-30"><a href="dag.html#cb232-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb232-31"><a href="dag.html#cb232-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-32"><a href="dag.html#cb232-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format the tableau</span></span>
<span id="cb232-33"><a href="dag.html#cb232-33" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">gt_probs</span>(tbl, <span class="at">title =</span> <span class="st">&quot;Table exercise 5.3&quot;</span>,</span>
<span id="cb232-34"><a href="dag.html#cb232-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subtitle =</span> <span class="st">&quot;Simulation Probabilities for `simex3.r`&quot;</span>)</span>
<span id="cb232-35"><a href="dag.html#cb232-35" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<blockquote>
<p>Draw a causal DAG</p>
</blockquote>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="dag.html#cb233-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.3</span>, {</span>
<span id="cb233-2"><a href="dag.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H1&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H2&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb233-3"><a href="dag.html#cb233-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;H3&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H4&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb233-4"><a href="dag.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb233-5"><a href="dag.html#cb233-5" aria-hidden="true" tabindex="-1"></a>    H2 <span class="sc">~</span> H1,</span>
<span id="cb233-6"><a href="dag.html#cb233-6" aria-hidden="true" tabindex="-1"></a>    H3 <span class="sc">~</span> H2,</span>
<span id="cb233-7"><a href="dag.html#cb233-7" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> H2 <span class="sc">+</span> H3 <span class="sc">+</span> H4,</span>
<span id="cb233-8"><a href="dag.html#cb233-8" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> H1 <span class="sc">+</span> H2,</span>
<span id="cb233-9"><a href="dag.html#cb233-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb233-10"><a href="dag.html#cb233-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb233-11"><a href="dag.html#cb233-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb233-12"><a href="dag.html#cb233-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb233-13"><a href="dag.html#cb233-13" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(H[<span class="dv">1</span>]), <span class="fu">expression</span>(H[<span class="dv">2</span>]),</span>
<span id="cb233-14"><a href="dag.html#cb233-14" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">expression</span>(H[<span class="dv">3</span>]), <span class="fu">expression</span>(H[<span class="dv">4</span>]), <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb233-15"><a href="dag.html#cb233-15" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>, <span class="at">text_labels =</span> text_labels, <span class="at">text_size =</span> <span class="dv">5</span>)</span>
<span id="cb233-16"><a href="dag.html#cb233-16" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-153"></span>
<img src="_main_files/figure-html/unnamed-chunk-153-1.png" alt="Causal DAG for Exercise 3" width="80%" />
<p class="caption">
Figure 5.12: Causal DAG for Exercise 3
</p>
</div>
<blockquote>
<p>List the true confounders</p>
</blockquote>
<p>it is worth repeating the definition of true confounders found on p.Â 86</p>
<blockquote>
<p>a variable that influences the exposure and that also influences the outcome
via a directed path that does not include the exposure.</p>
</blockquote>
<p>which in this case are <span class="math inline">\(\{H_1, H_2\}\)</span> because</p>
<ul>
<li><span class="math inline">\(H_1\)</span> influence the exposure through <span class="math inline">\(H_1 \rightarrow H_2 \rightarrow A\)</span> and
the outcome without the exposure in the path through <span class="math inline">\(H_1 \rightarrow Y\)</span></li>
<li><span class="math inline">\(H_2\)</span> influence the exposure through <span class="math inline">\(H_2 \rightarrow A\)</span> and
the outcome without the exposure in the path through <span class="math inline">\(H_2 \rightarrow Y\)</span></li>
</ul>
<blockquote>
<p>List the smallest sufficient set of true confounders</p>
</blockquote>
<p>That set would be <span class="math inline">\(\{H_2\}\)</span> since it blocks <span class="math inline">\(H_1\)</span> as well</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="dag.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(scm_ex5<span class="fl">.3</span><span class="sc">$</span>dag)</span></code></pre></div>
<pre><code>## { H2 }</code></pre>
<p>Therefore to redraw with potential outcomes we would blovk the paths <span class="math inline">\(H_2 \rightarrow Y\)</span>
and <span class="math inline">\(H_1 \rightarrow Y\)</span> as follows</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="dag.html#cb236-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.3</span>po <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb236-2"><a href="dag.html#cb236-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.3</span>po <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.3</span>po, {</span>
<span id="cb236-3"><a href="dag.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H1&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H2&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb236-4"><a href="dag.html#cb236-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;H3&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;H4&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;U&quot;</span> <span class="ot">=</span> <span class="st">&quot;(Y(0), Y(1))&quot;</span>, <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb236-5"><a href="dag.html#cb236-5" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb236-6"><a href="dag.html#cb236-6" aria-hidden="true" tabindex="-1"></a>    H2 <span class="sc">~</span> H1,</span>
<span id="cb236-7"><a href="dag.html#cb236-7" aria-hidden="true" tabindex="-1"></a>    H3 <span class="sc">~</span> H2,</span>
<span id="cb236-8"><a href="dag.html#cb236-8" aria-hidden="true" tabindex="-1"></a>    A <span class="sc">~</span> H2 <span class="sc">+</span> H3 <span class="sc">+</span> H4,</span>
<span id="cb236-9"><a href="dag.html#cb236-9" aria-hidden="true" tabindex="-1"></a>    U <span class="sc">~</span> H1 <span class="sc">+</span> H2,</span>
<span id="cb236-10"><a href="dag.html#cb236-10" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> A <span class="sc">+</span> U,</span>
<span id="cb236-11"><a href="dag.html#cb236-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb236-12"><a href="dag.html#cb236-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb236-13"><a href="dag.html#cb236-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">latent =</span> <span class="st">&quot;U&quot;</span>,</span>
<span id="cb236-14"><a href="dag.html#cb236-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> the_nodes)</span>
<span id="cb236-15"><a href="dag.html#cb236-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb236-16"><a href="dag.html#cb236-16" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">expression</span>(H[<span class="dv">1</span>]), <span class="fu">expression</span>(H[<span class="dv">2</span>]),</span>
<span id="cb236-17"><a href="dag.html#cb236-17" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">expression</span>(H[<span class="dv">3</span>]), <span class="fu">expression</span>(H[<span class="dv">4</span>]), <span class="st">&quot;U&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb236-18"><a href="dag.html#cb236-18" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>, <span class="at">text_labels =</span> text_labels, <span class="at">text_size =</span> <span class="dv">5</span>)</span>
<span id="cb236-19"><a href="dag.html#cb236-19" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-156"></span>
<img src="_main_files/figure-html/unnamed-chunk-156-1.png" alt="Causal DAG for Exercise 3 With Potential Outcomes" width="80%" />
<p class="caption">
Figure 5.13: Causal DAG for Exercise 3 With Potential Outcomes
</p>
</div>
<blockquote>
<p>Verify that they form a sufficient set of confounders</p>
</blockquote>
<p>and again the minimal set is <span class="math inline">\(\{H_2\}\)</span> but this time it is blocked by the latent
variable <span class="math inline">\(U\)</span>.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="dag.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(scm_ex5<span class="fl">.3</span>po<span class="sc">$</span>dag)</span></code></pre></div>
<pre><code>## { H2 }</code></pre>
<blockquote>
<p>Are the potential outcomes true confounders?</p>
</blockquote>
<p>No as they do not influence the exposure. See also section 5.2 p.Â 87, after
figure 5.5, that says</p>
<blockquote>
<p>The collection of potential outcomes <span class="math inline">\(\{Y(a)\}_{a \in A}\)</span> van be viewed as the
ultimate confounder, even <em>when it is not a true confounder</em>.</p>
</blockquote>
</div>
<div id="exercise-4-4" class="section level3" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Exercise 4</h3>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="dag.html#cb239-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb239-2"><a href="dag.html#cb239-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.4</span>, {</span>
<span id="cb239-3"><a href="dag.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;O&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>, <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb239-4"><a href="dag.html#cb239-4" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb239-5"><a href="dag.html#cb239-5" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> O <span class="sc">+</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>,</span>
<span id="cb239-6"><a href="dag.html#cb239-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;T&quot;</span>,</span>
<span id="cb239-7"><a href="dag.html#cb239-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb239-8"><a href="dag.html#cb239-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels  =</span> the_nodes)</span>
<span id="cb239-9"><a href="dag.html#cb239-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb239-10"><a href="dag.html#cb239-10" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_size =</span> <span class="dv">5</span>)</span>
<span id="cb239-11"><a href="dag.html#cb239-11" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-159"></span>
<img src="_main_files/figure-html/unnamed-chunk-159-1.png" alt="Causal DAG for Exercise 4" width="80%" />
<p class="caption">
Figure 5.14: Causal DAG for Exercise 4
</p>
</div>
<blockquote>
<p>Explain why assessing safety of the vaccine by estimating the association between
<span class="math inline">\(T\)</span> and <span class="math inline">\(Y\)</span> for those with <span class="math inline">\(O = 1\)</span> is a biased analysis.</p>
</blockquote>
<p>By including <span class="math inline">\(O = 1\)</span> in the analysis <span class="math inline">\(Y\)</span> becomes a <em>common effect</em> of both
<span class="math inline">\(O\)</span> and <span class="math inline">\(T\)</span>. Therefore conditioning on <span class="math inline">\(O\)</span> cause the study to focus on a slice
of data that itself might influence the outcome since the fact that some
participants are observed but not others might very well not be random and
the result of one or many latent confounders.</p>
</div>
<div id="exercise-5-3" class="section level3" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> Exercise 5</h3>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="dag.html#cb240-1" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb240-2"><a href="dag.html#cb240-2" aria-hidden="true" tabindex="-1"></a>scm_ex5<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">within</span>(scm_ex5<span class="fl">.5</span>, {</span>
<span id="cb240-3"><a href="dag.html#cb240-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-4"><a href="dag.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the simulation</span></span>
<span id="cb240-5"><a href="dag.html#cb240-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">2468</span>)</span>
<span id="cb240-6"><a href="dag.html#cb240-6" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(<span class="at">varname =</span> <span class="st">&quot;T&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb240-7"><a href="dag.html#cb240-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> <span class="fl">0.5</span>, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb240-8"><a href="dag.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  formulaY <span class="ot">&lt;-</span> <span class="st">&quot;0.01 * T&quot;</span></span>
<span id="cb240-9"><a href="dag.html#cb240-9" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb240-10"><a href="dag.html#cb240-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaY, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb240-11"><a href="dag.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  formulaO <span class="ot">&lt;-</span> <span class="st">&quot;Y + 0.1 * (1- Y)&quot;</span></span>
<span id="cb240-12"><a href="dag.html#cb240-12" aria-hidden="true" tabindex="-1"></a>  defs <span class="ot">&lt;-</span> <span class="fu">defData</span>(defs, <span class="at">varname =</span> <span class="st">&quot;O&quot;</span>, <span class="at">dist =</span> <span class="st">&quot;binomial&quot;</span>, </span>
<span id="cb240-13"><a href="dag.html#cb240-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> formulaO, <span class="at">variance =</span> <span class="dv">1</span>)</span>
<span id="cb240-14"><a href="dag.html#cb240-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-15"><a href="dag.html#cb240-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the data</span></span>
<span id="cb240-16"><a href="dag.html#cb240-16" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">genData</span>(<span class="fl">1e4</span>, defs)</span>
<span id="cb240-17"><a href="dag.html#cb240-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-18"><a href="dag.html#cb240-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create table of joint probabilities</span></span>
<span id="cb240-19"><a href="dag.html#cb240-19" aria-hidden="true" tabindex="-1"></a>  tbl <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb240-20"><a href="dag.html#cb240-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="st">`</span><span class="at">T</span><span class="st">`</span>, Y, O) <span class="sc">%&gt;%</span></span>
<span id="cb240-21"><a href="dag.html#cb240-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb240-22"><a href="dag.html#cb240-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb240-23"><a href="dag.html#cb240-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> <span class="fu">sum</span>(prob))</span>
<span id="cb240-24"><a href="dag.html#cb240-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">near</span>(<span class="fu">sum</span>(tbl<span class="sc">$</span>prob), <span class="dv">1</span>))</span>
<span id="cb240-25"><a href="dag.html#cb240-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-26"><a href="dag.html#cb240-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># format the tableau</span></span>
<span id="cb240-27"><a href="dag.html#cb240-27" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">&lt;-</span> <span class="fu">tbl_probs</span>(tbl, <span class="at">title =</span> <span class="st">&quot;Table exercise 5.5&quot;</span>,</span>
<span id="cb240-28"><a href="dag.html#cb240-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subtitle =</span> <span class="st">&quot;Simulation Probabilities for `simex5.r`&quot;</span>)</span>
<span id="cb240-29"><a href="dag.html#cb240-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-30"><a href="dag.html#cb240-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-31"><a href="dag.html#cb240-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The DAG</span></span>
<span id="cb240-32"><a href="dag.html#cb240-32" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;O&quot;</span> <span class="ot">=</span> <span class="st">&quot;Inclusion&quot;</span>, <span class="st">&quot;T&quot;</span> <span class="ot">=</span> <span class="st">&quot;Infection HPV&quot;</span>, <span class="st">&quot;Y&quot;</span> <span class="ot">=</span> <span class="st">&quot;Cervical Cancer&quot;</span>)</span>
<span id="cb240-33"><a href="dag.html#cb240-33" aria-hidden="true" tabindex="-1"></a>  dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb240-34"><a href="dag.html#cb240-34" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> <span class="st">`</span><span class="at">T</span><span class="st">`</span>,</span>
<span id="cb240-35"><a href="dag.html#cb240-35" aria-hidden="true" tabindex="-1"></a>    O <span class="sc">~</span> Y, </span>
<span id="cb240-36"><a href="dag.html#cb240-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;T&quot;</span>,</span>
<span id="cb240-37"><a href="dag.html#cb240-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb240-38"><a href="dag.html#cb240-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels  =</span> the_nodes)</span>
<span id="cb240-39"><a href="dag.html#cb240-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb240-40"><a href="dag.html#cb240-40" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">&lt;-</span> <span class="fu">ggp_dag</span>(dag, <span class="at">text_size =</span> <span class="dv">5</span>)</span>
<span id="cb240-41"><a href="dag.html#cb240-41" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-161"></span>
<img src="_main_files/figure-html/unnamed-chunk-161-1.png" alt="Causal DAG for Exercise 5" width="80%" />
<p class="caption">
Figure 5.15: Causal DAG for Exercise 5
</p>
</div>
<p>As explained in section 3.3 of chapter 3 if we use the information from the
simulation then</p>
<p><span class="math display">\[
\begin{align*}
p_0 &amp;= E(Y = 1 \mid T = 0) = 0.01 * 0.5 = 0.005 \\
p_1 &amp;= E(Y = 1 \mid T = 1) = 0.01 \\
&amp;\therefore \\
RD &amp;= 0.01 - 0.005 = 0.005 \\
OR &amp;= \frac{\frac{p_1}{1 - p_1}}{\frac{p_0}{1-p_0}} = \frac{0.1}{0.9} \cdot \frac{0.995}{0.005} = 22\frac{1}{9} =22.11
\end{align*}
\]</span></p>
<div id="a-1" class="section level4" number="5.3.5.1">
<h4><span class="header-section-number">5.3.5.1</span> a)</h4>
<p>Show mathematically that the odds ratio comparing with <span class="math inline">\(O\)</span> is the same as when
not conditioning with <span class="math inline">\(O\)</span></p>
<p>The odds ratio <span class="math inline">\(OR\)</span> is</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(Y=1 \mid T = 1, O =1)}{1 - P(Y=1 \mid T = 1, O =1)} \cdot \frac{1 - P(Y=1 \mid T=0, O =1)}{P(Y=1 \mid T=0, O =1)} \\
&amp; =\frac{P(Y=1 \mid T = 1, O =1)}{P(Y=0 \mid T = 1, O =1)} \cdot \frac{P(Y=0 \mid T = 0, O =1)}{P(Y = 1 \mid T = 0, O =1)} \\
\end{align*}
\]</span>
but we know that</p>
<p><span class="math display">\[
\begin{align*}
P(Y \mid T, O)P(T, O) = P(T, Y, O) = P(T \mid Y, O) P(Y, O)
\end{align*}
\]</span>
therefore</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(Y=1 \mid T=1, O=1)}{P(Y=0 \mid T=1, O=1)} \cdot \frac{P(Y=0 \mid T=0, O=1)}{P(Y=1 \mid T=0, O=1)} \\
&amp;= \frac{P(T=1 \mid Y=1, O=1)}{P(T=1 \mid Y=0, O=1)} \cdot \frac{P(T=0 \mid Y=0, O=1)}{P(T=0 \mid Y=1, O =1)}
\end{align*}
\]</span>
ans since</p>
<p><span class="math display">\[
T\perp\!\!\!\perp O \mid Y \implies P(T \mid Y, O) = P(T \mid Y)
\]</span></p>
<p>then</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(T=1 \mid Y=1, O=1)}{P(T=1 \mid Y=0, O=1)} \cdot \frac{P(T=0 \mid Y=0, O=1)}{P(T=0 \mid Y=1, O=1)} \\
&amp;= \frac{P(T=1 \mid Y=1)}{P(T=1 \mid Y=0)} \cdot \frac{P(T=0 \mid Y=0)}{P(T=0 \mid Y=1)}
\end{align*}
\]</span></p>
<p>and again by using</p>
<p><span class="math display">\[
\begin{align*}
P(Y \mid T)P(T) = P(T, Y) = P(T \mid Y) P(Y)
\end{align*}
\]</span>
we have</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(T=1 \mid Y=1)}{P(T=1 \mid Y=0)} \cdot \frac{P(T=0 \mid Y=0)}{P(T=0 \mid Y=1)} \\
&amp;= \frac{P(Y=1 \mid T=1)}{P(Y=1 \mid T=0)} \cdot \frac{P(Y=0 \mid T=0)}{P(Y=0 \mid T=1)}
\end{align*}
\]</span></p>
</div>
<div id="b-1" class="section level4" number="5.3.5.2">
<h4><span class="header-section-number">5.3.5.2</span> b)</h4>
<p>Show that when <span class="math inline">\(Y=1\)</span> is rare, the odds ratio is similar to the risk ratio.</p>
<p>from a) above we have</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(Y=1 \mid T=1)}{P(Y=1 \mid T=0)} \cdot \frac{P(Y=0 \mid T=0)}{P(Y=0 \mid T=1)}
\end{align*}
\]</span>
and since <span class="math inline">\(Y\)</span> is rare</p>
<p><span class="math display">\[
P(Y=0 \mid T=0)\approx 1 \approx P(Y=0 \mid T=1)
\]</span></p>
<p>therefore</p>
<p><span class="math display">\[
\begin{align*}
OR &amp;= \frac{P(Y=1 \mid T=1)}{P(Y=1 \mid T=0)} \cdot \frac{P(Y=0 \mid T=0)}{P(Y=0 \mid T=1)} \\
&amp;\approx \frac{P(Y=1 \mid T=1)}{P(Y=1 \mid T=0)} \\
&amp;= RR
\end{align*}
\]</span></p>

<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="dag.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb241-2"><a href="dag.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb241-3"><a href="dag.html#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb241-4"><a href="dag.html#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb241-5"><a href="dag.html#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb241-6"><a href="dag.html#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code></pre></div>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="dag.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># directory of data files</span></span>
<span id="cb242-2"><a href="dag.html#cb242-2" aria-hidden="true" tabindex="-1"></a>dir_data <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;data&quot;</span>)</span>
<span id="cb242-3"><a href="dag.html#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># directory for functions</span></span>
<span id="cb242-4"><a href="dag.html#cb242-4" aria-hidden="true" tabindex="-1"></a>dir_lib <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">&quot;lib&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="measures.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="backdoor.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-dag.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 2
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
